
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Robust Production Planning &#8212; Companion Notebooks for Data-Driven Mathematical Optimization in Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Airline seat allocation problem" href="airline-seating.html" />
    <link rel="prev" title="10. Two-Stage Problems" href="10.00.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DVQ7NZ8CYZ"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-DVQ7NZ8CYZ');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo-02.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Companion Notebooks for Data-Driven Mathematical Optimization in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Data-Driven Mathematical Optimization in Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/01.00.html">
   1. Mathematical Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/production-planning.html">
     Pyomo Tutorial Example: Production Planning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/02.00.html">
   2. Linear Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim.html">
     BIM production
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/lad-regression.html">
     LAD Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/mad-portfolio-optimization.html">
     MAD portfolio optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/L1-regression-wine-quality.html">
     Wine quality prediction with L1 regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-maxmin.html">
     BIM production for worst case
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-fractional.html">
     BIM production variants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-rawmaterialplanning.html">
     BIM production using demand forecasts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/multiproductionfaciliity_worstcase.html">
     Extra material: Multi-product facility production
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/03.00.html">
   3. Mixed Integer Linear Programming
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-perturbed.html">
     BIM production with perturbed data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/shift-scheduling.html">
     Workforce shift scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/simple-production-model-gdp.html">
     Production model using disjunctions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/machine-scheduling.html">
     Machine Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/recharging-electric-vehicle.html">
     Recharging strategy for an electric vehicle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-production-revisited.html">
     BIM production revisited
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/cryptarithms.html">
     Extra material: Cryptarithms puzzle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/strip-packing.html">
     Extra material: Strip packing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/job-shop-scheduling.html">
     Extra material: Job shop scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/maintenance-planning.html">
     Extra material: Maintenance planning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/04.00.html">
   4. Network Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/dinner-seat-allocation.html">
     Dinner seating arrangement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/gasoline-distribution.html">
     Gasoline distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/cryptocurrency-arbitrage.html">
     Cryptocurrency arbitrage search
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/shortest-path-road-networks.html">
     Extra material: Shortest path in real life
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/power-network.html">
     Extra material: Energy dispatch problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05/05.00.html">
   5. Convex Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/milk-pooling.html">
     Milk pooling and blending
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/ols-regression.html">
     Ordinary Least Squares (OLS) Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/markowitz_portfolio.html">
     Markowitz portfolio optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/svm-linear.html">
     Support Vector Machines for Binary Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/refinery-production.html">
     Extra material: Refinery production and shadow pricing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/06.00.html">
   6. Conic Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/economic-order-quantity.html">
     Economic Order Quantity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/kelly-criterion.html">
     The Kelly Criterion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/markowitz_portfolio_revisited.html">
     Markowitz portfolio optimization revisited
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/building-insulation.html">
     Optimal Design of Multilayered Building Insulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/investment-wheel.html">
     Extra material: Luenberger’s Investment Wheel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/optimal-growth-portfolios.html">
     Extra material: Optimal Growth Portfolios
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/07.00.html">
   7. Accounting for Uncertainty: Optimization Meets Reality
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/fleet-assignment.html">
     Fleet assignment problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/bim-robustness-analysis.html">
     Robustness analysis of BIM production plan via simulations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08/08.00.html">
   8. Robust Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/bim-robust-optimization.html">
     Robust BIM microchip production problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/09.00.html">
   9. Stochastic Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/pop-up_shop.html">
     Pop-up shop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/markowitz_portfolio_with_chance_constraint.html">
     Markowitz portfolio optimization with chance constraints
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/newsvendor.html">
     Stock optimization for seafood distribution center
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="10.00.html">
   10. Two-Stage Problems
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Robust Production Planning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="airline-seating.html">
     Airline seat allocation problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="farmer.html">
     The Farmer’s Problem and Variants
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pyomo_style_guide.html">
   Appendix: Pyomo style guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../genindex.html">
   Index
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/mobook/MO-book/main?urlpath=tree/notebooks/10/ccg.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/mobook/MO-book/blob/main/notebooks/10/ccg.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/mobook/MO-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/mobook/MO-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/10/ccg.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/10/ccg.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Robust Production Planning
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-statement">
     Problem Statement
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-kind-of-a-problem-is-this">
     What kind of a problem is this
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-stage-formulation-cf-section-10-1">
     Two stage formulation (cf. Section 10.1)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solving-the-robust-problem-through-random-scenarios">
   Solving the robust problem through random scenarios
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparing-the-worst-case-optimization-to-expected-profit-optimization">
     Comparing the worst-case optimization to expected-profit optimization
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#column-and-constraint-generation-for-the-robust-solution">
     Column and constraint generation for the robust solution
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deprecated">
     Deprecated
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bibliographic-notes">
     Bibliographic Notes
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Robust Production Planning</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Robust Production Planning
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#problem-statement">
     Problem Statement
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-kind-of-a-problem-is-this">
     What kind of a problem is this
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-stage-formulation-cf-section-10-1">
     Two stage formulation (cf. Section 10.1)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solving-the-robust-problem-through-random-scenarios">
   Solving the robust problem through random scenarios
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparing-the-worst-case-optimization-to-expected-profit-optimization">
     Comparing the worst-case optimization to expected-profit optimization
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#column-and-constraint-generation-for-the-robust-solution">
     Column and constraint generation for the robust solution
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deprecated">
     Deprecated
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bibliographic-notes">
     Bibliographic Notes
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <span class="target" id="index-0"></span><span class="target" id="index-1"></span><span class="target" id="index-2"></span><span class="target" id="index-3"></span><span class="target" id="index-4"></span><section class="tex2jax_ignore mathjax_ignore" id="robust-production-planning">
<span id="index-5"></span><h1>Robust Production Planning<a class="headerlink" href="#robust-production-planning" title="Permalink to this heading">#</a></h1>
<p>The purpose of this notebook is to demonstrate a range of techniques for robust optimization using a common example.</p>
<ul class="simple">
<li><p>Robust Optimization (including Constraint and Column Generation of Section 10.1)</p></li>
<li><p>Stochastic Optimization (including the SAA method)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># install Pyomo and solvers</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/mobook/MO-book/main/python/helper.py&quot;</span>
<span class="n">helper</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s2">&quot;helper&quot;</span><span class="p">)</span>
<span class="n">exec</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">helper</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

<span class="n">helper</span><span class="o">.</span><span class="n">install_pyomo</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pyomo was previously installed
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<section id="problem-statement">
<h2>Problem Statement<a class="headerlink" href="#problem-statement" title="Permalink to this heading">#</a></h2>
<p>Consider again the initial problem of this textbook where a small startup company has announced the initial production of two models, <span class="math notranslate nohighlight">\(U\)</span> and <span class="math notranslate nohighlight">\(V\)</span>. For completeness we re-tell the situation here with the additional layer of uncertainty:</p>
<ul class="simple">
<li><p>Model <span class="math notranslate nohighlight">\(U\)</span> is the higher priced version requiring 10 units of raw material. The labor requirement is estimated to be 1 hour of labor A and 2 hours of labor B. The <span class="math notranslate nohighlight">\(U\)</span> model will sell for 270€ per unit.</p></li>
<li><p>Model <span class="math notranslate nohighlight">\(V\)</span> requires 9 units of the same raw materials and is estimated to require 1 hour of labor A and 1 hour of labor B. Model <span class="math notranslate nohighlight">\(V\)</span> sells for 210€ per unit with unlimited demand.</p></li>
<li><p>A pre-production  marketing campaign offers guaranteed delivery of model <span class="math notranslate nohighlight">\(U\)</span> in return for a down payment. Initially it is expected that the number of such orders will be 20 units. Because of the higher price, the demand for model <span class="math notranslate nohighlight">\(U\)</span> is limited so no more than 40 units will be produced.</p></li>
<li><p>The raw materials cost 10€ per unit. The raw materials have a long lead time and must be ordered now. Unused raw materials have no waste value.</p></li>
<li><p>Given current staffing, there are 80 hours of labor A available at a cost of 50€/hour, and 100 hours of labor B available at a cost of 40€/hour.</p></li>
<li><p>The company will not have not accurate knowledge of the labor required to produce each product until production starts. The estimated amount of labor A and labor B needed for each unit produced could be off by 15% and 25%, respectively. Additionally, there is uncertainty about the amount of down-payment demand for model <span class="math notranslate nohighlight">\(U\)</span> - it can differ by up to 25%, up or down, from the nominal value of 20. It is not expected, however, that more than two of those parameters are perturbed by their maximum amount.</p></li>
</ul>
<p>The company’s chief operating officer (COO) must decide how much raw material to order now without complete information about labor needed to manufacture the models, or knowledge about the outcome of the pre-production marketing campaign. If the COO orders too much now then raw material will be left over and wasted. If the COO orders too little then a profit opportunity will be lost. In either case, the profit realized will be less than than the potential. In what way can the best decision be made?</p>
</section>
<section id="what-kind-of-a-problem-is-this">
<h2>What kind of a problem is this<a class="headerlink" href="#what-kind-of-a-problem-is-this" title="Permalink to this heading">#</a></h2>
<p>The first thing we notice about the problem is that it has a two-stage structure: the ordering of the raw material has to be done before the unknown demand is observed and the labor requirements are known. The decisions about the amount of two models to be produced can be, however, made with full information about the uncertainty.</p>
<p>As for the uncertainty itself, no information is given other than the set of values the respective parameters can take:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(z_A\)</span>: Relative uncertainty in the amount of labor A required to produce each unit of product.</p></li>
<li><p><span class="math notranslate nohighlight">\(z_B\)</span>: Relative uncertainty is the amount of labor B required to produce each unit of product.</p></li>
<li><p><span class="math notranslate nohighlight">\(z_D\)</span>: Uncertainty in number initial orders for product <span class="math notranslate nohighlight">\(U\)</span>.
where</p></li>
</ul>
<p>\begin{align*}
|z_A| &amp; \leq 0.15 &amp;&amp; \pm\text{15% uncertainty in Labor }A \
|z_B| &amp; \leq 0.25 &amp;&amp; \pm\text{25% uncertainty in Labor }B \
|z_D| &amp; \leq 0.25 &amp;&amp;  \text{25% uncertainty in initial orders for }U \
\end{align*}</p>
<p>and where at most two of them attain their maximum deviation which can be formulated as the following budget constraint:</p>
<p>\begin{align*}
\frac{|z_A|}{0.15} + \frac{|z_A|}{0.25} + \frac{|z_D|}{0.25} \leq 2
\end{align*}</p>
<p>Let us see how these parameters <span class="math notranslate nohighlight">\(z_A\)</span> and <span class="math notranslate nohighlight">\(z_B\)</span> affect the problem.  After subtracting the unknown labor cost from the selling price, the unit profit for each device is given by:</p>
<p>\begin{align*}
P_U &amp; = 270 - 50(1+z_A) - 80(1+z_B) - 100) \
&amp; = 40 - 50 z_A - 80 z_B \
\implies P_U &amp; \in [2.5, 57.5] \
\
P_V &amp; = 210 - 50(1+z_A) - 40(1+z_B) - 90) \
&amp; = 30 - 50 z_A - 40 z_B \
\implies P_V  &amp; \in [12.5, 47.5]
\end{align*}</p>
<p>It is therefore not clear in advance which of the products would be more profitable. Taking into account the additional uncertainty about the preorder demand for product <span class="math notranslate nohighlight">\(U\)</span>, it is not possible to determine in advance what is the worst-case outcome of the uncertainty <span class="math notranslate nohighlight">\(z_A\)</span>, <span class="math notranslate nohighlight">\(z_B\)</span>, <span class="math notranslate nohighlight">\(z_D\)</span> for this problem.</p>
<p>Since we don’t have any information about the probabilities with which the different outcomes of the uncertain parameters could happen, a natural approach is to solve this problem with a worst-case formulation in mind. However, for sake of completeness, we also investigate how the optimal solution would look if each each realization of <span class="math notranslate nohighlight">\((z_A, z_B, z_D)\)</span> was equally probable.</p>
</section>
<section id="two-stage-formulation-cf-section-10-1">
<h2>Two stage formulation (cf. Section 10.1)<a class="headerlink" href="#two-stage-formulation-cf-section-10-1" title="Permalink to this heading">#</a></h2>
<p>Next we formulate the robust optimization problem where the objective is to maximize the worst case profit subject to constraints and uncertainty. We formulate the problem as</p>
<p>\begin{align*}
\max \quad &amp; - 10x + \inf\limits_{z \in Z} Q(x, z) \
\text{s.t.} \quad &amp; x \geq 0,
\end{align*}</p>
<p>where <span class="math notranslate nohighlight">\(x\)</span> is the amount of raw material to order, and where the uncertainty <span class="math notranslate nohighlight">\(z = (z_A, z_B, z_D)\)</span> is given by</p>
<p>\begin{align*}
Z = \left{ (z_A, z_B, z_D): \ |z_A| \leq 0.15, \ |z_B| \leq 0.25, \ |z_D| \leq 0.25, \ \frac{|z_A|}{0.15} + \frac{|z_A|}{0.25} + \frac{|z_D|}{0.25} \leq 2 \right}
\end{align*}</p>
<p><span class="math notranslate nohighlight">\(Q(x, z)\)</span> is the second-stage profit defined by</p>
<p>\begin{align*}
Q(x, z) = \min \quad &amp; y_3 \
\text{s.t.}\quad &amp; (140 - 50z_A - 80z_B) y_1 + (120 - 50z_A - 40z_B) y_2 \geq y_3 &amp;&amp; \text{(worst-case profit)} \
&amp; y_1 \geq 20 (1 + z_D) &amp;&amp; \text{(pre-production orders)} \
&amp; y_2 \leq 40 &amp;&amp; \text{(maximum demand for <span class="math notranslate nohighlight">\(U\)</span>)}\
&amp; (1 + z_A) y_1 + (1 + z_B) y_2 \leq 80 &amp;&amp; \text{(labor A)} \
&amp; 2 (1 + z_A) y_1 + (1 + z_B) y_2 \leq 100 &amp;&amp; \text{(labor B)} \
&amp; -x + 10 y_1 + 9 y_2 \leq 0 &amp;&amp; \text{(raw materials)} \
&amp; y_1, y_2, y_3 \geq 0
\end{align*}</p>
<p>The extra decision variable <span class="math notranslate nohighlight">\(y_3\)</span> serves the purpose of keeping the objective of the second-stage problem free of uncertainty. Clearly, <span class="math notranslate nohighlight">\(x\)</span> plays the role of the first-stage variable here, whereas <span class="math notranslate nohighlight">\(y_1, y_2, y_3\)</span> are the second stage variables. Using our textbook notation, we can formulate the problem data as:</p>
<p>\begin{align*}
x = \begin{pmatrix} x \end{pmatrix},
<br />
y = \begin{pmatrix} y_1 \ y_2 \ y_3 \end{pmatrix},
<br />
z = \begin{pmatrix} z_A \ z_B \ z_D \end{pmatrix}
\end{align*}</p>
<p>Then following are the definitions of the data matrices as functions of uncertainties, consistently with the notation used in Section 10.1.
\begin{align*}
c = \begin{pmatrix} -10 \end{pmatrix}, <br />
q = \begin{pmatrix} 0 \ 0 \ 1 \end{pmatrix} \
\end{align*}</p>
<p>\begin{align*}
R(z)  = \begin{pmatrix} 0 \ 0 \ 0 \ 0 \ -1 \end{pmatrix},
<br />
S(z) = \begin{pmatrix} - (140 - 50z_A - 80z_B) &amp; - (120 - 50z_A - 40z_B) &amp; 1 \ 1 &amp; 0 &amp; 0 \ 1+z_A &amp; 1 + z_A &amp; 0 \ 2(1+z_B) &amp; 1 + z_B &amp; 0 \ 10 &amp; 9 &amp; 0 \end{pmatrix},
<br />
t(z) = \begin{pmatrix} 0 \ -20(1+z_D) \ 80 \ 100 \ 0 \end{pmatrix} \
\end{align*}</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="solving-the-robust-problem-through-random-scenarios">
<h1>Solving the robust problem through random scenarios<a class="headerlink" href="#solving-the-robust-problem-through-random-scenarios" title="Permalink to this heading">#</a></h1>
<p>Before diving into the CCG algorithm as described in the chapter, we can do something very simple - to sample a large number of realizations of <span class="math notranslate nohighlight">\(z\)</span> from the set <span class="math notranslate nohighlight">\(Z\)</span> and to solve the two-stage problem using our function above. This is done by the following code snippet.</p>
<p>Now, how can we actually solve a two-stage problem like this if it is indeed the worst-case profit that we are interested in? We notice that the matrix <span class="math notranslate nohighlight">\(D(z)\)</span> depends on <span class="math notranslate nohighlight">\(z\)</span> and therefore, we cannot easily formulate the second-stage decisions as linear functions of <span class="math notranslate nohighlight">\(z\)</span> (linear decision rules). However, we can apply the column-and-constraint generation approach where we would gradually build a finite list of scenarios and solve a problem that will maximize the worst-case profit across such a set of scenarios:</p>
<p>\begin{align*}
\max \ &amp; c^\top x + \tau  \
\text{s.t.} \  &amp; q^\top y^j \geq \tau, &amp;&amp; j = 1, \ldots, k  \
&amp; R (z^j) x + S(z^j) y^j \leq t(z^j)  &amp;&amp;  j = 1, \ldots, k \
&amp; x, y^1, \ldots, y^k, \tau \geq 0
\end{align*}</p>
<p>The following cell is a function that evaluates the system matrix coefficients for a particular <span class="math notranslate nohighlight">\(z\in Z\)</span> and returns numerical values indexed in nested dictionaries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># function to return c, q, C, D, e evaluated for a scenario</span>
<span class="k">def</span> <span class="nf">model_params</span><span class="p">(</span><span class="n">z_A</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_B</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_D</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    
    <span class="n">c</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">}</span>

    <span class="n">q</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s2">&quot;y2&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s2">&quot;y3&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

    <span class="n">R</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;profit&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
         <span class="s2">&quot;demand&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
         <span class="s2">&quot;labor A&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
         <span class="s2">&quot;labor B&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
         <span class="s2">&quot;raw materials&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}}</span>

    <span class="n">S</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;profit&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="mi">140</span> <span class="o">-</span> <span class="mi">50</span><span class="o">*</span><span class="n">z_A</span> <span class="o">-</span> <span class="mi">80</span><span class="o">*</span><span class="n">z_B</span><span class="p">),</span> <span class="s2">&quot;y2&quot;</span><span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="mi">120</span> <span class="o">-</span> <span class="mi">50</span><span class="o">*</span><span class="n">z_A</span> <span class="o">-</span> <span class="mi">40</span><span class="o">*</span><span class="n">z_B</span><span class="p">),</span> <span class="s2">&quot;y3&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
         <span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;y2&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y3&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
         <span class="s2">&quot;labor A&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;y2&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">z_A</span><span class="p">,</span> <span class="s2">&quot;y3&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
         <span class="s2">&quot;labor B&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">z_B</span><span class="p">,</span> <span class="s2">&quot;y2&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">z_B</span><span class="p">,</span> <span class="s2">&quot;y3&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
         <span class="s2">&quot;raw materials&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;y2&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;y3&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}}</span>

    <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;profit&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">20</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">z_D</span><span class="p">),</span>
          <span class="s2">&quot;labor A&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
          <span class="s2">&quot;labor B&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;raw materials&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">t</span>

<span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">model_params</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;c = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;q = </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R = </span><span class="si">{</span><span class="n">R</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;S = </span><span class="si">{</span><span class="n">S</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t = </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c = {&#39;x&#39;: -10}
q = {&#39;y1&#39;: 0, &#39;y2&#39;: 0, &#39;y3&#39;: 1}
R = {&#39;profit&#39;: {&#39;x&#39;: 0}, &#39;demand&#39;: {&#39;x&#39;: 0}, &#39;labor A&#39;: {&#39;x&#39;: 0}, &#39;labor B&#39;: {&#39;x&#39;: 0}, &#39;raw materials&#39;: {&#39;x&#39;: -1}}
S = {&#39;profit&#39;: {&#39;y1&#39;: -140, &#39;y2&#39;: -120, &#39;y3&#39;: 1}, &#39;demand&#39;: {&#39;y1&#39;: -1, &#39;y2&#39;: 0, &#39;y3&#39;: 0}, &#39;labor A&#39;: {&#39;y1&#39;: 1, &#39;y2&#39;: 1, &#39;y3&#39;: 0}, &#39;labor B&#39;: {&#39;y1&#39;: 2, &#39;y2&#39;: 1, &#39;y3&#39;: 0}, &#39;raw materials&#39;: {&#39;y1&#39;: 10, &#39;y2&#39;: 9, &#39;y3&#39;: 0}}
t = {&#39;profit&#39;: 0, &#39;demand&#39;: -20, &#39;labor A&#39;: 80, &#39;labor B&#39;: 100, &#39;raw materials&#39;: 0}
</pre></div>
</div>
</div>
</div>
<p>In the following cell we randomly sample 1000 scenarios from the uncertainty set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import numpy as np</span>

<span class="k">def</span> <span class="nf">z_sample</span><span class="p">():</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;z_A&quot;</span><span class="p">:</span> <span class="mf">0.15</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;z_B&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;z_D&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;z_A&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">0.15</span> <span class="o">+</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;z_B&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">0.25</span> <span class="o">+</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;z_D&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">0.25</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">sample</span>

<span class="n">k</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">Z</span> <span class="o">=</span> <span class="p">[</span><span class="n">z_sample</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>The next cell creates a Pyomo model to maximize the worst case profit for a set of scenarios, where the block structure is used to repeat the parts of the model which are structurally identical for each outcome of <span class="math notranslate nohighlight">\(z\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">max_min_profit</span><span class="p">(</span><span class="n">model_params</span><span class="p">,</span> <span class="n">Z</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>

    <span class="c1"># first stage variables</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">model_params</span><span class="p">()</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">m</span><span class="o">.</span><span class="n">J</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">q</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">()</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)))</span>
    
    <span class="nd">@m</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">scenario</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>

        <span class="c1"># get model parameters for the scenario</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">model_params</span><span class="p">(</span><span class="o">**</span><span class="n">Z</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        
        <span class="c1"># second stage variables</span>
        <span class="n">b</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">J</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

        <span class="nd">@b</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">stage_net_profit</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;y3&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">t</span>

        <span class="nd">@b</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">def</span> <span class="nf">model_constraints</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span>  <span class="nb">sum</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">J</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    
    <span class="c1"># worst case profit</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">min_profit</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span>
    
    <span class="n">solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Solution to the nominal problem</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">max_min_profit</span><span class="p">(</span><span class="n">model_params</span><span class="p">,</span> <span class="p">[{</span><span class="s2">&quot;z_A&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z_B&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z_D&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}])</span>
<span class="n">m</span><span class="o">.</span><span class="n">min_profit</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Solution to the robust problem</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">max_min_profit</span><span class="p">(</span><span class="n">model_params</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">min_profit</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Solution to the nominal problem

min_profit : Size=1, Index=None, Active=True
    Key  : Active : Value
    None :   True : 2600.0
x : Size=1, Index=I
    Key : Lower : Value : Upper : Fixed : Stale : Domain
      x :     0 : 740.0 :  None : False : False : NonNegativeReals

Solution to the robust problem

min_profit : Size=1, Index=None, Active=True
    Key  : Active : Value
    None :   True : 791.5401999999995
x : Size=1, Index=I
    Key : Lower : Value     : Upper : Fixed : Stale : Domain
      x :     0 : 560.41812 :  None : False : False : NonNegativeReals
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">scenario</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">](),</span> <span class="n">m</span><span class="o">.</span><span class="n">scenario</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;y2&quot;</span><span class="p">](),</span> <span class="s1">&#39;r.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ccg_13_0.png" src="../../_images/ccg_13_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">m</span><span class="o">.</span><span class="n">scenario</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">J</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">J</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">J</span><span class="p">)):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Y</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ccg_14_0.png" src="../../_images/ccg_14_0.png" />
</div>
</div>
<p>The optimal quantity of the raw material to order is equal to <span class="math notranslate nohighlight">\(556.62\)</span> and the worst-case profit it promises is equal to <span class="math notranslate nohighlight">\(911.28\)</span>. Apart from the worst-case profit, we can also be interested in the average-case profit. We can compute it by, for each realization of the uncertain parameter, to see what would the optimal decisions <span class="math notranslate nohighlight">\(y\)</span> be in their case, and compute the corresponding profits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># function that optimizes only over the second stage variables</span>

<span class="k">def</span> <span class="nf">max_profit</span><span class="p">(</span><span class="n">model_params</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>

    <span class="c1"># first stage variables</span>
    <span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">model_params</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">()</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)))</span>
    
    <span class="nd">@m</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">scenario</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>

        <span class="c1"># get model parameters for the scenario</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">model_params</span><span class="p">(</span><span class="o">**</span><span class="n">Z</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        
        <span class="c1"># second stage variables</span>
        <span class="n">b</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

        <span class="nd">@b</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">stage_net_profit</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;y3&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">t</span>
        
        <span class="nd">@b</span><span class="o">.</span><span class="n">Expression</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">profit</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">10</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">S</span><span class="p">[</span><span class="s2">&quot;profit&quot;</span><span class="p">][</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">S</span><span class="p">[</span><span class="s2">&quot;profit&quot;</span><span class="p">][</span><span class="s2">&quot;y2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;y2&quot;</span><span class="p">]</span>

        <span class="nd">@b</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">def</span> <span class="nf">model_constraints</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span>  <span class="nb">sum</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    
    <span class="c1"># worst case profit</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">min_profit</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span>
    
    <span class="n">solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;gurobi&#39;</span><span class="p">)</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<section id="comparing-the-worst-case-optimization-to-expected-profit-optimization">
<h2>Comparing the worst-case optimization to expected-profit optimization<a class="headerlink" href="#comparing-the-worst-case-optimization-to-expected-profit-optimization" title="Permalink to this heading">#</a></h2>
<p>As already said, for sake of stability analysis, we may be interested in how the optimal solution changes when we do make an assuption that every outcome of uncertainty is equally probably and that we optimize for the average cost, just as in problem (10.6) in the textbook:</p>
<p>\begin{align}
\min\limits_{x, y^j} \ &amp; c^\top x + \frac{1}{N} \sum\limits_{j = 1}^N q^\top y^j \
\text{s.t.} \ &amp; A x \leq b \
&amp; R ( z^j) x + S (z^j) y^j \leq t(z^j) &amp;\  j = 1, \ldots, N.
\end{align}</p>
<p>The following code is a slight modification of the earlier function that optimized for the worst-case solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">max_expected_profit</span><span class="p">(</span><span class="n">model_params</span><span class="p">,</span> <span class="n">Z</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>

    <span class="c1"># first stage variables</span>
    <span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">model_params</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)))</span>
    
    <span class="nd">@m</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">scenario</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>

        <span class="c1"># get model parameters for the scenario</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">model_params</span><span class="p">(</span><span class="o">**</span><span class="n">Z</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        
        <span class="c1"># second stage variables</span>
        <span class="n">b</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

        <span class="nd">@b</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">def</span> <span class="nf">model_constraints</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span>  <span class="nb">sum</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    
    <span class="c1"># worst case profit</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">min_profit</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">scenario</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;y3&quot;</span><span class="p">]()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    
    <span class="n">solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;gurobi&#39;</span><span class="p">)</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">max_expected_profit</span><span class="p">(</span><span class="n">model_params</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">min_profit</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>As we can see, the optimal to-order quantity of the raw material changes to…</p>
<p>Of course, this is only the comparison of the two approaches by looking at the first-stage decision. One can also be interested in the following two items:</p>
<ul class="simple">
<li><p>‘average-case performance’ of the optimal ordering decision of the robust solution - to find this one, one would need to fix this first-stage decision and for each of the sampled scenarios one would need to optimize the second-stage decisions, taking the average of their costs in the end. It is expected that the robust solution yields a slightly worse average-case performance than the stochastic one.</p></li>
<li><p>‘worst-case performance’ of the optimal ordering decision of the robust solution - to find this, one would need to use a function like the one we used to solve the robust solution, but fixing the first-stage decision to be the one obtained from the stochastic solution. In this way, the optimal worst-case second stage cost is computed, and the overall worst-case cost is expected to be slightly worse than that of the robust solution.</p></li>
</ul>
<p>We leave coding the relevant (minor) parts to perform the above analysis to the reader as an exercise.</p>
<p>Finally, we are ready to introduce the column-and-constraint generation approach of this chapter.</p>
</section>
<section id="column-and-constraint-generation-for-the-robust-solution">
<h2>Column and constraint generation for the robust solution<a class="headerlink" href="#column-and-constraint-generation-for-the-robust-solution" title="Permalink to this heading">#</a></h2>
<p>The downside of the approach of sampling many scenarios and solving the max-min optimization problem just as before is that it requires really many scenarios to be reasonably sure that we cover most of the extreme outcomes of <span class="math notranslate nohighlight">\(z\)</span>. This is exactly an issue that the CCG algorithm is supposed to mitigate against - the idea is to gradually build a list of scenarios that are `bad’ and hopefully, end up with solving a problem with far less than 1000 problem copies included.</p>
<p>In the pessimization step of the CCG, having solved problem \ref{ch10:complete.example.ccg.master} we want to find a new realization <span class="math notranslate nohighlight">\(z\)</span> where for each <span class="math notranslate nohighlight">\(i\)</span>, at least one of the rows in the constraint system
\begin{align*}
C(z^i) \bar{x} + D(z^i) \bar{y}^i \leq e(z^i)
\end{align*}
is violated. If we expand the terms in each of the rows and rewrite the constraints into a form that makes them easier to read as constraints on <span class="math notranslate nohighlight">\(z_A\)</span>, <span class="math notranslate nohighlight">\(z_B\)</span>, <span class="math notranslate nohighlight">\(z_D\)</span>, then we obtain that for each <span class="math notranslate nohighlight">\(i\)</span>, at least one of the four following has to hold:
\begin{align*}
(50 \bar{y}^i_1 + 50 \bar{y}^i_2) z_A + (80 \bar{y}_1^i + 40 \bar{y}_2^i) z_B &amp; &gt; -\bar{y}^i_3 + 140 \bar{y}^i_1 + 120 \bar{y}^i_2 &amp;&amp; \text{(profit)} \
20 z_D &amp; &gt; \bar{y}_1^i - 20 &amp;&amp; \text{(demand)} \
(y_1^i + y_2^i) z_A &amp; &gt; 80 - \bar{y}_1^i - \bar{y}_2^i &amp;&amp; \text{(labor A)} \
(2 y_1^i + y^i_2) z_B &amp; &gt; 100 - 2 \bar{y}_1^i - \bar{y}_2^i &amp;&amp; \text{(labor B)} \
\end{align*}
Using a sufficiently large number <span class="math notranslate nohighlight">\(M\)</span> and binary variables <span class="math notranslate nohighlight">\(u_{ik} \in \{0, 1\}\)</span> for each of them, we can formulate the problem of searching for an infeasible scenario as
\begin{align*}
\max \ &amp; \theta \
\text{s.t.} \ &amp;  (50 \bar{y}^i_1 + 50 y_2) z_A + (80 \bar{y}^i_1 + 40 \bar{y}^i_2) z_B - \theta \geq -\bar{y}_3^i + 140 \bar{y}_1^i + 120 \bar{y}<em>2^i - M u</em>{i1} &amp;&amp; \forall j \
&amp; 20 z_D - \theta \geq \bar{y}<em>1^i - 20 - M u</em>{i2} &amp;&amp; \forall j \
&amp; (\bar{y}_1^i + \bar{y}_2^i) z_A - \theta \geq 80 - \bar{y}<em>1^i - \bar{y}<em>2^i - M u</em>{i3} &amp;&amp; \forall j \
&amp; (2 \bar{y}<em>1^i + \bar{y}^i_2) z_B 100 - 2 \bar{y}<em>1^i - \bar{y}<em>2^i  - M u</em>{i4} &amp;&amp; \forall j \
&amp; \sum</em>{k = 1}^4 u</em>{ik} \leq 3 &amp;&amp; \forall j \
&amp; \theta \geq 0 \
&amp; u</em>{jk} \in { 0, 1} &amp;&amp; \forall j, k
\end{align*}
The following code snippet defines the data matrices needed to solve the above problem based on a list of first- and second-stage optimal variables from \ref{ch10:complete.example.ccg.master}.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">subproblem_params</span><span class="p">(</span><span class="n">dec</span><span class="p">):</span>

    <span class="n">Left</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;demand&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;z_A&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z_B&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z_D&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>
            <span class="s2">&quot;profit&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;z_A&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">50</span> <span class="o">*</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y2&quot;</span><span class="p">]),</span> <span class="s2">&quot;z_B&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">80</span> <span class="o">*</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y2&quot;</span><span class="p">]),</span> <span class="s2">&quot;z_D&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
             <span class="s2">&quot;labor A&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;z_A&quot;</span><span class="p">:</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y2&quot;</span><span class="p">],</span> <span class="s2">&quot;z_B&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z_D&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
             <span class="s2">&quot;labor B&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;z_A&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z_B&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y2&quot;</span><span class="p">],</span> <span class="s2">&quot;z_D&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}}</span>

    <span class="n">Right</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span>
             <span class="s2">&quot;profit&quot;</span><span class="p">:</span> <span class="mi">140</span> <span class="o">*</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">120</span> <span class="o">*</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y3&quot;</span><span class="p">],</span>
              <span class="s2">&quot;labor A&quot;</span><span class="p">:</span> <span class="mi">80</span> <span class="o">-</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y2&quot;</span><span class="p">],</span>
              <span class="s2">&quot;labor B&quot;</span><span class="p">:</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dec</span><span class="p">[</span><span class="s2">&quot;y2&quot;</span><span class="p">]}</span>

    <span class="k">return</span> <span class="n">Left</span><span class="p">,</span> <span class="n">Right</span>
</pre></div>
</div>
</div>
</div>
<p>The next code uses the above function to formulate the pessimization problem, where for extra flexibility we have included tha maximum values of the parameters deviations and the uncertainty budget as the function’s arguments. In the function (see the line marked as ‘hack for faster CCG convergence’) we in fact look for scenarios <span class="math notranslate nohighlight">\(z\)</span> that will make only the ‘feasibility’ constraints of the second-stage problem violated, without accounting for the ‘profit related’ proxy constraint. We do so in hope to accelerate the CCG convergence - the profit constraint will be taken care of anyway as the variable <span class="math notranslate nohighlight">\(y_3\)</span> can adapt freely for each newly generated <span class="math notranslate nohighlight">\(z^i\)</span> and each newly generated solution to the master problem, and at the same time, we eliminate the risk of iteratively building a list of scenarios <span class="math notranslate nohighlight">\(z\)</span> that violate only the profit constraints across all <span class="math notranslate nohighlight">\(i\)</span>, without actually hurting the feasibility of the production plans made.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pessimization_problem</span><span class="p">(</span><span class="n">subproblem_params</span><span class="p">,</span> <span class="n">master_solution</span><span class="p">,</span> <span class="n">z_A_max</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">z_B_max</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">z_D_max</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">Gamma</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    
    <span class="c1"># Initial definitions</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
    <span class="n">big_M</span> <span class="o">=</span> <span class="mi">1000</span>
    
    <span class="n">L</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">subproblem_params</span><span class="p">(</span><span class="n">master_solution</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># indices for the variables</span>
    <span class="n">m</span><span class="o">.</span><span class="n">Z_INDICES</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;z_A&quot;</span><span class="p">,</span> <span class="s2">&quot;z_B&quot;</span><span class="p">,</span> <span class="s2">&quot;z_D&quot;</span><span class="p">])</span>
    <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master_solution</span><span class="p">)))</span>
    
    <span class="c1"># indices for the scenarios</span>
    <span class="c1"># indices for inequalities</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">Z_INDICES</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Reals</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">z_abs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">Z_INDICES</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Reals</span><span class="p">)</span>
    
    <span class="c1"># Constraints on z itself</span>
    <span class="n">m</span><span class="o">.</span><span class="n">A_ub</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="s2">&quot;z_A&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">z_A_max</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">A_lb</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="s2">&quot;z_A&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">z_A_max</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">A_abs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="s2">&quot;z_A&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">z_abs</span><span class="p">[</span><span class="s2">&quot;z_A&quot;</span><span class="p">])</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">B_lb</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="s2">&quot;z_B&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">z_B_max</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">B_ub</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="s2">&quot;z_B&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">z_B_max</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">B_abs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="s2">&quot;z_B&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">z_abs</span><span class="p">[</span><span class="s2">&quot;z_B&quot;</span><span class="p">])</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">D_lb</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="s2">&quot;z_D&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">z_D_max</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">D_ub</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="s2">&quot;z_D&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">z_D_max</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">D_abs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="s2">&quot;z_D&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">z_abs</span><span class="p">[</span><span class="s2">&quot;z_D&quot;</span><span class="p">])</span>
    
    <span class="n">m</span><span class="o">.</span><span class="n">z_budget</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">z_abs</span><span class="p">[</span><span class="s2">&quot;z_A&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">z_A_max</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">z_abs</span><span class="p">[</span><span class="s2">&quot;z_B&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">z_B_max</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">z_abs</span><span class="p">[</span><span class="s2">&quot;z_D&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">z_D_max</span> <span class="o">&lt;=</span> <span class="n">Gamma</span><span class="p">)</span>
    
    <span class="c1">#, bounds = {&quot;z_A&quot;: (-0.15, 0.15),&quot;z_B&quot;: (-0.25, 0.25), &quot;z_D&quot;: (-0.5, 0.5)}</span>
    
    <span class="c1"># Constraint violation: blockwise</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">scenario</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="c1"># get model parameters for the scenario</span>
        <span class="n">L</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">subproblem_params</span><span class="p">(</span><span class="n">master_solution</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        
        <span class="c1"># second stage variables</span>
        <span class="n">b</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Binary</span><span class="p">)</span>
        
        <span class="c1"># hack for faster CCG convergence</span>
        <span class="nd">@b</span><span class="o">.</span><span class="n">Constraint</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">at_least_one_violated</span><span class="p">(</span><span class="n">b</span><span class="p">):</span> <span class="c1"># only care for violations related to the `actual&#39; constraints, not the profit constraint</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">L</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;profit&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="mi">2</span>

        <span class="nd">@b</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">def</span> <span class="nf">model_constraints</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span>  <span class="nb">sum</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">Z_INDICES</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="n">R</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">big_M</span>
    
    <span class="c1"># worst case profit</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">max_violation</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">theta</span>
    
    <span class="n">solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;gurobi&#39;</span><span class="p">)</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">theta</span><span class="p">(),</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="s2">&quot;z_A&quot;</span><span class="p">](),</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="s2">&quot;z_B&quot;</span><span class="p">](),</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="s2">&quot;z_D&quot;</span><span class="p">]()</span>
</pre></div>
</div>
</div>
</div>
<p>With the two functions above defined, we are ready to put them together into an implementation of the CCG algorithm. In the below code, we hard-limit the maximum number of iterations to 50 scenarios and we decide to stop the algorithm when the optimal value of the pessimization subproblem is less than 0.1 (constraint violation of 0.1 seems to be `acceptably small’ given the fact that the labor availability numbers are in the magnitude of 80 and 100, and the amount of raw material purchased is also expected to be in the hundreds, just like the optimal profit).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the code for the CCG algorithm</span>
<span class="n">ccg_converged</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">stopping_precision</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">max_iterations</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">ccg_iterations</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Initialize the null scenario - no perturbation</span>
<span class="n">Z</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;z_A&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z_B&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;z_D&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>

<span class="k">while</span><span class="p">((</span><span class="ow">not</span> <span class="n">ccg_converged</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ccg_iterations</span> <span class="o">&lt;</span> <span class="n">max_iterations</span><span class="p">)):</span>
    
    <span class="c1"># Building and solving the master problem</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">max_min_profit</span><span class="p">(</span><span class="n">model_params</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
    
    <span class="c1"># Exporting the data from the master problem into a list of dictionaries</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">model_params</span><span class="p">()</span>
    
    <span class="n">master_solution</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)):</span>
        <span class="n">single_solution</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">x_key</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">single_solution</span><span class="p">[</span><span class="n">x_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">x_key</span><span class="p">]()</span>
        
        <span class="k">for</span> <span class="n">y_key</span> <span class="ow">in</span> <span class="n">q</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">single_solution</span><span class="p">[</span><span class="n">y_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">scenario</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">y_key</span><span class="p">]()</span>
            
        <span class="n">master_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_solution</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">master_solution</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
    
    <span class="c1"># Pessimization</span>
    <span class="n">theta_opt</span><span class="p">,</span> <span class="n">z_A</span><span class="p">,</span> <span class="n">z_B</span><span class="p">,</span> <span class="n">z_D</span> <span class="o">=</span> <span class="n">pessimization_problem</span><span class="p">(</span><span class="n">subproblem_params</span><span class="p">,</span> <span class="n">master_solution</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># IF pessimization yields no violation, stop, otherwise add scenario</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">theta_opt</span> <span class="o">&lt;</span> <span class="n">stopping_precision</span><span class="p">):</span>
        <span class="n">ccg_converged</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Violation found: z_A = </span><span class="si">{</span><span class="n">z_A</span><span class="si">:</span><span class="s2">4.2f</span><span class="si">}</span><span class="s2">,  z_B = </span><span class="si">{</span><span class="n">z_B</span><span class="si">:</span><span class="s2">4.2f</span><span class="si">}</span><span class="s2">,  z_D = </span><span class="si">{</span><span class="n">z_D</span><span class="si">:</span><span class="s2">4.2f</span><span class="si">}</span><span class="s2">, constraint violation: </span><span class="si">{</span><span class="n">theta_opt</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;z_A&quot;</span><span class="p">:</span> <span class="n">z_A</span><span class="p">,</span> <span class="s2">&quot;z_B&quot;</span><span class="p">:</span> <span class="n">z_B</span><span class="p">,</span> <span class="s2">&quot;z_D&quot;</span><span class="p">:</span> <span class="n">z_D</span><span class="p">})</span>
    
    <span class="n">ccg_iterations</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-13-75b0c106a3e6&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> 
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="c1"># Building and solving the master problem</span>
<span class="ne">---&gt; </span><span class="mi">13</span>     <span class="n">m</span> <span class="o">=</span> <span class="n">max_min_profit</span><span class="p">(</span><span class="n">model_params</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> 
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="c1"># Exporting the data from the master problem into a list of dictionaries</span>

<span class="ne">NameError</span>: name &#39;max_min_profit&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>As we can see, it takes only 5 iterations, instead of 1000 scenarios, to arrive at an `almost’ robust solution which pretty much the same first-stage decisiona as in the first case.</p>
</section>
<section id="deprecated">
<h2>Deprecated<a class="headerlink" href="#deprecated" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Qty U&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Qty V&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">SCENARIOS</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">scenario</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">scenario</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">scenario</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;k.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>26.198683
7.0560933
0.0
20.757514
20.068052
14.827905
31.3327
9.48064
28.017703
6.2784533
17.439045
34.541082
32.33126
0.0
43.048848
31.745528
16.014391
23.863172
0.0
17.308388
28.067321
24.247131
48.600621
31.31583
45.365929
30.115037
6.4890862
13.22725
31.320777
33.915857
42.191805
16.497871
19.735968
10.734789
39.523543
11.892533
22.428385
18.980668
24.909472
20.712239
15.292546
28.815323
24.54802
9.9810791
2.737986
0.0
27.485174
50.134804
0.0
13.501614
33.912289
0.0
10.816643
2.9431181
9.2412851
34.331304
12.025608
24.151304
10.801697
16.251797
7.1420725
14.855333
0.0
13.190102
17.035114
28.074437
38.457392
33.104434
8.8997477
18.030732
34.273589
15.075443
32.923047
27.821987
48.7007
0.0
39.867193
6.9169826
16.749185
17.810623
14.425185
7.8925999
0.0
31.134832
14.866129
41.381879
28.093972
36.119335
15.594153
42.330463
31.055116
10.547169
22.67241
10.610095
30.81574
27.572791
24.727445
54.521721
38.861688
21.83798
22.566875
10.040019
4.4096529
30.646867
21.169396
27.425691
0.0
27.487826
16.717983
53.71695
31.437874
45.703378
47.498605
38.648729
17.070785
0.0
0.0
33.226556
33.548807
21.551715
29.307867
21.223372
22.974178
19.846858
23.40022
11.19706
16.581704
0.0
38.058794
31.7623
43.461575
35.263132
4.6671689
6.399691
33.906957
0.0
45.438334
31.825974
36.379896
38.112496
40.065867
23.131535
34.834963
15.704042
11.23431
14.314071
15.880481
33.765729
10.994309
23.292721
46.80339
17.881639
26.062474
11.308934
23.161388
20.238911
22.199283
34.812857
14.634303
25.374781
15.155333
34.335156
34.801381
25.922184
30.952476
47.090911
0.0
0.0
0.0
20.128202
26.84303
24.304756
40.955667
0.0
19.028301
10.414649
41.383387
30.065959
26.453971
26.387569
38.632121
29.628829
13.573409
23.997657
13.527379
45.664602
43.59086
0.0
9.1589523
0.0
6.8268293
6.5771875
15.025526
9.9455182
30.869194
9.362825
12.906372
35.546506
0.0
20.360952
34.678751
10.968046
43.871151
34.387757
30.205315
17.538457
40.506141
16.597565
9.7310974
26.507339
23.177501
23.851413
0.0
32.03996
12.621454
7.799356
0.0
0.0
36.460677
3.5629058
15.167916
29.863417
0.0
21.17318
25.918528
10.185476
12.355236
43.245215
36.53351
56.601089
32.904561
21.798646
20.810355
51.629606
20.167323
55.415085
16.341905
26.862934
34.916081
21.900887
23.991861
16.837949
24.759536
29.709148
26.082198
35.507185
35.939729
56.602102
31.876585
27.928452
39.718953
10.354654
16.966856
46.552099
34.259852
12.50829
13.817442
0.0
12.270482
30.055484
27.966761
9.0538713
28.746868
18.67526
35.714406
13.084078
26.514036
48.902295
18.198581
39.321218
12.410479
27.075413
48.24444
44.494273
23.472625
17.981197
30.622361
38.763789
0.0
21.474274
13.26311
58.710002
4.7620346
18.312664
14.692053
21.102604
30.918942
15.320316
11.761343
22.471217
16.081158
30.708089
28.431665
8.5442931
19.350641
52.36273
31.81547
7.7459944
8.8814888
0.0
58.785893
25.397213
22.274883
27.38132
26.568858
36.688987
47.00461
15.104757
17.120517
15.50343
9.682563
38.693219
0.0
0.0
25.949669
23.025662
19.943555
16.856317
37.222268
16.90204
9.2123966
20.700987
41.125042
14.09073
26.118215
18.694029
35.806833
34.870141
20.445247
30.273742
10.02144
0.0
18.019864
27.472645
6.1429107
0.0
12.011246
49.978081
15.759392
28.39829
15.594115
0.0
20.634327
21.240374
21.654648
6.8004397
16.251067
11.767268
13.017626
29.861033
18.479263
52.718598
34.964796
22.574477
45.878435
17.203859
9.0262366
30.83456
8.9362914
28.945565
31.135058
18.611404
37.181149
16.850256
16.580284
52.256584
0.0
40.912088
0.0
43.73817
28.114301
5.4088281
15.744154
15.303713
13.590926
30.900164
37.502956
40.856268
48.453372
10.44255
0.0
9.5427534
49.696578
43.770469
23.897241
0.0
9.4596782
23.369706
16.472427
39.917581
17.56843
23.338156
10.815729
8.642845
19.914866
37.514397
23.008423
45.107183
43.922302
8.5700689
39.660264
10.31535
6.660768
24.045135
14.432267
46.049729
20.052537
7.1676388
0.0
24.594721
58.926075
11.141085
11.286495
22.099585
0.0
14.697086
15.523307
56.946913
31.793045
24.794913
0.0
29.263215
6.7606636
16.415997
30.376066
14.602803
25.195823
34.553867
21.939645
16.104028
17.291864
39.167616
33.078142
20.08231
41.071667
23.789914
22.932757
23.624001
9.3900221
33.413005
16.479155
29.532174
10.895867
21.799606
16.703145
30.205406
18.980084
8.489037
16.830763
13.088776
40.984795
18.901111
41.1039
11.639466
25.51588
38.973234
11.833897
42.534899
47.285319
22.875837
0.0
18.298367
47.834875
0.0
33.549097
20.036835
21.018869
14.172215
13.669381
9.4005762
24.926467
14.888905
25.953471
0.0
11.143582
30.31791
47.364037
53.083308
32.801728
44.168482
33.512011
17.999247
23.741953
34.294544
43.228178
34.024343
25.613925
9.064066
24.907252
32.111892
22.090364
8.3355056
25.317022
38.15369
22.95055
13.853408
14.867366
29.318074
20.121519
18.217732
20.789768
39.525846
26.358609
0.0
45.133169
22.750456
39.089101
8.3642864
32.011153
22.059841
37.876683
10.693427
12.866398
20.482601
17.657625
15.982448
21.992944
34.937664
25.62331
20.068576
0.0
52.222742
26.240501
0.0
24.230099
0.0
28.27073
21.631687
25.231026
15.422203
24.207014
23.539074
35.850001
37.186101
10.963067
0.83431933
19.913564
21.9256
8.8179683
13.285281
46.529163
42.859294
29.830138
24.022085
45.854335
31.020946
39.156079
42.543583
31.410969
44.283138
17.303017
20.073912
17.330763
14.136825
14.028466
32.309343
24.078574
40.321736
26.594738
13.681389
46.487237
0.0
24.188343
37.856281
24.618326
15.568657
27.174392
30.911286
41.634861
17.576904
34.689705
44.655185
24.268599
14.339521
11.430595
21.788315
23.511874
31.678094
0.0
32.601487
0.0
8.3280581
25.175208
28.573891
19.000483
35.332454
31.203466
44.583269
43.870908
5.233799
29.479944
13.914142
44.519236
20.613369
0.0
26.233282
43.863978
23.019007
33.873368
37.028262
24.620963
30.565374
0.0
22.020481
15.079659
17.590612
34.116977
0.0
0.0
21.665712
13.359747
0.0
55.72868
46.174142
11.641566
18.027867
23.840554
37.646118
23.820232
0.0
0.0
5.6424763
23.014333
54.910234
0.0
0.0
27.100152
16.649858
25.151134
12.287627
41.644975
54.998019
38.029556
30.026626
27.391584
36.291242
40.301856
9.0210725
12.995344
28.601696
0.0
15.574887
0.0
6.3011515
25.925549
33.873183
7.8985455
13.031314
9.8492688
37.338571
28.82206
12.47134
18.073189
6.5319653
11.642368
23.53272
42.721874
20.14268
17.986234
0.0
35.919336
24.85692
0.0
7.918791
22.097425
10.231929
0.0
24.700285
3.902221
0.0
0.0
8.634032
0.0
8.7535851
8.0663387
0.0
6.3948183
0.0
21.515761
5.9907635
0.0
14.761983
22.661777
43.238447
29.102432
41.05509
14.254585
56.197039
48.562474
38.318189
24.291741
11.303912
29.071474
40.487142
54.543996
0.0
18.003785
12.163862
0.0
20.633926
43.916062
0.0
21.501222
23.00116
25.204593
6.8616892
56.445469
0.0
23.087356
21.605688
4.5172876
35.707663
17.485826
35.482308
29.203063
16.126574
0.0
29.034938
10.698369
9.1178889
12.177336
10.654045
41.165913
44.850547
23.762398
30.259385
20.914753
22.027416
22.116776
33.140607
19.602228
22.705961
17.765756
19.395335
32.981374
36.379803
11.412272
28.416686
25.865143
29.82372
35.303794
37.860666
36.525249
48.208284
38.343231
44.037107
14.672919
8.3051192
0.0
30.51527
35.196242
26.627131
33.672254
35.456321
42.780476
20.96245
44.885953
6.0240254
6.8078282
28.204814
13.487177
0.0
3.7265812
40.400694
25.247277
17.514581
18.530167
17.66907
26.104666
33.451889
14.207835
0.0
29.830594
0.07085777
53.926617
0.0
26.848972
9.7990799
43.820592
24.57551
43.576872
11.27171
15.028882
22.687098
34.964715
23.220141
21.388619
32.203362
9.9512089
13.968177
22.321545
0.0
0.0
10.823857
47.757678
29.554039
29.259416
23.645291
30.123573
41.162183
49.199396
20.963927
0.0
0.0
45.968789
7.8613767
18.157648
0.0
20.083237
10.708992
23.7955
25.635178
2.0896038
13.87863
14.955293
18.064328
39.777093
46.273662
14.101106
0.0
11.27001
18.196413
13.500835
7.1497991
0.0
50.849395
34.667371
26.540401
40.904828
28.954584
22.610052
31.915327
36.715296
21.368514
13.807505
24.625195
45.226859
33.19855
41.914554
28.673752
24.071373
20.184851
13.819376
47.753686
20.439741
9.9000533
0.0
22.40321
14.28885
20.205441
6.8259942
42.402668
22.903979
11.630011
45.796888
22.873322
12.660847
12.084459
14.900233
3.5165417
37.779313
15.848062
33.296469
56.490234
17.410138
28.611603
14.143104
22.519395
23.052972
41.869939
31.760711
0.0
22.07731
38.55081
12.389245
15.617859
9.1534883
29.96228
12.085351
29.536159
29.300442
11.588156
0.0
0.0
41.308011
53.786905
53.260737
13.28142
23.563308
30.350314
26.979592
23.227318
26.7528
36.523025
0.0
19.540646
23.701716
37.615828
21.992548
40.012946
34.776671
39.684307
0.0
9.2489725
44.253791
20.02816
0.0
26.886599
16.220537
23.684169
12.253441
40.105611
27.427093
17.146298
26.449998
42.975238
28.121021
39.12877
44.135629
36.415568
17.508191
22.557655
26.833616
41.270045
37.439237
24.7225
53.461372
24.102962
46.034621
30.54741
12.703281
26.340298
27.068209
0.0
32.217303
23.910205
13.069605
0.0
32.956682
0.0
30.616131
28.779075
38.607084
0.0
17.927997
34.470513
9.3066368
27.51661
20.419197
21.170944
34.304087
41.922395
17.810481
6.6889887
16.992036
6.6712256
16.01884
15.7729
37.422463
19.816141
7.1329979
30.458951
43.288157
20.022991
18.095112
24.812862
14.458216
38.744947
30.098405
45.177261
15.617812
42.71124
17.227814
21.37126
23.648995
0.0
9.1699242
8.1095392
44.147914
21.857482
40.811879
32.881613
51.435685
29.856851
15.038322
16.481726
16.861922
10.078857
25.261956
50.422232
8.9998698
10.47665
29.05878
22.229039
32.887781
0.0
11.609121
24.728892
12.225823
33.878461
</pre></div>
</div>
<img alt="../../_images/ccg_28_1.png" src="../../_images/ccg_28_1.png" />
</div>
</div>
</section>
<section id="bibliographic-notes">
<h2>Bibliographic Notes<a class="headerlink" href="#bibliographic-notes" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://link.springer.com/content/pdf/10.1007/s11750-021-00593-2.pdf">https://link.springer.com/content/pdf/10.1007/s11750-021-00593-2.pdf</a></p></li>
<li><p>Zeng, B., &amp; Zhao, L. (2013). Solving two-stage robust optimization problems using a column-and-constraint generation method. Operations Research Letters, 41(5), 457-461.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/10"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="10.00.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">10. Two-Stage Problems</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="airline-seating.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Airline seat allocation problem</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The MO Book Group<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>