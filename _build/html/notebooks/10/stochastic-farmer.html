
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Stochastic Programming &#8212; Companion Notebooks for Data-Driven Mathematical Optimization in Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Pyomo Style Guide" href="../../pyomo_style_guide.html" />
    <link rel="prev" title="Airline seat allocation problem" href="airline-seating.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DVQ7NZ8CYZ"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-DVQ7NZ8CYZ');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo-02.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Companion Notebooks for Data-Driven Mathematical Optimization in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Data-Driven Mathematical Optimization in Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/01.00.html">
   1. Mathematical Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/alice-rose.html">
     Alice’s Rose
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/Pop-Up-Shop.html">
     Scenario Analysis: Pop Up Shop
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/02.00.html">
   2. Linear Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/lad-regression.html">
     Least Absolute Deviation (LAD) Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/lad-regression-wine-quality.html">
     Predicting Wine Quality
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/making-the-best-of-the-worst.html">
     Making the Best of the Worst
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/mad-portfolio-optimization.html">
     MAD Portfolio Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/fractional-bim.html">
     Fractional BIM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/large-example-chapter-2.html">
     Caroline’s raw material planning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/03.00.html">
   3. Mixed Integer Linear Programming
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/cryptarithms.html">
     Cryptarithms: Send More Money
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/strip-packing.html">
     Strip Packing: Placing Boxes on a Shelf
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/simple-production-model-gdp.html">
     Production Model with Disjuncts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/recharging-electric-vehicle.html">
     Recharging Strategy for an Electric Vehicle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/Shift-Scheduling.html">
     Shift Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/machine-scheduling.html">
     Machine Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/job-shop-scheduling.html">
     Job Shop Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/maintenance-planning.html">
     Maintenance Planning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/large-example-chapter-3.html">
     BIM Production
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/04.00.html">
   4. Network Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/dina-tables-and-variations.html">
     Dina’s table seating arrangements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/Transportation.html">
     Transportation and Allocation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/forex-arbitrage.html">
     Forex Arbitrage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/cryptocurrency-arbitrage.html">
     Crypto Currency Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/shortest-path-road-networks.html">
     Computing a real life shortest path
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/complete-example-ch4-power-network.html">
     Energy dispatch problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05/05.00.html">
   5. Convex Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/milk-pooling.html">
     Pooling and Blending
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/ols-regression.html">
     Ordinary Least Squares (OLS) Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/markowitz_portfolio_with_chance_constraint.html">
     Portfolio optimization with chance constraint
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/refinery-production.html">
     Refinery Production and Shadow Pricing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/svm-linear.html">
     Support Vector Machines for Binary Classifcation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/06.00.html">
   6. Conic Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/economic-order-quantity.html">
     Economic Order Quantity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/07.00.html">
   7. Accounting for Uncertainty: Optimization Meets Reality
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/Caroline-robustness-analysis.html">
     Caroline on robust steroids
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08/08.00.html">
   8. Robust Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/ef-robust-optimization.html">
     Companion notebook to EF’s training on optimization with data uncertainty
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/09.00.html">
   9. Stochastic Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/newsvendor.html">
     Stock optimization for seafood distribution center
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/farmer.html">
     Exercise 1: Farmer’s problem and some of its variants
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="10.00.html">
   10. Two Stage Problems
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="airline-seating.html">
     Airline seat allocation problem
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Stochastic Programming
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pyomo_style_guide.html">
   Pyomo Style Guide
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/jckantor/MO-book/main?urlpath=tree/notebooks/10/stochastic-farmer.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/jckantor/MO-book/blob/main/notebooks/10/stochastic-farmer.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/10/stochastic-farmer.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#requirements">
   Requirements
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   Background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#key-concepts">
   Key Concepts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#infinite-dimensional-formulation">
     Infinite Dimensional Formulation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discrete-finite-dimensional-approximations">
     Discrete (Finite Dimensional) Approximations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sample-average-approximation">
     Sample Average Approximation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sparse-grids-worst-case">
     Sparse Grids (Worst Case)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#farmers-example">
   Farmers Example
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#perfect-information">
     Perfect information
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#include-uncertainty-in-the-two-stage-stochastic-program">
     Include uncertainty in the two-stage stochastic program
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evpi-and-vss">
     EVPI and VSS
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bibliographic-notes">
   Bibliographic Notes
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Stochastic Programming</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#requirements">
   Requirements
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   Background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#key-concepts">
   Key Concepts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#infinite-dimensional-formulation">
     Infinite Dimensional Formulation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discrete-finite-dimensional-approximations">
     Discrete (Finite Dimensional) Approximations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sample-average-approximation">
     Sample Average Approximation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sparse-grids-worst-case">
     Sparse Grids (Worst Case)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#farmers-example">
   Farmers Example
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#perfect-information">
     Perfect information
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#include-uncertainty-in-the-two-stage-stochastic-program">
     Include uncertainty in the two-stage stochastic program
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evpi-and-vss">
     EVPI and VSS
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bibliographic-notes">
   Bibliographic Notes
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="stochastic-programming">
<h1>Stochastic Programming<a class="headerlink" href="#stochastic-programming" title="Permalink to this headline">#</a></h1>
<p><em>This notebook is adapted, with permission, from Jailu Wang, University of Notre Dame. See Section 2.7,  <a class="reference external" href="https://ndcbe.github.io/CBE60499">CBE60499</a>; content is available <span class="xref myst">on Github</span>.</em></p>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install Tasmanian
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: Tasmanian in /Users/jeff/opt/anaconda3/lib/python3.9/site-packages (7.7.1)
Requirement already satisfied: numpy&gt;=1.10 in /Users/jeff/opt/anaconda3/lib/python3.9/site-packages (from Tasmanian) (1.21.2)
</pre></div>
</div>
</div>
</div>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">#</a></h2>
<p>Stochastic programming optimizes when some parameters are uncertain, but defined with a probability distribution. It is opposed to deterministic programming where all parameters are known.</p>
<p><span class="math notranslate nohighlight">\(\Xi\)</span>: random variable, results of an ‘experiment’</p>
<p><span class="math notranslate nohighlight">\(\xi\)</span>: a realization, i.e., outcome of a simple experiment</p>
<p>Each realization has an associated probability <span class="math notranslate nohighlight">\(p(\xi)\)</span>. <span class="math notranslate nohighlight">\(\Theta\)</span> is the set of all possible realizations, <span class="math notranslate nohighlight">\(\xi \in \Theta\)</span>.</p>
<p>Let <span class="math notranslate nohighlight">\(x\)</span> be stage 1 decision varialbes, <span class="math notranslate nohighlight">\(y\)</span> be stage 2 decision variables, a deterministic optimization problem is formed as:</p>
<p><span class="math notranslate nohighlight">\(\min f(x,y,w)\)</span></p>
<p><span class="math notranslate nohighlight">\(\ \ \ \ \ \  g(x,y,w) \leq 0\)</span></p>
<p><span class="math notranslate nohighlight">\(\ \ \ \ \ \  u(x,y,w) = 0\)</span></p>
<p>When the parameters <span class="math notranslate nohighlight">\(w\)</span> are uncertain, the corresponding stochastic optimization problem is formed as:</p>
<p><span class="math notranslate nohighlight">\(\min E[f(x,y,\Xi)]\)</span></p>
<p><span class="math notranslate nohighlight">\(\ \ \ \ \ \  g(x,y,\Xi) \leq 0\)</span></p>
<p><span class="math notranslate nohighlight">\(\ \ \ \ \ \  u(x,y,\Xi) = 0\)</span></p>
</section>
<section id="key-concepts">
<h2>Key Concepts<a class="headerlink" href="#key-concepts" title="Permalink to this headline">#</a></h2>
<section id="infinite-dimensional-formulation">
<h3>Infinite Dimensional Formulation<a class="headerlink" href="#infinite-dimensional-formulation" title="Permalink to this headline">#</a></h3>
<p>Continuous random variables have the key property:</p>
<p><span class="math notranslate nohighlight">\(0 \leq p(\xi) \leq 1\)</span> for all <span class="math notranslate nohighlight">\(\xi \in \Theta\)</span></p>
<p><span class="math notranslate nohighlight">\(\int p(\xi) d\xi = 1\)</span></p>
<p>The expectation is formed as:</p>
<p><span class="math notranslate nohighlight">\(E_{\Xi} = \int_{\Xi} f(\xi) P_{\Xi}(\xi) d\xi\)</span></p>
</section>
<section id="discrete-finite-dimensional-approximations">
<h3>Discrete (Finite Dimensional) Approximations<a class="headerlink" href="#discrete-finite-dimensional-approximations" title="Permalink to this headline">#</a></h3>
<p>Discrete random variables have the key property:</p>
<p><span class="math notranslate nohighlight">\(0 \leq p(\xi) \leq 1\)</span> for all <span class="math notranslate nohighlight">\(\xi \in \Theta\)</span></p>
<p><span class="math notranslate nohighlight">\(\sum p(\xi) = 1\)</span></p>
<p>The expectation of it:</p>
<p><span class="math notranslate nohighlight">\(E_{\Xi} = \sum_{\Xi} f(\xi) w(\xi)\)</span></p>
</section>
<section id="sample-average-approximation">
<h3>Sample Average Approximation<a class="headerlink" href="#sample-average-approximation" title="Permalink to this headline">#</a></h3>
<p>Sample average approximation (SAA) method is an approach for solving stochastic optimization problems by Monte Carlo simulation. It approximates the expected objective function of the stochastic problem by a sample average estimate derived from a random sample. The resulting sample average approximation problem is then solved by deterministic optimization techniques.</p>
<p>Consider a stochastic program in the following form:</p>
<p><span class="math notranslate nohighlight">\(z = \inf \int_{\Xi} g(x,\xi) P(d\xi)\)</span></p>
<p>The optimal solution <span class="math notranslate nohighlight">\(x^*\)</span> will have optimal value <span class="math notranslate nohighlight">\(z^*\)</span>. SAA consider a sample <span class="math notranslate nohighlight">\({\xi^i}\)</span> of independent observations of <span class="math notranslate nohighlight">\(\xi\)</span>:</p>
<p><span class="math notranslate nohighlight">\(z^{\nu} = \inf \frac{1}{\nu} \sum_{i=1}^{\nu} g(x,\xi^i)\)</span></p>
<p>Where <span class="math notranslate nohighlight">\(x^{\nu}\)</span> is the random vector of solutions with independent random samples, <span class="math notranslate nohighlight">\(\xi^i\)</span>, <span class="math notranslate nohighlight">\(i=1,...,\nu\)</span>.</p>
</section>
<section id="sparse-grids-worst-case">
<h3>Sparse Grids (Worst Case)<a class="headerlink" href="#sparse-grids-worst-case" title="Permalink to this headline">#</a></h3>
<p>Instead of Monte carlo sampling, sparse grids can be used to obtain efficient characterizations of the integrals in stochastic programs. Many computational problems are solved on full grids. While this is feasible if the dimentionality <span class="math notranslate nohighlight">\(d\)</span> of the problem is low, 2 or 3, full grids become very expensive when facing a higher dimentional problem <span class="math notranslate nohighlight">\(d&gt;4\)</span>. This is due to the curse of dimensionality, which states that the complexity of full grids grows exponentially with <span class="math notranslate nohighlight">\(d\)</span>.</p>
<p>Sparse grids defeat the curse of dimentionality and allow the solution of the problems with much smaller effort. It is constructed by extending one-dimensional quadrature rules to higher dimensions. Gaussian quadrature rule is one of these rules to approximate the definite integral of a function. It is usually a weighted sum of function values at specified points within the domain of integration, stated as:</p>
<p><span class="math notranslate nohighlight">\(\int f(x)dx \approx \sum_{i=1}^{n} \omega_i f(x_i) \)</span></p>
<p>Comparison between 2-point Gaussian and trapezoidal quadrature. For the polynomial:</p>
<p><span class="math notranslate nohighlight">\(y(x) = 7x^3-8x^2-3x+3\)</span></p>
<p>whose integral in [-1,1] is <span class="math notranslate nohighlight">\(\frac{2}{3}\)</span>.</p>
<p>The trapezoidal rule returns the integral of the orange dashed line:</p>
<p><span class="math notranslate nohighlight">\(y(-1)+y(1) = -10\)</span></p>
<p>The 2-point Gaussian quadrature returns the integral of the black dashed curve, equal to:</p>
<p><span class="math notranslate nohighlight">\(y(-\sqrt{\frac{1}{3}}) + y(\sqrt{\frac{1}{3}}) = \frac{2}{3}\)</span></p>
<p><img alt="sg1" src="notebooks/10/fig/sg-2.png" />
Figure from [1]</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">Tasmanian</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># define bounds for integration</span>
<span class="n">UB</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">LB</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="c1"># function</span>
<span class="n">y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">7</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="mi">8</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mi">3</span>

<span class="c1"># integrated function </span>
<span class="n">int_y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1.75</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span><span class="o">-</span><span class="mi">8</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">x</span>

<span class="c1"># real area </span>
<span class="n">real_S</span> <span class="o">=</span> <span class="n">int_y</span><span class="p">(</span><span class="n">UB</span><span class="p">)</span> <span class="o">-</span> <span class="n">int_y</span><span class="p">(</span><span class="n">LB</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The area:&#39;</span><span class="p">,</span> <span class="n">real_S</span><span class="p">)</span>

<span class="c1"># area calculated by trapezoidal rule</span>
<span class="n">trap_S</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">UB</span><span class="p">)</span><span class="o">+</span><span class="n">y</span><span class="p">(</span><span class="n">LB</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">UB</span><span class="o">-</span><span class="n">LB</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The area calculated by trapezoidal rule:&#39;</span><span class="p">,</span> <span class="n">trap_S</span><span class="p">)</span>

<span class="c1"># generate sparse grids</span>
<span class="n">range_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">LB</span><span class="p">,</span><span class="n">UB</span><span class="p">]])</span>
<span class="n">grid_p</span> <span class="o">=</span> <span class="n">Tasmanian</span><span class="o">.</span><span class="n">SparseGrid</span><span class="p">()</span>
<span class="n">grid_p</span><span class="o">.</span><span class="n">makeGlobalGrid</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;level&#39;</span><span class="p">,</span><span class="s1">&#39;gauss-legendre&#39;</span><span class="p">)</span>
<span class="n">grid_p</span><span class="o">.</span><span class="n">setDomainTransform</span><span class="p">(</span><span class="n">range_p</span><span class="p">)</span>
<span class="n">points_p</span> <span class="o">=</span> <span class="n">grid_p</span><span class="o">.</span><span class="n">getPoints</span><span class="p">()</span>
<span class="n">weights_p</span> <span class="o">=</span> <span class="n">grid_p</span><span class="o">.</span><span class="n">getQuadratureWeights</span><span class="p">()</span>
<span class="c1"># area calculated by sparse grids</span>
<span class="n">gauss_S</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">point</span><span class="p">)</span><span class="o">*</span><span class="n">weights_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points_p</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The area calculated by Gauss rule:&#39;</span><span class="p">,</span> <span class="n">gauss_S</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">OSError</span><span class="g g-Whitespace">                                   </span>Traceback (most recent call last)
<span class="nn">Input In [5],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">Tasmanian</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">Tasmanian</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span> <span class="kn">from</span> <span class="nn">TasmanianConfig</span> <span class="kn">import</span> <span class="n">TasmanianInputError</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span> <span class="n">InputError</span> <span class="o">=</span> <span class="n">TasmanianInputError</span>
<span class="ne">---&gt; </span><span class="mi">40</span> <span class="kn">from</span> <span class="nn">TasmanianSG</span> <span class="kn">import</span> <span class="o">*</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span> <span class="n">SparseGrid</span> <span class="o">=</span> <span class="n">TasmanianSparseGrid</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span> <span class="kn">import</span> <span class="nn">TasmanianDREAM</span> <span class="k">as</span> <span class="nn">DREAM</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">TasmanianSG</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="kn">from</span> <span class="nn">TasmanianConfig</span> <span class="kn">import</span> <span class="n">TasmanianInputError</span><span class="p">,</span> <span class="n">__path_libsparsegrid__</span>
<span class="ne">---&gt; </span><span class="mi">36</span> <span class="n">pLibTSG</span> <span class="o">=</span> <span class="n">cdll</span><span class="o">.</span><span class="n">LoadLibrary</span><span class="p">(</span><span class="n">__path_libsparsegrid__</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span> <span class="c1"># The ctypes library requires that we manually specify the return types of functions. In C, this is done by header files, so the</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span> <span class="c1"># declarations below serve as a header.</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span> 
<span class="g g-Whitespace">     </span><span class="mi">41</span> <span class="c1"># Return types for TasmanianSparseGrid C class methods.</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span> <span class="n">pLibTSG</span><span class="o">.</span><span class="n">tsgConstructTasmanianSparseGrid</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_void_p</span>

<span class="nn">File ~/opt/anaconda3/lib/python3.9/ctypes/__init__.py:460,</span> in <span class="ni">LibraryLoader.LoadLibrary</span><span class="nt">(self, name)</span>
<span class="g g-Whitespace">    </span><span class="mi">459</span> <span class="k">def</span> <span class="nf">LoadLibrary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">460</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dlltype</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="nn">File ~/opt/anaconda3/lib/python3.9/ctypes/__init__.py:382,</span> in <span class="ni">CDLL.__init__</span><span class="nt">(self, name, mode, handle, use_errno, use_last_error, winmode)</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FuncPtr</span> <span class="o">=</span> <span class="n">_FuncPtr</span>
<span class="g g-Whitespace">    </span><span class="mi">381</span> <span class="k">if</span> <span class="n">handle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">382</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="o">=</span> <span class="n">_dlopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">383</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">384</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="o">=</span> <span class="n">handle</span>

<span class="ne">OSError</span>: dlopen(/Users/jeff/.local/lib/libtasmaniansparsegrid.dylib, 0x0006): tried: &#39;/Users/jeff/.local/lib/libtasmaniansparsegrid.dylib&#39; (no such file), &#39;/usr/local/lib/libtasmaniansparsegrid.dylib&#39; (no such file), &#39;/usr/lib/libtasmaniansparsegrid.dylib&#39; (no such file)
</pre></div>
</div>
</div>
</div>
<p>How to choose quadrature rules for sparse grids depends on how the problem is formed. A guidance on how to choose the one dimensional quadrature rule can be found in:
<a class="reference external" href="https://tasmanian.ornl.gov/documentation/group__SGEnumerates.html#ga145e27d5ae92acdd5f74149c6d4f2ca2">https://tasmanian.ornl.gov/documentation/group__SGEnumerates.html#ga145e27d5ae92acdd5f74149c6d4f2ca2</a></p>
<p>The following example shows several example quadrature rules:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_sparse_grids</span><span class="p">(</span><span class="n">range_p</span><span class="p">,</span><span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="s1">&#39;gauss-legendre&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function shows the sparse grids generated with different rules</span>
<span class="sd">    Arguments:</span>
<span class="sd">        range_p: dimension ranges </span>
<span class="sd">        dim: sparse grids dimension</span>
<span class="sd">        output: output level</span>
<span class="sd">        depth: depth level</span>
<span class="sd">        rule: quadrature rules</span>
<span class="sd">    Return: </span>
<span class="sd">        None</span>
<span class="sd">    Other:</span>
<span class="sd">        A figure shows 2D sparse grids</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">grid_p</span> <span class="o">=</span> <span class="n">Tasmanian</span><span class="o">.</span><span class="n">SparseGrid</span><span class="p">()</span>
    <span class="n">grid_p</span><span class="o">.</span><span class="n">makeGlobalGrid</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span><span class="n">output</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="s1">&#39;level&#39;</span><span class="p">,</span><span class="n">rule</span><span class="p">)</span>
    <span class="n">grid_p</span><span class="o">.</span><span class="n">setDomainTransform</span><span class="p">(</span><span class="n">range_p</span><span class="p">)</span>
    <span class="n">points_p</span> <span class="o">=</span> <span class="n">grid_p</span><span class="o">.</span><span class="n">getPoints</span><span class="p">()</span>
    <span class="n">weights_p</span> <span class="o">=</span> <span class="n">grid_p</span><span class="o">.</span><span class="n">getQuadratureWeights</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points_p</span><span class="p">)):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">points_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">points_p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sparse girds of &#39;</span><span class="o">+</span><span class="n">rule</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="n">range_fix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">50</span><span class="p">,</span><span class="mi">220</span><span class="p">],[</span><span class="mi">300</span><span class="p">,</span><span class="mi">600</span><span class="p">]])</span>
<span class="n">show_sparse_grids</span><span class="p">(</span><span class="n">range_fix</span><span class="p">)</span>
<span class="n">show_sparse_grids</span><span class="p">(</span><span class="n">range_fix</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="s1">&#39;gauss-hermite&#39;</span><span class="p">)</span>
<span class="n">show_sparse_grids</span><span class="p">(</span><span class="n">range_fix</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="s1">&#39;chebyshev&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 26&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>         <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sparse girds of &#39;</span><span class="o">+</span><span class="n">rule</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">26</span> <span class="n">range_fix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">50</span><span class="p">,</span><span class="mi">220</span><span class="p">],[</span><span class="mi">300</span><span class="p">,</span><span class="mi">600</span><span class="p">]])</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="n">show_sparse_grids</span><span class="p">(</span><span class="n">range_fix</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="n">show_sparse_grids</span><span class="p">(</span><span class="n">range_fix</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="s1">&#39;gauss-hermite&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;np&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The following figure shows sparse grid on the top, and Monte Carlo samples on the bottom. Left graphs contain 441 scenarios, and the right graphs contain 1073 scenarios. Sparse grids can efficiently cover the domain and lead to higher convergence rates.</p>
<p><img alt="sg1" src="notebooks/10/fig/sg-1.png" />
Figure from [2]</p>
</section>
</section>
<section id="farmers-example">
<h2>Farmers Example<a class="headerlink" href="#farmers-example" title="Permalink to this headline">#</a></h2>
<p><img alt="ex1" src="notebooks/10/fig/farmer1.png" />
<img alt="ex1.1" src="notebooks/10/fig/farmer2.png" />
<img alt="ex1.2" src="notebooks/10/fig/farmer3.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">### Solve the perfect information optimization problem</span>

<span class="k">def</span> <span class="nf">build_model</span><span class="p">(</span><span class="n">yields</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Code adapted from https://mpi-sppy.readthedocs.io/en/latest/examples.html#examples</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        yields: Yield information as a list, following the rank [wheat, corn, beets]</span>
<span class="sd">        </span>
<span class="sd">    Return: </span>
<span class="sd">        model: farmer problem model </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>
    
    <span class="c1"># Define sets</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CROPS</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;CORN&quot;</span><span class="p">,</span> <span class="s2">&quot;BEETS&quot;</span><span class="p">])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">PURCHASE</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;CORN&quot;</span><span class="p">])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">SELL</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;CORN&quot;</span><span class="p">,</span> <span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span> <span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">])</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">CROPS</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">PURCHASE</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">SELL</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="c1"># Objective function</span>
    <span class="nd">@model</span><span class="o">.</span><span class="n">Expression</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">planting_cost</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">150</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">230</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">260</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">]</span>
    
    <span class="nd">@model</span><span class="o">.</span><span class="n">Expression</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">purchase_cost</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">238</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">210</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">]</span>
    <span class="n">model</span><span class="o">.</span><span class="n">SALES_REVENUE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">170</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">150</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">]</span>
        <span class="o">+</span> <span class="mi">36</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># Maximize the Obj is to minimize the negative of the Obj</span>
    <span class="n">model</span><span class="o">.</span><span class="n">OBJ</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">PLANTING_COST</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">PURCHASE_COST</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">SALES_REVENUE</span><span class="p">,</span>
        <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span>
    <span class="p">)</span>

    <span class="c1"># Constraints</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">=</span> <span class="n">ConstraintList</span><span class="p">()</span>

    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">summation</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">yields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">200</span>
    <span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">yields</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">240</span>
    <span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">yields</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setub</span><span class="p">(</span><span class="mi">6000</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<section id="perfect-information">
<h3>Perfect information<a class="headerlink" href="#perfect-information" title="Permalink to this headline">#</a></h3>
<p>With the ‘perfect’ information shown in the table above, the optimization problem is formed as:</p>
<p><img alt="ex1.2" src="notebooks/10/fig/farmer2-0.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perfect yields </span>
<span class="n">yields_perfect</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">yields_perfect</span><span class="p">)</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">SolverFactory</span><span class="p">(</span><span class="s2">&quot;ipopt&quot;</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># The Obj is a negative number for minimizing </span>
<span class="n">profit_perfect</span> <span class="o">=</span> <span class="o">-</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">OBJ</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===Optimal solutions based on perfect information===&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Culture.         | &#39;</span><span class="p">,</span> <span class="s1">&#39;Wheat |&#39;</span><span class="p">,</span> <span class="s1">&#39;Corn  |&#39;</span><span class="p">,</span> <span class="s1">&#39;Sugar Beets |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Surface (acres)  | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; |&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yield (T)        | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_perfect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_perfect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_perfect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sales (T)        | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Purchases (T)    | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span>
       <span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;     |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Overall profit: $&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">profit_perfect</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>===Optimal solutions based on perfect information===
Culture.         |  Wheat | Corn  | Sugar Beets |
Surface (acres)  |  120.0 | 80.0  | 300.0  |
Yield (T)        |  300.0 | 240.0 | 6000.0 |
Sales (T)        |  100.0 | 0.0   | 6000.0 |
Purchases (T)    |  0.0   | 0.0   | -      |
Overall profit: $ 118600.0
</pre></div>
</div>
</div>
</div>
<p>The optimal solution based on perfect information is:</p>
<p><img alt="ex1.2" src="notebooks/10/fig/farmer2-1.png" /></p>
<p>This solution is easy to understand:</p>
<ul class="simple">
<li><p>The farmer devotes enough land to sugar beets to reach the quota of 6000 T</p></li>
<li><p>Devote enough land to wheat and corn production to meet the feeding requirement</p></li>
<li><p>Plant wheat in the rest of the land</p></li>
</ul>
<p>However, there are often some ‘real world’ constraints that break the perfect information heuristic:</p>
<ul class="simple">
<li><p>Market prices change</p></li>
<li><p>Yield is uncertain</p></li>
<li><p>Planting cost materials, water, labor…</p></li>
<li><p>Crop rotation</p></li>
</ul>
<p>A representation of the uncertainty would be to assume that years are good, fair, or bad for all crops, resulting in above average, average, or below average yields for all crops. Three scenarios are defined as:</p>
<ul class="simple">
<li><p>Above average yield (+20%)</p></li>
<li><p>Average yield (base case)</p></li>
<li><p>Below average yield (-20%)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Run Above average case</span>
<span class="n">yields_above</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.5</span><span class="o">*</span><span class="mf">1.2</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="mf">1.2</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="mf">1.2</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">yields_above</span><span class="p">)</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">SolverFactory</span><span class="p">(</span><span class="s2">&quot;ipopt&quot;</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="n">profit_above</span> <span class="o">=</span> <span class="o">-</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">OBJ</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===Optimal solutions based on above average yields (-20%)===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Culture.         | &#39;</span><span class="p">,</span> <span class="s1">&#39;Wheat |&#39;</span><span class="p">,</span> <span class="s1">&#39;Corn  |&#39;</span><span class="p">,</span> <span class="s1">&#39;Sugar Beets |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Surface (acres)  | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; |&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yield (T)        | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_above</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_above</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_above</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sales (T)        | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Purchases (T)    | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span>
       <span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;     |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Overall profit: $&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">profit_above</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>===Optimal solutions based on above average yields (-20%)===
Culture.         |  Wheat | Corn  | Sugar Beets |
Surface (acres)  |  183.3 | 66.7  | 250.0  |
Yield (T)        |  550.0 | 240.0 | 6000.0 |
Sales (T)        |  350.0 | 0.0   | 6000.0 |
Purchases (T)    |  0.0   | 0.0   | -      |
Overall profit: $ 167666.7
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Run Below average case</span>
<span class="n">yields_below</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.5</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="mf">0.8</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">yields_below</span><span class="p">)</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">SolverFactory</span><span class="p">(</span><span class="s2">&quot;ipopt&quot;</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="n">profit_below</span> <span class="o">=</span> <span class="o">-</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">OBJ</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===Optimal solutions based on below average yields (-20%)===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Culture.         | &#39;</span><span class="p">,</span> <span class="s1">&#39;Wheat |&#39;</span><span class="p">,</span> <span class="s1">&#39;Corn  |&#39;</span><span class="p">,</span> <span class="s1">&#39;Sugar Beets |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Surface (acres)  | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; |&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yield (T)        | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_below</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_below</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_below</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sales (T)        | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Purchases (T)    | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span>
       <span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;     |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Overall profit: $&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">profit_below</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>===Optimal solutions based on below average yields (-20%)===
Culture.         |  Wheat | Corn  | Sugar Beets |
Surface (acres)  |  100.0 | 25.0  | 375.0  |
Yield (T)        |  200.0 | 60.0 | 6000.0 |
Sales (T)        |  0.0 | 0.0   | 6000.0 |
Purchases (T)    |  0.0   | 180.0   | -      |
Overall profit: $ 59950.0
</pre></div>
</div>
</div>
</div>
<p>Running the optimization problem based on above average and below average yields gives optimal solutions:</p>
<p><img alt="ex1.2" src="notebooks/10/fig/farmer2-2.png" /></p>
<p>The solutions again seem natural. When yields are high, smaller surfaces are needed to raise the minimum requirements in wheat and corn and the sugar beet quota. The remaining land is devoted to wheat, whose extra production is sold. When yields are low, larger surfaces are needed to raise the minimum requirements and the sugar beet quota.</p>
<p>Unfortunately, weather conditions cannot be accurately predicted six months ahead. The farmer must make up his mind without perfect information on yields!</p>
</section>
<section id="include-uncertainty-in-the-two-stage-stochastic-program">
<h3>Include uncertainty in the two-stage stochastic program<a class="headerlink" href="#include-uncertainty-in-the-two-stage-stochastic-program" title="Permalink to this headline">#</a></h3>
<p>Now the farmer wants to assess the benefits and losses of each decision in each situation.</p>
<p>Decisions on land assignment (<span class="math notranslate nohighlight">\(x_1\)</span>, <span class="math notranslate nohighlight">\(x_2\)</span>, <span class="math notranslate nohighlight">\(x_3\)</span>) have to be taken now, but sales and purchases (<span class="math notranslate nohighlight">\(w_i, i=1,...,4\)</span>, <span class="math notranslate nohighlight">\(y_j, j=1,2\)</span>) depend on the yields. This forms the two-stage stochastic program:</p>
<ol class="simple">
<li><p>Stage 1 decisions: land assignments (<span class="math notranslate nohighlight">\(x_1\)</span>, <span class="math notranslate nohighlight">\(x_2\)</span>, <span class="math notranslate nohighlight">\(x_3\)</span>)</p></li>
<li><p>Uncertainty is realized</p></li>
<li><p>Stage 2 decisions: wait-and-see (sales and purchases)</p></li>
</ol>
<p>It is useful to index those decisions by a scenario index <span class="math notranslate nohighlight">\(s=1,2,3\)</span> according to above average, average or below average yields, respectively. This creates a new set of variables <span class="math notranslate nohighlight">\(w_{is}, i=1,2,3,4, s=1,2,3\)</span> and <span class="math notranslate nohighlight">\(y_{js}, j=1,2, s=1,2,3.\)</span> For e.g., <span class="math notranslate nohighlight">\(w_{32}\)</span> represents the amount of sugar beets sold at the favorable price if yields are average.</p>
<p>It the three scenarios have an equal probability of 1/3, the farmer’s problem is formed as:</p>
<p><img alt="ex1.2" src="notebooks/10/fig/farmer3-1.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_sp_model</span><span class="p">(</span><span class="n">yields</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Code adapted from https://mpi-sppy.readthedocs.io/en/latest/examples.html#examples</span>
<span class="sd">    It specifies the extensive form of the two-stage stochastic programming</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        yields: Yield information as a list, following the rank [wheat, corn, beets]</span>
<span class="sd">        </span>
<span class="sd">    Return: </span>
<span class="sd">        model: farmer problem model </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>
    
    <span class="n">all_crops</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;CORN&quot;</span><span class="p">,</span> <span class="s2">&quot;BEETS&quot;</span><span class="p">]</span>
    <span class="n">purchase_crops</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;CORN&quot;</span><span class="p">]</span>
    <span class="n">sell_crops</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;CORN&quot;</span><span class="p">,</span> <span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span> <span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">]</span>
    <span class="n">scenarios</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">]</span>
    
    <span class="c1"># Fields allocation</span>
    <span class="n">model</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">all_crops</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="c1"># How many tons of crops to purchase in each scenario</span>
    <span class="n">model</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">purchase_crops</span><span class="p">,</span> <span class="n">scenarios</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>
    <span class="c1"># How many tons of crops to sell in each scenario</span>
    <span class="n">model</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">sell_crops</span><span class="p">,</span> <span class="n">scenarios</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="c1"># Objective function</span>
    <span class="n">model</span><span class="o">.</span><span class="n">PLANTING_COST</span> <span class="o">=</span> <span class="mi">150</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">230</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">260</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">]</span>
    <span class="n">model</span><span class="o">.</span><span class="n">PURCHASE_COST_ABOVE</span> <span class="o">=</span> <span class="mi">238</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;ABOVE&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">210</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">]</span>
    <span class="n">model</span><span class="o">.</span><span class="n">SALES_REVENUE_ABOVE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">170</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;ABOVE&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">150</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">]</span>
        <span class="o">+</span> <span class="mi">36</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">])</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">PURCHASE_COST_AVE</span> <span class="o">=</span> <span class="mi">238</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;AVERAGE&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">210</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">]</span>
    <span class="n">model</span><span class="o">.</span><span class="n">SALES_REVENUE_AVE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">170</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;AVERAGE&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">150</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">]</span>
        <span class="o">+</span> <span class="mi">36</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">])</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">PURCHASE_COST_BELOW</span> <span class="o">=</span> <span class="mi">238</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;BELOW&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">210</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">]</span>
    <span class="n">model</span><span class="o">.</span><span class="n">SALES_REVENUE_BELOW</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">170</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span> <span class="s2">&quot;BELOW&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">150</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">]</span>
        <span class="o">+</span> <span class="mi">36</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">])</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">OBJ</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span>
        <span class="n">expr</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">PLANTING_COST</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">PURCHASE_COST_ABOVE</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">PURCHASE_COST_AVE</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">PURCHASE_COST_BELOW</span><span class="p">)</span>
        <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">SALES_REVENUE_ABOVE</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">SALES_REVENUE_AVE</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">SALES_REVENUE_BELOW</span><span class="p">),</span>
        <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span>
    <span class="p">)</span>

    <span class="c1"># Constraints</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">=</span> <span class="n">ConstraintList</span><span class="p">()</span>

    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">summation</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">yields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">yields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">yields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">200</span><span class="p">)</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">yields</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">240</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">yields</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">240</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">yields</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">240</span><span class="p">)</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">yields</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">yields</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">CONSTR</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">yields</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="p">)</span>
    
    
    <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setub</span><span class="p">(</span><span class="mi">6000</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setub</span><span class="p">(</span><span class="mi">6000</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setub</span><span class="p">(</span><span class="mi">6000</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### calculate two-stage stochastic problem</span>
<span class="n">yields_perfect</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">build_sp_model</span><span class="p">(</span><span class="n">yields_perfect</span><span class="p">)</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">SolverFactory</span><span class="p">(</span><span class="s2">&quot;ipopt&quot;</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="n">profit_2stage</span> <span class="o">=</span> <span class="o">-</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">OBJ</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===Optimal solutions of two-stage stochastic problem===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Culture.         | &#39;</span><span class="p">,</span> <span class="s1">&#39;Wheat |&#39;</span><span class="p">,</span> <span class="s1">&#39;Corn  |&#39;</span><span class="p">,</span> <span class="s1">&#39;Sugar Beets |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Surface (acres)  | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; |&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First stage: s=1 (Above average)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Culture.         | &#39;</span><span class="p">,</span> <span class="s1">&#39;Wheat |&#39;</span><span class="p">,</span> <span class="s1">&#39;Corn  |&#39;</span><span class="p">,</span> <span class="s1">&#39;Sugar Beets |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yield (T)        | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_perfect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1.2</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_perfect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.2</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_perfect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">1.2</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sales (T)        | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Purchases (T)    | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;ABOVE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span>
       <span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;     |&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First stage: s=2 (Average average)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Culture.         | &#39;</span><span class="p">,</span> <span class="s1">&#39;Wheat |&#39;</span><span class="p">,</span> <span class="s1">&#39;Corn  |&#39;</span><span class="p">,</span> <span class="s1">&#39;Sugar Beets |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yield (T)        | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_perfect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_perfect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_perfect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sales (T)        | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Purchases (T)    | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;AVERAGE&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span>
       <span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;     |&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First stage: s=3 (Below average)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Culture.         | &#39;</span><span class="p">,</span> <span class="s1">&#39;Wheat |&#39;</span><span class="p">,</span> <span class="s1">&#39;Corn  |&#39;</span><span class="p">,</span> <span class="s1">&#39;Sugar Beets |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yield (T)        | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_perfect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_perfect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">yields_perfect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sales (T)        | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span>
       <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_FAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="s2">&quot;BEETS_UNFAVORABLE&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Purchases (T)    | &#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span> 
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">,</span><span class="s2">&quot;BELOW&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;  |&#39;</span><span class="p">,</span>
       <span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;     |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Overall profit: $&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">profit_2stage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>===Optimal solutions of two-stage stochastic problem===
Culture.         |  Wheat | Corn  | Sugar Beets |
Surface (acres)  |  170.0 | 80.0  | 250.0  |
First stage: s=1 (Above average)
Culture.         |  Wheat | Corn  | Sugar Beets |
Yield (T)        |  510.0 | 288.0 | 6000.0 |
Sales (T)        |  310.0 | 48.0   | 6000.0 |
Purchases (T)    |  0.0   | 0.0   | -      |
First stage: s=2 (Average average)
Culture.         |  Wheat | Corn  | Sugar Beets |
Yield (T)        |  425.0 | 240.0 | 5000.0 |
Sales (T)        |  225.0 | 0.0   | 5000.0 |
Purchases (T)    |  0.0   | 0.0   | -      |
First stage: s=3 (Below average)
Culture.         |  Wheat | Corn  | Sugar Beets |
Yield (T)        |  340.0 | 192.0 | 4000.0 |
Sales (T)        |  140.0 | 0.0   | 4000.0 |
Purchases (T)    |  0.0   | 48.0   | -      |
Overall profit: $ 108390.0
</pre></div>
</div>
</div>
</div>
<p><img alt="ex1.2" src="notebooks/10/fig/farmer2-4.png" />
Such a model of a stochastic decision program is known as the <span class="math notranslate nohighlight">\(extensive\)</span> <span class="math notranslate nohighlight">\(form\)</span> of the stochastic program because it explicitly describes the second-stage decision variables for all scenarios.</p>
<p>This solution illustrates that it is impossible to find a solution that is ideal under all circumstances under uncertainty.</p>
</section>
<section id="evpi-and-vss">
<h3>EVPI and VSS<a class="headerlink" href="#evpi-and-vss" title="Permalink to this headline">#</a></h3>
<p>Suppose yields vary over years but are cyclical. A year with above average yields is always followed by a year with average yields and then a year with below average yields. The farmer would take optimal solutions as given in perfect information chapter repectively. The mean profit in the long run will be the mean of the three figures, namely $115,406 per year.</p>
<p>Now assume again the yields vary over years but on a random basis. The farmer does not get prior information on the yields. So, the best he can do in the long run is to take the solution as given in the two-stage stochastic program. The difference between this figure and the value in the case of perfect information is <span class="math notranslate nohighlight">\(the\)</span> <span class="math notranslate nohighlight">\(expected\)</span> <span class="math notranslate nohighlight">\(value\)</span> <span class="math notranslate nohighlight">\(of\)</span> <span class="math notranslate nohighlight">\(perfect\)</span> <span class="math notranslate nohighlight">\(information\)</span> (EVPI). It represents the loss of profit due to the presence of uncertainty.</p>
<p>Another approach is to assume expected yields and always to allocate the optimal planting surface according to these yields, which represents the <span class="math notranslate nohighlight">\(expected\)</span> <span class="math notranslate nohighlight">\(value\)</span> <span class="math notranslate nohighlight">\(solution\)</span>. The loss by not considering the random variation is the difference between this and the stochastic model profit, which is called the <span class="math notranslate nohighlight">\(value\)</span> <span class="math notranslate nohighlight">\(of\)</span> <span class="math notranslate nohighlight">\(the\)</span> <span class="math notranslate nohighlight">\(stochastic\)</span> <span class="math notranslate nohighlight">\(solution\)</span> (VSS).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculated EVPI</span>
<span class="n">EVPI</span> <span class="o">=</span> <span class="p">(</span><span class="n">profit_perfect</span><span class="o">+</span><span class="n">profit_above</span><span class="o">+</span><span class="n">profit_below</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span> <span class="o">-</span> <span class="n">profit_2stage</span> 

<span class="c1"># calculate expectation value</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">build_sp_model</span><span class="p">(</span><span class="n">yields_perfect</span><span class="p">)</span>
<span class="c1"># fix variables with solutions</span>
<span class="n">expected</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;WHEAT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
<span class="n">expected</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;CORN&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
<span class="n">expected</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;BEETS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="c1"># solve the model</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">SolverFactory</span><span class="p">(</span><span class="s2">&quot;ipopt&quot;</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>
<span class="c1"># calculate expected value</span>
<span class="n">profit_expect</span> <span class="o">=</span> <span class="o">-</span><span class="n">value</span><span class="p">(</span><span class="n">expected</span><span class="o">.</span><span class="n">OBJ</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Expectation:&#39;</span><span class="p">,</span> <span class="n">profit_expect</span><span class="p">)</span>

<span class="n">VSS</span> <span class="o">=</span> <span class="p">(</span><span class="n">profit_2stage</span> <span class="o">-</span> <span class="n">profit_expect</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;EVPI:&#39;</span><span class="p">,</span> <span class="n">EVPI</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;VSS:&#39;</span><span class="p">,</span> <span class="n">VSS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expectation: 107240.00084222008
EVPI: 7015.554283317964
VSS: 1150.0010277524998
</pre></div>
</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(EVPI\)</span> measures the value of knowing the future with certainty, while <span class="math notranslate nohighlight">\(VSS\)</span> assesses the value of knowing and using distributions on future outcomes.</p>
</section>
</section>
<section id="bibliographic-notes">
<h2>Bibliographic Notes<a class="headerlink" href="#bibliographic-notes" title="Permalink to this headline">#</a></h2>
<p>Biegler, L.T., 2010. Nonlinear programming: concepts, algorithms, and applications to chemical processes. Society for Industrial and Applied Mathematics.</p>
<p>Birge, J.R. and Louveaux, F., 2011. Introduction to stochastic programming. Springer Science &amp; Business Media.</p>
<p>Code partly adapted from:</p>
<p><a class="reference external" href="https://mpi-sppy.readthedocs.io/en/latest/quick_start.html">https://mpi-sppy.readthedocs.io/en/latest/quick_start.html</a></p>
<p><a class="reference external" href="https://mpi-sppy.readthedocs.io/en/latest/examples.html#examples">https://mpi-sppy.readthedocs.io/en/latest/examples.html#examples</a></p>
<p>Figures from:</p>
<p>[1]By Paolostar - Own work, CC BY-SA 4.0, <a class="reference external" href="https://commons.wikimedia.org/w/index.php?curid=46820806">https://commons.wikimedia.org/w/index.php?curid=46820806</a></p>
<p>[2]Renteria, J.A., Cao, Y., Dowling, A.W. and Zavala, V.M., 2018. Optimal pid controller tuning using stochastic programming techniques. AIChE Journal, 64(8), pp.2997-3010.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/10"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="airline-seating.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Airline seat allocation problem</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../pyomo_style_guide.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Pyomo Style Guide</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The MO Book Group<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>