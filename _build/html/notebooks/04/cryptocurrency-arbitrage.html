
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Cryptocurrency arbitrage search &#8212; Companion Notebooks for Data-Driven Mathematical Optimization in Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Extra material: Shortest path in real life" href="shortest-path-road-networks.html" />
    <link rel="prev" title="Gasoline distribution" href="gasoline-distribution.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DVQ7NZ8CYZ"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-DVQ7NZ8CYZ');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo-02.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Companion Notebooks for Data-Driven Mathematical Optimization in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Data-Driven Mathematical Optimization in Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/01.00.html">
   1. Mathematical Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/alice-rose.html">
     A first example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/pop-up_shop.html">
     Pop-up shop
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/02.00.html">
   2. Linear Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim.html">
     BIM production
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/lad-regression.html">
     LAD Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/mad-portfolio-optimization.html">
     MAD portfolio optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/l1-regression-wine-quality.html">
     Wine quality prediction with L1 regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-fractional.html">
     BIM production variants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/multiproductionfaciliity_worstcase.html">
     Extra material: Multi-product facility production
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/03.00.html">
   3. Mixed Integer Linear Programming
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-perturbed.html">
     BIM production with perturbed data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/shift-scheduling.html">
     Workforce shift scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/simple-production-model-gdp.html">
     Production model using disjunctions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/machine-scheduling.html">
     Machine Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/recharging-electric-vehicle.html">
     Recharging strategy for an electric vehicle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-production-revisited.html">
     BIM production revisited
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/cryptarithms.html">
     Extra material: Cryptarithms puzzle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/strip-packing.html">
     Extra material: Strip packing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/job-shop-scheduling.html">
     Extra material: Job shop scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/maintenance-planning.html">
     Extra material: Maintenance planning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="04.00.html">
   4. Network Optimization
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="dinner-seat-allocation.html">
     Dinner seating arrangement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gasoline-distribution.html">
     Gasoline distribution
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Cryptocurrency arbitrage search
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="shortest-path-road-networks.html">
     Extra material: Shortest path in real life
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="power-network.html">
     Extra material: Energy dispatch problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05/05.00.html">
   5. Convex Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/milk-pooling.html">
     Milk pooling and blending
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/ols-regression.html">
     Ordinary Least Squares (OLS) Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/markowitz_portfolio_with_chance_constraint.html">
     Portfolio optimization with chance constraint
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/svm-linear.html">
     Support Vector Machines for Binary Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/refinery-production.html">
     Extra material: Refinery production and shadow pricing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/06.00.html">
   6. Conic Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/economic-order-quantity.html">
     Economic Order Quantity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/building-insulation.html">
     Optimal Design of Multilayered Building Insulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/kelly-criterion-cone-programming.html">
     Kelly Criterion and Exponential Cones
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/07.00.html">
   7. Accounting for Uncertainty: Optimization Meets Reality
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/fleet-assignment.html">
     Fleet assignment problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/bim-robustness-analysis.html">
     Robustness analysis of BIM production plan via simulations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08/08.00.html">
   8. Robust Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/bim-robust-optimization.html">
     Robust BIM microchip production problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/09.00.html">
   9. Stochastic Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/newsvendor.html">
     Stock optimization for seafood distribution center
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../10/10.00.html">
   10. Two-Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/ccg.html">
     Robust Production Planning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/airline-seating.html">
     Airline seat allocation problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/farmer.html">
     The Farmer’s Problem and Variants
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pyomo_style_guide.html">
   Appendix: Pyomo style guide
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/mobook/MO-book/main?urlpath=tree/notebooks/04/cryptocurrency-arbitrage.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/mobook/MO-book/blob/main/notebooks/04/cryptocurrency-arbitrage.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/mobook/MO-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/mobook/MO-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/04/cryptocurrency-arbitrage.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/04/cryptocurrency-arbitrage.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installations-and-imports">
   Installations and Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cryptocurrency-exchanges">
   Cryptocurrency exchanges
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#representing-an-exchange-as-a-directed-graph">
   Representing an exchange as a directed graph
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exchange-order-book">
   Exchange order book
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-order-book-as-a-directed-graph">
   The order book as a directed graph
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#arbitrage">
   Arbitrage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#negative-edge-cycles">
   Negative edge cycles
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-order-books-that-demonstrate-arbitrage-opportunities">
   Find order books that demonstrate arbitrage opportunities
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-examples">
     Some examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#locate-arbitrage-opportunities-with-find-negative-cycle">
   Locate arbitrage opportunities with
   <code class="docutils literal notranslate">
    <span class="pre">
     find_negative_cycle
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finding-arbitrage-with-simple-cycles">
   Finding arbitrage with simple cycles
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#arbitrage-with-capacity-constraints">
   Arbitrage with Capacity Constraints
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bibliographic-notes">
   Bibliographic Notes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#appendix-asynchronous-downloads-of-order-book-data">
   Appendix: Asynchronous downloads of order book data
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Cryptocurrency arbitrage search</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installations-and-imports">
   Installations and Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cryptocurrency-exchanges">
   Cryptocurrency exchanges
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#representing-an-exchange-as-a-directed-graph">
   Representing an exchange as a directed graph
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exchange-order-book">
   Exchange order book
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-order-book-as-a-directed-graph">
   The order book as a directed graph
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#arbitrage">
   Arbitrage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#negative-edge-cycles">
   Negative edge cycles
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-order-books-that-demonstrate-arbitrage-opportunities">
   Find order books that demonstrate arbitrage opportunities
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-examples">
     Some examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#locate-arbitrage-opportunities-with-find-negative-cycle">
   Locate arbitrage opportunities with
   <code class="docutils literal notranslate">
    <span class="pre">
     find_negative_cycle
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finding-arbitrage-with-simple-cycles">
   Finding arbitrage with simple cycles
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#arbitrage-with-capacity-constraints">
   Arbitrage with Capacity Constraints
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bibliographic-notes">
   Bibliographic Notes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#appendix-asynchronous-downloads-of-order-book-data">
   Appendix: Asynchronous downloads of order book data
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="cryptocurrency-arbitrage-search">
<h1>Cryptocurrency arbitrage search<a class="headerlink" href="#cryptocurrency-arbitrage-search" title="Permalink to this heading">#</a></h1>
<p>Crpytocurrency exchanges are web services that enable the purchase, sale, and exchange of cryptocurrencies. These exchanges provide liquidity for owners and establish the relative value of these currencies. As of this writing (mid-2022), <a class="reference external" href="https://www.statista.com/statistics/730876/cryptocurrency-maket-value/">it is estimated</a> cryptocurrencies have a collective market capitalization of more than 2 trillion USD. Cryptocurrency markets are constantly changing with new currencies, exchanges, the occasional collapse of a currency, and highly volatile prices.</p>
<p>The purpose of this notebook is to explore the efficiency of cryptocurrency exchanges by testing for arbitrage opportunities. An arbitrage exists if a customer can realize a net profit through a sequence of risk-free trades. The efficient market hypothesis assumes arbitrage opportunities are quickly identified and exploited by investors. As a result of their trading, prices would reach a new equilibrium so that in an efficient market, any arbitrage opportunities would be small and fleeting. The question here is whether it is possible, with real-time data and rapid execution, for a trader to profit from these fleeting arbitrage opportunities.</p>
<section id="installations-and-imports">
<h2>Installations and Imports<a class="headerlink" href="#installations-and-imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># install Pyomo and solvers</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/mobook/MO-book/main/python/helper.py&quot;</span>
<span class="n">helper</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s2">&quot;helper&quot;</span><span class="p">)</span>
<span class="n">exec</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">helper</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

<span class="n">helper</span><span class="o">.</span><span class="n">install_pyomo</span><span class="p">()</span>
<span class="n">helper</span><span class="o">.</span><span class="n">install_cbc</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pyomo was previously installed
cbc was previously installed
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">timeit</span> <span class="kn">import</span> <span class="n">default_timer</span> <span class="k">as</span> <span class="n">timer</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cryptocurrency-exchanges">
<h2>Cryptocurrency exchanges<a class="headerlink" href="#cryptocurrency-exchanges" title="Permalink to this heading">#</a></h2>
<p>Cryptocurrency exchanges are digital marketplaces for buying and trading cryptocurrencies. Joining an exchange enables a user to maintain multiple currencies in a digital wallet, to buy and sell currencies, and to use cryptocurrencies for financial transactions. The <a class="reference external" href="https://github.com/ccxt/ccxt">open-source library <code class="docutils literal notranslate"><span class="pre">ccxt</span></code></a> currently supports real-time APIs for the largest and most common exchanges on which cryptocurrencies are traded. Here we import the library and list current exchanges supported by <code class="docutils literal notranslate"><span class="pre">ccxt</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ccxt</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">exchange</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ccxt</span><span class="o">.</span><span class="n">exchanges</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">exchange</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1) aax                   2) ascendex              3) bequant               4) bibox               
  5) bigone                6) binance               7) binancecoinm          8) binanceus           
  9) binanceusdm          10) bit2c                11) bitbank              12) bitbay              
 13) bitbns               14) bitcoincom           15) bitfinex             16) bitfinex2           
 17) bitflyer             18) bitforex             19) bitget               20) bithumb             
 21) bitmart              22) bitmex               23) bitopro              24) bitpanda            
 25) bitrue               26) bitso                27) bitstamp             28) bitstamp1           
 29) bittrex              30) bitvavo              31) bkex                 32) bl3p                
 33) blockchaincom        34) btcalpha             35) btcbox               36) btcmarkets          
 37) btctradeua           38) btcturk              39) buda                 40) bw                  
 41) bybit                42) bytetrade            43) cdax                 44) cex                 
 45) coinbase             46) coinbaseprime        47) coinbasepro          48) coincheck           
 49) coinex               50) coinfalcon           51) coinmate             52) coinone             
 53) coinspot             54) crex24               55) cryptocom            56) currencycom         
 57) delta                58) deribit              59) digifinex            60) eqonex              
 61) exmo                 62) flowbtc              63) fmfwio               64) ftx                 
 65) ftxus                66) gateio               67) gemini               68) hitbtc              
 69) hitbtc3              70) hollaex              71) huobi                72) huobijp             
 73) huobipro             74) idex                 75) independentreserve   76) indodax             
 77) itbit                78) kraken               79) kucoin               80) kucoinfutures       
 81) kuna                 82) latoken              83) lbank                84) liquid              
 85) luno                 86) lykke                87) mercado              88) mexc                
 89) ndax                 90) novadax              91) oceanex              92) okcoin              
 93) okex                 94) okex5                95) okx                  96) paymium             
 97) phemex               98) poloniex             99) probit              100) qtrade              
101) ripio               102) stex                103) therock             104) tidebit             
105) tidex               106) timex               107) upbit               108) vcc                 
109) wavesexchange       110) wazirx              111) whitebit            112) woo                 
113) xena                114) yobit               115) zaif                116) zb                  
117) zipmex              118) zonda               
</pre></div>
</div>
</div>
</div>
</section>
<section id="representing-an-exchange-as-a-directed-graph">
<h2>Representing an exchange as a directed graph<a class="headerlink" href="#representing-an-exchange-as-a-directed-graph" title="Permalink to this heading">#</a></h2>
<p>Exchanges provide for trading between currencies. Trading done between two specific currencies is called a <em>market</em>; each exchange hosting multiple markets. <code class="docutils literal notranslate"><span class="pre">ccxt</span></code> labels each market with a market symbol that is common across exchanges and suitable for within-exchange and cross-exchange arbitrage analyses.</p>
<p>The market symbol is an upper case string with abbreviations for a pair of traded currencies separated by of a slash (<code class="docutils literal notranslate"><span class="pre">/</span></code>). The first abbreviation is the base currency, the second is the quote currency.  Prices for the base currency are denominated in units of the quote currency. As an example, the symbol <code class="docutils literal notranslate"><span class="pre">ETH/BTC</span></code> refers to a market for the base currency Ethereum (ETH) quoted in units of the Bitcoin(BTC). The same market symbol can refer to offer to sell the base currency (a ‘bid’), or to an offer to sell the base currency (an ‘ask’).</p>
<p>An exchange can be represented by a directed graph can be constructed from the market symbols available on that exchange. Currencies correspond to nodes on the directed graph. Market symbols correspond to edges in the directed graph, with the source indicating the quote currency and the destination indicating the base currency.</p>
<p>The in-degree of a node is equal to the number of incoming edges. Out-degree is equal to the number of outgoing edges. Nodes with out-degrees greater than zero are highlighted because they represent currencies used to quote the price of other currencies. For all other nodes, a <code class="docutils literal notranslate"><span class="pre">minimum_in_degree</span></code> specifies a threshold value for in_degree for nodes to be displayed and retained for further analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># global variables used in subsequent cells</span>

<span class="n">exchange</span> <span class="o">=</span> <span class="n">ccxt</span><span class="o">.</span><span class="n">binanceus</span><span class="p">()</span>
<span class="c1">#exchange = ccxt.coinbase()</span>
<span class="n">markets</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">load_markets</span><span class="p">()</span>
<span class="n">symbols</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">symbols</span>


<span class="k">def</span> <span class="nf">symbols_to_dg</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">minimum_in_degree</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

    <span class="c1"># create an edge for every symbol</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">base</span><span class="p">,</span> <span class="n">quote</span> <span class="ow">in</span> <span class="p">[</span><span class="n">symbol</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">]:</span>
        <span class="n">dg</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">quote</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>

    <span class="n">remove_nodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">dg</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># color quote currencies in gold</span>
            <span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;gold&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dg</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">minimum_in_degree</span><span class="p">:</span>
                <span class="c1"># remove base currencies with an insufficint in_degree</span>
                <span class="n">remove_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># color base currencies in lightblue</span>
                <span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lightblue&quot;</span>

    <span class="n">dg</span><span class="o">.</span><span class="n">remove_nodes_from</span><span class="p">(</span><span class="n">remove_nodes</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
        <span class="n">dg</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
        <span class="n">dg</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">dg</span>


<span class="k">def</span> <span class="nf">draw_dg</span><span class="p">(</span><span class="n">dg</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">))</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span><span class="p">(</span><span class="n">dg</span><span class="p">)</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span>
        <span class="n">dg</span><span class="p">,</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">node_color</span><span class="o">=</span><span class="p">[</span><span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">()],</span>
        <span class="n">edge_color</span><span class="o">=</span><span class="p">[</span><span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">],</span>
        <span class="n">width</span><span class="o">=</span><span class="p">[</span><span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">],</span>
        <span class="n">node_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">font_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">arrowsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
        <span class="n">connectionstyle</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;arc3, rad=</span><span class="si">{</span><span class="n">rad</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edge_labels</span><span class="p">(</span>
        <span class="n">dg</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">edge_labels</span><span class="o">=</span><span class="p">{(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dst</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">()}</span>
    <span class="p">)</span>


<span class="n">dg_symbols</span> <span class="o">=</span> <span class="n">symbols_to_dg</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">draw_dg</span><span class="p">(</span><span class="n">dg_symbols</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of nodes = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dg_symbols</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of edges = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dg_symbols</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exchange-order-book">
<h2>Exchange order book<a class="headerlink" href="#exchange-order-book" title="Permalink to this heading">#</a></h2>
<p>The order book for a currency exchange is the real-time inventory of trading orders.</p>
<p>A <strong>bid</strong> is an order to buy up to a specified amount of the base currency. The price is not to exceed the ‘bid price’ specified in the quote currency. The exchange attempts to match the bid to a sell order at a price less than or equal to the bid price. If a transaction occurs, the  buyer will receive an amount of base currency less than or equal to the bid volume at a price less than or equal to the bid price.</p>
<p>An <strong>ask</strong> is an offer to sell up to a specified amount of the base currency at a price no less than a value specified given in the quote currency. If a transaction occurs, then seller will sell no more than a specified about of the base currency at a price no less than the specified value if the exchange matches the ask order to a higher bid.</p>
<p>The exchange order book maintains a list of all active orders for symbols traded on the exchange. Incoming bids above the lowest ask or incoming asks below the highest bid will be immediately matched and transactions executed following rules of the exchange.</p>
<p>The following cell uses the <code class="docutils literal notranslate"><span class="pre">ccxt</span></code> library to fetch the highest bid and lowest ask from the order book for all trading symbols in a directed graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">fetch_order_book</span><span class="p">(</span><span class="n">dg</span><span class="p">):</span>

    <span class="c1"># get trading symbols from exchange graph</span>
    <span class="n">trade_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">base</span><span class="p">,</span> <span class="n">quote</span><span class="p">])</span> <span class="k">for</span> <span class="n">quote</span><span class="p">,</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">fetch_order_book_symbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="n">exchange</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return order book data for a specified symbol&quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">fetch_order_book</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;quote&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;run_time (ms)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="n">timer</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">milliseconds</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;bids&quot;</span><span class="p">]:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;bid_price&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;bids&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;bid_volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;bids&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;asks&quot;</span><span class="p">]:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;ask_price&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;asks&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;ask_volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;asks&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># fetch order book data and store in a dictionary</span>
    <span class="n">order_book</span> <span class="o">=</span> <span class="p">{</span><span class="n">symbol</span><span class="p">:</span> <span class="n">fetch_order_book_symbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span> <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">trade_symbols</span><span class="p">}</span>

    <span class="c1"># convert to pandas dataframe</span>
    <span class="n">order_book</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">order_book</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;symbol&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">order_book</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">order_book</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">order_book</span>

<span class="n">order_book</span> <span class="o">=</span> <span class="n">fetch_order_book</span><span class="p">(</span><span class="n">dg_symbols</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">order_book</span><span class="p">[[</span><span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;quote&#39;</span><span class="p">,</span> <span class="s1">&#39;bid_price&#39;</span><span class="p">,</span> <span class="s1">&#39;bid_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;ask_price&#39;</span><span class="p">,</span> <span class="s1">&#39;ask_volume&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>base</th>
      <th>quote</th>
      <th>bid_price</th>
      <th>bid_volume</th>
      <th>ask_price</th>
      <th>ask_volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ADA/USD</th>
      <td>ADA</td>
      <td>USD</td>
      <td>0.3183</td>
      <td>3227.4</td>
      <td>0.3185</td>
      <td>1723.6</td>
    </tr>
    <tr>
      <th>BNB/USD</th>
      <td>BNB</td>
      <td>USD</td>
      <td>297.6549</td>
      <td>3.1</td>
      <td>297.9655</td>
      <td>0.647</td>
    </tr>
    <tr>
      <th>BTC/USD</th>
      <td>BTC</td>
      <td>USD</td>
      <td>16671.75</td>
      <td>0.059981</td>
      <td>16675.78</td>
      <td>0.043742</td>
    </tr>
    <tr>
      <th>BUSD/USD</th>
      <td>BUSD</td>
      <td>USD</td>
      <td>1.0</td>
      <td>581978.35</td>
      <td>1.0001</td>
      <td>749545.4</td>
    </tr>
    <tr>
      <th>ETH/USD</th>
      <td>ETH</td>
      <td>USD</td>
      <td>1199.09</td>
      <td>0.4</td>
      <td>1199.44</td>
      <td>2.29275</td>
    </tr>
    <tr>
      <th>MANA/USD</th>
      <td>MANA</td>
      <td>USD</td>
      <td>0.4002</td>
      <td>794.9</td>
      <td>0.4005</td>
      <td>2748.59</td>
    </tr>
    <tr>
      <th>MATIC/USD</th>
      <td>MATIC</td>
      <td>USD</td>
      <td>0.8774</td>
      <td>284.9</td>
      <td>0.8778</td>
      <td>5678.5</td>
    </tr>
    <tr>
      <th>POLY/USD</th>
      <td>POLY</td>
      <td>USD</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>SOL/USD</th>
      <td>SOL</td>
      <td>USD</td>
      <td>14.6539</td>
      <td>35.0</td>
      <td>14.6684</td>
      <td>40.0</td>
    </tr>
    <tr>
      <th>TRX/USD</th>
      <td>TRX</td>
      <td>USD</td>
      <td>0.0519</td>
      <td>478.9</td>
      <td>0.052</td>
      <td>81283.4</td>
    </tr>
    <tr>
      <th>USDC/USD</th>
      <td>USDC</td>
      <td>USD</td>
      <td>0.9997</td>
      <td>259027.74</td>
      <td>0.9998</td>
      <td>810144.56</td>
    </tr>
    <tr>
      <th>USDT/USD</th>
      <td>USDT</td>
      <td>USD</td>
      <td>0.9987</td>
      <td>603306.99</td>
      <td>0.9988</td>
      <td>563321.56</td>
    </tr>
    <tr>
      <th>UST/USD</th>
      <td>UST</td>
      <td>USD</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>XRP/USD</th>
      <td>XRP</td>
      <td>USD</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>ADA/USDT</th>
      <td>ADA</td>
      <td>USDT</td>
      <td>0.31871</td>
      <td>2083.2</td>
      <td>0.31894</td>
      <td>578.8</td>
    </tr>
    <tr>
      <th>BNB/USDT</th>
      <td>BNB</td>
      <td>USDT</td>
      <td>297.9888</td>
      <td>1.8</td>
      <td>298.3153</td>
      <td>1.7</td>
    </tr>
    <tr>
      <th>BTC/USDT</th>
      <td>BTC</td>
      <td>USDT</td>
      <td>16689.8</td>
      <td>0.438066</td>
      <td>16694.78</td>
      <td>0.022021</td>
    </tr>
    <tr>
      <th>BUSD/USDT</th>
      <td>BUSD</td>
      <td>USDT</td>
      <td>1.0012</td>
      <td>296267.01</td>
      <td>1.0013</td>
      <td>304635.41</td>
    </tr>
    <tr>
      <th>ETH/USDT</th>
      <td>ETH</td>
      <td>USDT</td>
      <td>1200.18</td>
      <td>0.02251</td>
      <td>1201.04</td>
      <td>6.936</td>
    </tr>
    <tr>
      <th>MANA/USDT</th>
      <td>MANA</td>
      <td>USDT</td>
      <td>0.4012</td>
      <td>25.0</td>
      <td>0.4017</td>
      <td>842.0</td>
    </tr>
    <tr>
      <th>MATIC/USDT</th>
      <td>MATIC</td>
      <td>USDT</td>
      <td>0.878</td>
      <td>7980.0</td>
      <td>0.879</td>
      <td>2844.4</td>
    </tr>
    <tr>
      <th>POLY/USDT</th>
      <td>POLY</td>
      <td>USDT</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>SOL/USDT</th>
      <td>SOL</td>
      <td>USDT</td>
      <td>14.6697</td>
      <td>2.4</td>
      <td>14.691</td>
      <td>16.05</td>
    </tr>
    <tr>
      <th>TRX/USDT</th>
      <td>TRX</td>
      <td>USDT</td>
      <td>0.0519</td>
      <td>4821.0</td>
      <td>0.05197</td>
      <td>1926.0</td>
    </tr>
    <tr>
      <th>USDC/USDT</th>
      <td>USDC</td>
      <td>USDT</td>
      <td>1.001</td>
      <td>289244.0</td>
      <td>1.0013</td>
      <td>267296.0</td>
    </tr>
    <tr>
      <th>UST/USDT</th>
      <td>UST</td>
      <td>USDT</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>XRP/USDT</th>
      <td>XRP</td>
      <td>USDT</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>ADA/BTC</th>
      <td>ADA</td>
      <td>BTC</td>
      <td>0.000019</td>
      <td>2969.0</td>
      <td>0.000019</td>
      <td>3102.0</td>
    </tr>
    <tr>
      <th>BNB/BTC</th>
      <td>BNB</td>
      <td>BTC</td>
      <td>0.017851</td>
      <td>3.0</td>
      <td>0.017868</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>ETH/BTC</th>
      <td>ETH</td>
      <td>BTC</td>
      <td>0.071918</td>
      <td>0.018</td>
      <td>0.071956</td>
      <td>0.053</td>
    </tr>
    <tr>
      <th>MANA/BTC</th>
      <td>MANA</td>
      <td>BTC</td>
      <td>0.000024</td>
      <td>589.0</td>
      <td>0.000024</td>
      <td>656.0</td>
    </tr>
    <tr>
      <th>MATIC/BTC</th>
      <td>MATIC</td>
      <td>BTC</td>
      <td>0.000053</td>
      <td>3703.9</td>
      <td>0.000053</td>
      <td>3.6</td>
    </tr>
    <tr>
      <th>POLY/BTC</th>
      <td>POLY</td>
      <td>BTC</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>SOL/BTC</th>
      <td>SOL</td>
      <td>BTC</td>
      <td>0.000879</td>
      <td>5.15</td>
      <td>0.00088</td>
      <td>0.31</td>
    </tr>
    <tr>
      <th>TRX/BTC</th>
      <td>TRX</td>
      <td>BTC</td>
      <td>0.000003</td>
      <td>25627.0</td>
      <td>0.000003</td>
      <td>50068.0</td>
    </tr>
    <tr>
      <th>XRP/BTC</th>
      <td>XRP</td>
      <td>BTC</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>ADA/BUSD</th>
      <td>ADA</td>
      <td>BUSD</td>
      <td>0.318</td>
      <td>1003.1</td>
      <td>0.319</td>
      <td>1003.5</td>
    </tr>
    <tr>
      <th>BNB/BUSD</th>
      <td>BNB</td>
      <td>BUSD</td>
      <td>297.5923</td>
      <td>1.51</td>
      <td>298.0</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>BTC/BUSD</th>
      <td>BTC</td>
      <td>BUSD</td>
      <td>16670.01</td>
      <td>0.059987</td>
      <td>16677.16</td>
      <td>0.059961</td>
    </tr>
    <tr>
      <th>ETH/BUSD</th>
      <td>ETH</td>
      <td>BUSD</td>
      <td>1198.75</td>
      <td>0.41709</td>
      <td>1199.93</td>
      <td>0.41669</td>
    </tr>
    <tr>
      <th>MANA/BUSD</th>
      <td>MANA</td>
      <td>BUSD</td>
      <td>0.3999</td>
      <td>1179.0</td>
      <td>0.4014</td>
      <td>663.0</td>
    </tr>
    <tr>
      <th>MATIC/BUSD</th>
      <td>MATIC</td>
      <td>BUSD</td>
      <td>0.87774</td>
      <td>854.4</td>
      <td>0.87835</td>
      <td>284.6</td>
    </tr>
    <tr>
      <th>POLY/BUSD</th>
      <td>POLY</td>
      <td>BUSD</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>SOL/BUSD</th>
      <td>SOL</td>
      <td>BUSD</td>
      <td>14.63</td>
      <td>376.27</td>
      <td>14.69</td>
      <td>30.06</td>
    </tr>
    <tr>
      <th>TRX/BUSD</th>
      <td>TRX</td>
      <td>BUSD</td>
      <td>0.05185</td>
      <td>5295.5</td>
      <td>0.05193</td>
      <td>13551.3</td>
    </tr>
    <tr>
      <th>USDC/BUSD</th>
      <td>USDC</td>
      <td>BUSD</td>
      <td>1.0</td>
      <td>286174.55</td>
      <td>1.0003</td>
      <td>331711.45</td>
    </tr>
    <tr>
      <th>XRP/BUSD</th>
      <td>XRP</td>
      <td>BUSD</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>BTC/USDC</th>
      <td>BTC</td>
      <td>USDC</td>
      <td>16671.25</td>
      <td>0.026</td>
      <td>16677.79</td>
      <td>0.299799</td>
    </tr>
    <tr>
      <th>ETH/USDC</th>
      <td>ETH</td>
      <td>USDC</td>
      <td>1198.7</td>
      <td>0.4171</td>
      <td>1201.02</td>
      <td>0.4163</td>
    </tr>
    <tr>
      <th>BTC/UST</th>
      <td>BTC</td>
      <td>UST</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="the-order-book-as-a-directed-graph">
<h2>The order book as a directed graph<a class="headerlink" href="#the-order-book-as-a-directed-graph" title="Permalink to this heading">#</a></h2>
<p>Here we represent the order book as a directed graph where nodes correspond to individual currencies.</p>
<p>A directed edge <span class="math notranslate nohighlight">\(i\rightarrow j\)</span> from node <span class="math notranslate nohighlight">\(i\)</span> to node <span class="math notranslate nohighlight">\(j\)</span> describes an opportunity for a counterparty to convert currency <span class="math notranslate nohighlight">\(i\)</span> into units of currency <span class="math notranslate nohighlight">\(j\)</span>. Let <span class="math notranslate nohighlight">\(w_i\)</span> and <span class="math notranslate nohighlight">\(w_j\)</span> denote the amounts of each currency held by the counterparty, and let <span class="math notranslate nohighlight">\(x_{i\rightarrow j}\)</span> denote the amount of currency <span class="math notranslate nohighlight">\(i\)</span> exchanged for currency <span class="math notranslate nohighlight">\(j\)</span>. Following the transaction</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
\Delta w_i &amp; = - x_{i\rightarrow j} \\
\Delta w_j &amp; = a_{i\rightarrow j} x_{i\rightarrow j}
\end{align*}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(a_{i\rightarrow j}\)</span> is a ‘conversion’ coefficient equal to the price of <span class="math notranslate nohighlight">\(i\)</span> expressed in terms of currency <span class="math notranslate nohighlight">\(j\)</span>. The corresponding capacity <span class="math notranslate nohighlight">\(c_{i\rightarrow j}\)</span> of an edge <span class="math notranslate nohighlight">\(i\rightarrow j\)</span> is specified by a relationship</p>
<div class="math notranslate nohighlight">
\[x_{i\rightarrow j} \leq c_{i\rightarrow j}\]</div>
<p>A buy order in the order book for market symbol <span class="math notranslate nohighlight">\(b/q\)</span> is an order to purchase base currency <span class="math notranslate nohighlight">\(b\)</span> at bid price given in the quote currency. The bid volume specifies the maximum amount base currency available. For a counterparty to the exchange, the buy order is an opportunity to convert the base currency <span class="math notranslate nohighlight">\(b\)</span> into the quote currency <span class="math notranslate nohighlight">\(q\)</span> such that</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
a_{b\rightarrow q} &amp; = \text{bid price} \\
c_{b\rightarrow q} &amp; = \text{bid volume}
\end{align*}
\end{split}\]</div>
<p>A sell order for symbol <span class="math notranslate nohighlight">\(b/q\)</span> is an order to sell the base currency at price not less than the ‘ask’ price given in terms of the quote currency. The ask volume is the amount of base currency to be sold. For a counterparty to the exchange, a sell order is an opportunity to convert the quote current into the base currency such that</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
a_{q\rightarrow b} &amp; = \frac{1}{\text{ask price}} \\
c_{q\rightarrow b} &amp; = \text{ask volume} \times \text{ask price}
\end{align*}
\end{split}\]</div>
<p>The following cell creates a directed graph using data from an exchange order book.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">):</span>

    <span class="c1"># create a dictionary of edges index by (src, dst)</span>
    <span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">order_book</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="c1"># buy (&#39;bid&#39;) orders</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;bid_volume&quot;</span><span class="p">]):</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">]</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;quote&quot;</span><span class="p">]</span>
            <span class="n">dg_order_book</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;bid&quot;</span><span class="p">,</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;bid_price&quot;</span><span class="p">],</span>
                <span class="n">capacity</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;bid_volume&quot;</span><span class="p">],</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;bid_price&quot;</span><span class="p">]),</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span>
                <span class="n">width</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># sell (&#39;ask&#39;) orders</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;ask_volume&quot;</span><span class="p">]):</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;quote&quot;</span><span class="p">]</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">]</span>
            <span class="n">dg_order_book</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;ask&quot;</span><span class="p">,</span>
                <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;ask_price&quot;</span><span class="p">],</span>
                <span class="n">capacity</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;ask_volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;ask_price&quot;</span><span class="p">],</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;ask_price&quot;</span><span class="p">]),</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
                <span class="n">width</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
        <span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lightblue&quot;</span>

    <span class="k">return</span> <span class="n">dg_order_book</span>


<span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>
<span class="n">draw_dg</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cryptocurrency-arbitrage_13_0.png" src="../../_images/cryptocurrency-arbitrage_13_0.png" />
</div>
</div>
</section>
<section id="arbitrage">
<h2>Arbitrage<a class="headerlink" href="#arbitrage" title="Permalink to this heading">#</a></h2>
<p>As counterparty to an exchange, an arbitrage exists if it is possible to find a closed path and a sequence of transactions in the directed graph that results in a net increase in currency holdings. Given a path</p>
<div class="math notranslate nohighlight">
\[i_0 \rightarrow i_1 \rightarrow i_2 \rightarrow \cdots \rightarrow i_{n-1} \rightarrow i_n\]</div>
<p>the path is closed if <span class="math notranslate nohighlight">\(i_n = i_0\)</span>. The path has finite capacity if each edge in the path has a non-zero capacity. For a sufficiently small holding <span class="math notranslate nohighlight">\(w_{i_0}\)</span> of currency <span class="math notranslate nohighlight">\(i_0\)</span>, the closed path with <span class="math notranslate nohighlight">\(i_0 = i_n\)</span> represents an arbitrage opportunity if</p>
<div class="math notranslate nohighlight">
\[\prod_{k=0}^{n-1} a_{i_k\rightarrow i_{k+1}} &gt; 1\]</div>
<p>To apply the shortest path algorithms from the NetworkX library, we assign a each edge a weight equal to the negative logarithm of the conversion coefficients.</p>
<div class="math notranslate nohighlight">
\[w_{i\rightarrow j} = - \log a_{i\rightarrow j}\]</div>
<p>Given designated source and destination currencies represented by nodes <span class="math notranslate nohighlight">\(i_{0}\)</span> and <span class="math notranslate nohighlight">\(i_{n}\)</span>, the largest return is given by a path minimizing the sum of weights computed as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
&amp; \min\; W \\
&amp; \text{s.t.}\; W = \sum_{k=0}^{n-1} w_{i_k \rightarrow i_{k+1}}\\
\end{align*}
\end{split}\]</div>
<p>An arbitrage exists if <span class="math notranslate nohighlight">\(W &lt; 0\)</span> for any path where <span class="math notranslate nohighlight">\(i_0 = i_n\)</span>.</p>
</section>
<section id="negative-edge-cycles">
<h2>Negative edge cycles<a class="headerlink" href="#negative-edge-cycles" title="Permalink to this heading">#</a></h2>
<p>A brute force search over all simple cycles has complexity <span class="math notranslate nohighlight">\((n + e)(c + 1)\)</span> which is impractical for larger scale applications. A more efficient search based on Bellman-Ford is embedded in the NetworkX function <a class="reference external" href="https://networkx.org/documentation/networkx-1.10/reference/generated/networkx.algorithms.shortest_paths.weighted.negative_edge_cycle.html"><code class="docutils literal notranslate"><span class="pre">negative_edge_cycle</span></code></a> that returns a logical True if a negative cycle exists in a directed graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">negative_edge_cycle</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">heuristic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-order-books-that-demonstrate-arbitrage-opportunities">
<h2>Find order books that demonstrate arbitrage opportunities<a class="headerlink" href="#find-order-books-that-demonstrate-arbitrage-opportunities" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span>

<span class="c1"># wait for arbitrage opportunity</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">timeout</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">order_book</span> <span class="o">=</span> <span class="n">fetch_order_book</span><span class="p">(</span><span class="n">dg_symbols</span><span class="p">)</span>
    <span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nx</span><span class="o">.</span><span class="n">negative_edge_cycle</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">heuristic</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;arbitrage found!&quot;</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exchange</span><span class="si">}</span><span class="s2"> orderbook </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H_%M_%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">order_book</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;order book saved to: </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">break</span>
    
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no arbitrage found&quot;</span><span class="p">)</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exchange</span><span class="si">}</span><span class="s2">_orderbook*&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Order book retrieved from </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">order_book</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>.arbitrage found!
order book saved to: Binance_US_orderbook_20221124_02_40_51.csv
</pre></div>
</div>
</div>
</div>
<section id="some-examples">
<h3>Some examples<a class="headerlink" href="#some-examples" title="Permalink to this heading">#</a></h3>
<p>Waiting for arbitrage opportunities to appear on a specific exchange in real-time occasionally requires some patience. For convenience, the following cell loads provide access to a few previously saved order books.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># order_book = pd.read_csv(&quot;Binance_US_orderbook_2022-08-07_17:20:31.csv&quot;)   # large order book with a 5 bp arb opportunity</span>
<span class="c1"># order_book = pd.read_csv(&quot;Binance_US_orderbook_20220926_18:41:53.csv&quot;)   # small order book with a 1 bp arb opportunity</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="locate-arbitrage-opportunities-with-find-negative-cycle">
<h2>Locate arbitrage opportunities with <code class="docutils literal notranslate"><span class="pre">find_negative_cycle</span></code><a class="headerlink" href="#locate-arbitrage-opportunities-with-find-negative-cycle" title="Permalink to this heading">#</a></h2>
<p>The NetworkX library includes a function <a class="reference external" href="https://networkx.org/documentation/stable/reference/algorithms/generated/networkx.algorithms.shortest_paths.weighted.find_negative_cycle.html"><code class="docutils literal notranslate"><span class="pre">find_negative_cycle</span></code></a> that locates a single negative edge cycle, if one exists.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute the sum of weights given a list of nodes</span>
<span class="k">def</span> <span class="nf">sum_weights</span><span class="p">(</span><span class="n">cycle</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">cycle</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">cycle</span><span class="p">[:</span><span class="mi">1</span><span class="p">])])</span>


<span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>
<span class="n">arb</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">find_negative_cycle</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">arb</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">arb</span><span class="p">,</span> <span class="n">sum_weights</span><span class="p">(</span><span class="n">arb</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">10000</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">sum_weights</span><span class="p">(</span><span class="n">arb</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2"> basis points&quot;</span><span class="p">)</span>
    
<span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arb</span><span class="p">,</span> <span class="n">arb</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">arb</span><span class="p">[:</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">dg_order_book</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">dst</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
    
<span class="n">draw_dg</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;USD&#39;, &#39;MANA&#39;, &#39;USDT&#39;]
[&#39;USD&#39;, &#39;MANA&#39;, &#39;USDT&#39;] -0.00044544384631844155
4.455430711609587 basis points
</pre></div>
</div>
<img alt="../../_images/cryptocurrency-arbitrage_22_1.png" src="../../_images/cryptocurrency-arbitrage_22_1.png" />
</div>
</div>
</section>
<section id="finding-arbitrage-with-simple-cycles">
<h2>Finding arbitrage with simple cycles<a class="headerlink" href="#finding-arbitrage-with-simple-cycles" title="Permalink to this heading">#</a></h2>
<p>To demonstrate the existence of arbitrage in an order book, we compute the loss function for all simple cycles that can be constructed within a directed graph.</p>
<p>A simple cycle is a closed path where no node appears twice. Simple cycles are distinct if they are not cyclic permutations of each other. The following cell uses <a class="reference external" href="https://networkx.org/documentation/stable/reference/algorithms/generated/networkx.algorithms.cycles.simple_cycles.html"><code class="docutils literal notranslate"><span class="pre">simple_cycles</span></code></a> from the NetworkX library to construct a dictionary of all distinct simple cycles in the order book. Cycles are represented by an ordered list of nodes comprising the cycle. The existence of a simple cycle with negative log loss indicates an arbitrage opportunity.</p>
<p>The following cell uses <code class="docutils literal notranslate"><span class="pre">negative_edge_cycle</span></code> to test for an arbitrage opportunity in the current order book. If an arbitrage is found, the order book is saved to a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file for later analysis. If no arbitrage is found within the specified time limit, the most recent <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file is returned instead.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell iterates over all simple cycles in a directed graph which</span>
<span class="c1"># can take inordinate time for a large, well connected graph. For that</span>
<span class="c1"># reason, it is included in &quot;raw&quot; format to avoid automatic execution </span>
<span class="c1"># in scripts. Change to a &quot;code&quot; cell to execute.</span>

<span class="c1"># convert order book to a directed graph</span>
<span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>

<span class="c1"># compute the sum of weights given a list of nodes</span>
<span class="k">def</span> <span class="nf">sum_weights</span><span class="p">(</span><span class="n">cycle</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">cycle</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">cycle</span><span class="p">[:</span><span class="mi">1</span><span class="p">])])</span>

<span class="c1"># create a dictionary of all simple cycles and sum of weights</span>
<span class="n">cycles</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">simple_cycles</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">):</span>
    <span class="n">cycles</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">cycle</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sum_weights</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cycles</span><span class="p">)</span><span class="si">}</span><span class="s2"> distinct simple cycles in the order book.&quot;</span><span class="p">)</span>

<span class="c1"># create histogram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cycles</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cycles</span><span class="p">))))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;sum of log loss&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;sum of log loss for all simple cycles&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 38293 distinct simple cycles in the order book.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.lines.Line2D at 0x7ff4c333bee0&gt;
</pre></div>
</div>
<img alt="../../_images/cryptocurrency-arbitrage_25_2.png" src="../../_images/cryptocurrency-arbitrage_25_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arbitrage</span> <span class="o">=</span> <span class="p">[</span><span class="n">cycle</span> <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cycles</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cycles</span><span class="o">.</span><span class="n">get</span><span class="p">)</span> <span class="k">if</span> <span class="n">cycles</span><span class="p">[</span><span class="n">cycle</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;basis points   arbitrage cycle&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="n">arbitrage</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">10000</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">cycles</span><span class="p">[</span><span class="n">cycle</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="si">:</span><span class="s2">12.8f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">cycle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>basis points   arbitrage cycle
  4.47233827 (&#39;USDT&#39;, &#39;USDC&#39;, &#39;BUSD&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  4.47233827 (&#39;USDT&#39;, &#39;BUSD&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  4.45543071 (&#39;USDT&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  4.07379350 (&#39;USDT&#39;, &#39;BTC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  3.98530123 (&#39;USDT&#39;, &#39;TRX&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  3.79494180 (&#39;USDT&#39;, &#39;ETH&#39;, &#39;BTC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  2.66276938 (&#39;USDT&#39;, &#39;MATIC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  2.54698572 (&#39;USDT&#39;, &#39;ETH&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  2.54695490 (&#39;USDT&#39;, &#39;BTC&#39;, &#39;MATIC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  2.27374531 (&#39;USDT&#39;, &#39;BTC&#39;, &#39;BUSD&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  2.26814577 (&#39;USDT&#39;, &#39;ETH&#39;, &#39;BTC&#39;, &#39;MATIC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  2.07922372 (&#39;USDT&#39;, &#39;USDC&#39;, &#39;BUSD&#39;, &#39;MATIC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  2.07922372 (&#39;USDT&#39;, &#39;BUSD&#39;, &#39;MATIC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  2.00040008 (&#39;USDC&#39;, &#39;BUSD&#39;, &#39;USD&#39;)
  1.99494379 (&#39;USDT&#39;, &#39;ETH&#39;, &#39;BTC&#39;, &#39;BUSD&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  1.98279208 (&#39;USDT&#39;, &#39;USDC&#39;, &#39;BUSD&#39;, &#39;BTC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  1.98279208 (&#39;USDT&#39;, &#39;BUSD&#39;, &#39;BTC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  1.60172732 (&#39;USDT&#39;, &#39;BTC&#39;, &#39;USDC&#39;, &#39;BUSD&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  1.47099657 (&#39;USDT&#39;, &#39;USDC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  1.35909994 (&#39;USDT&#39;, &#39;USDC&#39;, &#39;BTC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  1.32294453 (&#39;USDT&#39;, &#39;ETH&#39;, &#39;BTC&#39;, &#39;USDC&#39;, &#39;BUSD&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  0.98459692 (&#39;USDT&#39;, &#39;USD&#39;, &#39;USDC&#39;, &#39;BUSD&#39;)
  0.60309210 (&#39;USDT&#39;, &#39;BTC&#39;, &#39;USD&#39;, &#39;USDC&#39;, &#39;BUSD&#39;)
  0.51747569 (&#39;USDT&#39;, &#39;ADA&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  0.51463054 (&#39;USDT&#39;, &#39;TRX&#39;, &#39;USD&#39;, &#39;USDC&#39;, &#39;BUSD&#39;)
  0.45627262 (&#39;USDT&#39;, &#39;USDC&#39;, &#39;BUSD&#39;, &#39;BTC&#39;, &#39;MATIC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  0.45627262 (&#39;USDT&#39;, &#39;BUSD&#39;, &#39;BTC&#39;, &#39;MATIC&#39;, &#39;USD&#39;, &#39;MANA&#39;)
  0.32433715 (&#39;USDT&#39;, &#39;ETH&#39;, &#39;BTC&#39;, &#39;USD&#39;, &#39;USDC&#39;, &#39;BUSD&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arbitrage</span><span class="p">):</span>
    
    <span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">:</span>
        <span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
        
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">cycle</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">cycle</span><span class="p">[:</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
        
    <span class="n">draw_dg</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cryptocurrency-arbitrage_27_0.png" src="../../_images/cryptocurrency-arbitrage_27_0.png" />
<img alt="../../_images/cryptocurrency-arbitrage_27_1.png" src="../../_images/cryptocurrency-arbitrage_27_1.png" />
<img alt="../../_images/cryptocurrency-arbitrage_27_2.png" src="../../_images/cryptocurrency-arbitrage_27_2.png" />
<img alt="../../_images/cryptocurrency-arbitrage_27_3.png" src="../../_images/cryptocurrency-arbitrage_27_3.png" />
<img alt="../../_images/cryptocurrency-arbitrage_27_4.png" src="../../_images/cryptocurrency-arbitrage_27_4.png" />
<img alt="../../_images/cryptocurrency-arbitrage_27_5.png" src="../../_images/cryptocurrency-arbitrage_27_5.png" />
</div>
</div>
</section>
<section id="arbitrage-with-capacity-constraints">
<h2>Arbitrage with Capacity Constraints<a class="headerlink" href="#arbitrage-with-capacity-constraints" title="Permalink to this heading">#</a></h2>
<p>The preceding analysis demonstrates some of the practical limitations of relying on generic implementations of network algorithms.</p>
<ul class="simple">
<li><p>More than one negative cycle may exist, so more than one arbitrage opportunity may exist.</p></li>
<li><p>Shortest path algorithms do not account for capacity constraints. In effect, these algorithms are restricted to investments that are ‘sufficiently small’ to satisfy all capacity constraints on all edges.</p></li>
</ul>
<p>The following optimization model provides an alternative to network algorithms that includes:</p>
<ul class="simple">
<li><p>capacity constraints</p></li>
<li><p>multi-step trading strategies</p></li>
<li><p>no-short constraints</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\max \quad &amp; w_{USD}(T) \\
\\
\text{s.t.} \quad &amp; w_{USD}(0) = w_0 \\ \\
&amp; w_{j}(t) = w_{j}(t-1) + \sum_{i\in I_k} a_{i\rightarrow j}x_{i\rightarrow j}(t) - \sum_{k\in O_k} x_{j\rightarrow k}(t) &amp; \forall j\in N, t=1, 2, \ldots, T \\
&amp; w_j(t-1) \geq \sum_{k\in O_k} x_{j\rightarrow k}(t) &amp; \forall j\in N, t = 1, 2, \ldots, T  \\
&amp; \sum_{t=1}^T x_{j, k}(t) \leq c_{j\rightarrow k} &amp; \forall (j, k) \in N \times N\\
\end{align*}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>

<span class="k">def</span> <span class="nf">crypto_model</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">w0</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exchange</span><span class="si">}</span><span class="s2"> arbitrage&quot;</span><span class="p">)</span>

    <span class="c1"># length of the trading chain</span>
    <span class="n">m</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">RangeSet</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">T1</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">RangeSet</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>

    <span class="c1"># currency nodes and trading edges</span>
    <span class="n">m</span><span class="o">.</span><span class="n">NODES</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
    <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">))</span>

    <span class="c1"># currency on hand at each node</span>
    <span class="n">m</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">NODES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">T0</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="c1"># amount traded on each edge at each trade</span>
    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">T1</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="c1"># total amount traded on each edge over all trades</span>
    <span class="n">m</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="c1"># &quot;gain&quot; on each trading edge</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)][</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">capacity</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)][</span><span class="s2">&quot;capacity&quot;</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wealth</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="s2">&quot;USD&quot;</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">total_traded</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">T1</span><span class="p">])</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">edge_capacity</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">capacity</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]</span>

    <span class="c1"># initial assignment of 100 units on a selected currency</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">NODES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">initial</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s2">&quot;USD&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">w0</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">NODES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">T1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">no_shorting</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span> <span class="k">if</span> <span class="n">src</span> <span class="o">==</span> <span class="n">node</span><span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">NODES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">T1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">balances</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> \
            <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">node</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span> <span class="k">if</span> <span class="n">dst</span> <span class="o">==</span> <span class="n">node</span><span class="p">)</span> \
            <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span> <span class="k">if</span> <span class="n">src</span> <span class="o">==</span> <span class="n">node</span><span class="p">)</span> 


    <span class="n">solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s2">&quot;cbc&quot;</span><span class="p">)</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">m</span>

<span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">crypto_model</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">w0</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># report what orders to issue</span>
<span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mf">0.0000002</span><span class="p">:</span> 
        <span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
        <span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">dst</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
        <span class="n">dg_order_book</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">dst</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
                
<span class="n">draw_dg</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>

<span class="c1"># report what orders to issue</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Orders&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      arc          capacity        traded&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mf">0.0000002</span><span class="p">:</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span><span class="n">dst</span><span class="p">)][</span><span class="s1">&#39;kind&#39;</span><span class="p">]</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src</span><span class="si">:</span><span class="s2">&gt;5s</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">dst</span><span class="si">:</span><span class="s2">&lt;5s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">capacity</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]</span><span class="si">:</span><span class="s2">12.5f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]()</span><span class="si">:</span><span class="s2">14.5f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;  &gt;&gt;&gt;  &quot;</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;ask&quot;</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">dst</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="n">src</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">quote</span>
            <span class="n">price</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)][</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]()</span> <span class="o">/</span> <span class="n">price</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;sell </span><span class="si">{</span><span class="n">volume</span><span class="si">:</span><span class="s2">15.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">:</span><span class="s2">11s</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">12.6f</span><span class="si">}</span><span class="s2">&quot;</span>
            
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;bid&quot;</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">src</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="n">dst</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">quote</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)][</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span><span class="n">dst</span><span class="p">]()</span> 
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;buy </span><span class="si">{</span><span class="n">volume</span><span class="si">:</span><span class="s2">16.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">:</span><span class="s2">11s</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">12.6f</span><span class="si">}</span><span class="s2">&quot;</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Transactions&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">T1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t = </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mf">0.0000002</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src</span><span class="si">:</span><span class="s2">8s</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">dst</span><span class="si">:</span><span class="s2">8s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span><span class="si">:</span><span class="s2">14.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

<span class="c1"># display currency balances</span>
<span class="n">balances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">T0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0000002</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">T0</span><span class="p">:</span>
            <span class="n">balances</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span>

<span class="n">display</span><span class="p">(</span><span class="n">balances</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">balances</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Orders
      arc          capacity        traded
  USD -&gt; MANA  ask   1100.81030       10.01250  &gt;&gt;&gt;  sell       25.000000 MANA/USD    at     0.400500
  USD -&gt; USDC  ask 809982.53109     1990.19000  &gt;&gt;&gt;  sell     1990.588118 USDC/USD    at     0.999800
 BUSD -&gt; USD   bid 581978.35000     1990.58810  &gt;&gt;&gt;  buy      1990.588100 BUSD/USD    at     1.000000
 MANA -&gt; USDT  bid     25.00000       25.00000  &gt;&gt;&gt;  buy        25.000000 MANA/USDT   at     0.401200
 USDC -&gt; BUSD  bid 286174.55000     1990.58810  &gt;&gt;&gt;  buy      1990.588100 USDC/BUSD   at     1.000000
 USDT -&gt; USD   bid 603306.99000       10.03000  &gt;&gt;&gt;  buy        10.030000 USDT/USD    at     0.998700

Transactions
t = 1
USD      -&gt; MANA    :      10.012500
USD      -&gt; USDC    :     989.987500

t = 2
MANA     -&gt; USDT    :      25.000000
USDC     -&gt; BUSD    :     990.185540

t = 3
BUSD     -&gt; USD     :     990.185540
USDT     -&gt; USD     :      10.030000

t = 4
USD      -&gt; USDC    :    1000.202500

t = 5
USDC     -&gt; BUSD    :    1000.402600

t = 6
BUSD     -&gt; USD     :    1000.402600
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>USD</th>
      <td>1000.0</td>
      <td>0.000000e+00</td>
      <td>9.651632e-14</td>
      <td>1.000202e+03</td>
      <td>-2.089930e-13</td>
      <td>-2.089930e-13</td>
      <td>1000.4026</td>
    </tr>
    <tr>
      <th>BUSD</th>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>9.901855e+02</td>
      <td>-2.088940e-13</td>
      <td>-2.088940e-13</td>
      <td>1.000403e+03</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>MANA</th>
      <td>0.0</td>
      <td>2.500000e+01</td>
      <td>0.000000e+00</td>
      <td>2.416411e-13</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>USDC</th>
      <td>0.0</td>
      <td>9.901855e+02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>1.000403e+03</td>
      <td>0.000000e+00</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>USDT</th>
      <td>0.0</td>
      <td>1.078005e-11</td>
      <td>1.003000e+01</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.0000</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="../../_images/cryptocurrency-arbitrage_29_2.png" src="../../_images/cryptocurrency-arbitrage_29_2.png" />
<img alt="../../_images/cryptocurrency-arbitrage_29_3.png" src="../../_images/cryptocurrency-arbitrage_29_3.png" />
</div>
</div>
</section>
<section id="bibliographic-notes">
<h2>Bibliographic Notes<a class="headerlink" href="#bibliographic-notes" title="Permalink to this heading">#</a></h2>
<p>Crytocurrency markets are relatively new compared to other markets, and relatively few academic papers are available that specifically address arbitrage on those markets. Early studies, such as the following, reported periods of large, recurrent arbitrage opportunities that exist across exchanges, and that can persist for several days or weeks.</p>
<blockquote>
<div><p>Makarov, I., &amp; Schoar, A. (2020). Trading and arbitrage in cryptocurrency markets. Journal of Financial Economics, 135(2), 293-319.</p>
</div></blockquote>
<p>Subsequent work reports these prices differentials do exist, but only at a fraction of the values previously reported, and only for fleeting periods of time.</p>
<blockquote>
<div><p>Crépellière, T., &amp; Zeisberger, S. (2020). Arbitrage in the Market for Cryptocurrencies. Available at SSRN 3606053.  <a class="reference external" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3606053">https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3606053</a></p>
</div></blockquote>
<p>The use of network algorithms to identify cross-exchange arbitrage has appeared in the academic literature, and in numerous web sites demonstrating optimization and network applications. Representative examples are cited below.</p>
<blockquote>
<div><p>Peduzzi, G., James, J., &amp; Xu, J. (2021, September). JACK THE RIPPLER: Arbitrage on the Decentralized Exchange of the XRP Ledger. In 2021 3rd Conference on Blockchain Research &amp; Applications for Innovative Networks and Services (BRAINS) (pp. 1-2). IEEE. <a class="reference external" href="https://arxiv.org/pdf/2106.16158.pdf">https://arxiv.org/pdf/2106.16158.pdf</a></p>
</div></blockquote>
<blockquote>
<div><p>Bruzgė, R., &amp; Šapkauskienė, A. (2022). Network analysis on Bitcoin arbitrage opportunities. The North American Journal of Economics and Finance, 59, 101562. <a class="reference external" href="https://doi.org/10.1016/j.najef.2021.101562">https://doi.org/10.1016/j.najef.2021.101562</a></p>
</div></blockquote>
<blockquote>
<div><p>Bruzgė, R., &amp; Šapkauskienė, A. (2022). Dataset for Bitcoin arbitrage in different cryptocurrency exchanges. Data in Brief, 40, 107731.</p>
</div></blockquote>
<p>The work in this notebook is related to materials found in the following web resources.</p>
<blockquote>
<div><p><a class="reference external" href="https://anilpai.medium.com/currency-arbitrage-using-bellman-ford-algorithm-8938dcea56ea">https://anilpai.medium.com/currency-arbitrage-using-bellman-ford-algorithm-8938dcea56ea</a></p>
</div></blockquote>
<blockquote>
<div><p><a class="reference external" href="https://nbviewer.org/github/rcroessmann/sharing_public/blob/master/arbitrage_identification.ipynb">Crypto Trading and Arbitrage Identification Strategies</a></p>
</div></blockquote>
<p>A more complete analysis of trading and exploiting arbitrage opportunities in decentralized finance markets is available in the following paper and thesis.</p>
<blockquote>
<div><p>Byrne, S. An Exploration of Novel Trading and Arbitrage Methods within Decentralised Finance. <a class="reference external" href="https://www.scss.tcd.ie/Donal.OMahony/bfg/202021/StephenByrneDissertation.pdf">https://www.scss.tcd.ie/Donal.OMahony/bfg/202021/StephenByrneDissertation.pdf</a></p>
</div></blockquote>
<blockquote>
<div><p>Levus, R., Berko, A., Chyrun, L., Panasyuk, V., &amp; Hrubel, M. (2021). Intelligent System for Arbitrage Situations Searching in the Cryptocurrency Market. In CEUR Workshop Proceedings (pp. 407-440). <a class="reference external" href="http://ceur-ws.org/Vol-2917/paper32.pdf">http://ceur-ws.org/Vol-2917/paper32.pdf</a></p>
</div></blockquote>
<p>In addition to the analysis of arbitrage opportunities, convex optimization may also have an important role in the developing of trading algorithms for crypocurrency exchanges.</p>
<blockquote>
<div><p>Angeris, G., Agrawal, A., Evans, A., Chitra, T., &amp; Boyd, S. (2021). Constant function market makers: Multi-asset trades via convex optimization. arXiv preprint arXiv:2107.12484. <a class="reference external" href="https://baincapitalcrypto.com/constant-function-market-makers-multi-asset-trades-via-convex-optimization/">https://baincapitalcrypto.com/constant-function-market-makers-multi-asset-trades-via-convex-optimization/</a> and <a class="reference external" href="https://arxiv.org/pdf/2107.12484.pdf">https://arxiv.org/pdf/2107.12484.pdf</a></p>
</div></blockquote>
</section>
<section id="appendix-asynchronous-downloads-of-order-book-data">
<h2>Appendix: Asynchronous downloads of order book data<a class="headerlink" href="#appendix-asynchronous-downloads-of-order-book-data" title="Permalink to this heading">#</a></h2>
<p>Considerably more development, testing, and validation would be needed to adapt this code to an automated tradign bot to exploit arbitrage opportunities in the crypto-currency markets. One of the time consuming steps is accessing order book data. The following cell is an experiment using the Python <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> library to determine if asynchronous calls to the <code class="docutils literal notranslate"><span class="pre">ccxt</span></code> would provide faster downloads.</p>
<p>Preliminary testing shows little or no advantage to <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> when working with a single exchange. That may change when the above code is adapted to multi-exchange arbitrage, and therefore this code is retained below for future testing.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/04"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="gasoline-distribution.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Gasoline distribution</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="shortest-path-road-networks.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Extra material: Shortest path in real life</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The MO Book Group<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>