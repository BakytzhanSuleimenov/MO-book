
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Cryptocurrency arbitrage search &#8212; Companion Notebooks for Data-Driven Optimization in Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Extra material: Shortest path in real life" href="shortest-path-road-networks.html" />
    <link rel="prev" title="Gasoline distribution" href="gasoline-distribution.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DVQ7NZ8CYZ"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-DVQ7NZ8CYZ');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo-02.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Companion Notebooks for Data-Driven Optimization in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Data-Driven Mathematical Optimization in Python
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/01.00.html">
   1. Mathematical Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/production-planning.html">
     A Production Planning Problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/production-planning-basic.html">
     A Simple Pyomo Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/production-planning-advanced.html">
     A Data-Driven Pyomo Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/02.00.html">
   2. Linear Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim.html">
     BIM production
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/lad-regression.html">
     LAD Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/mad-portfolio-optimization.html">
     MAD portfolio optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/L1-regression-wine-quality.html">
     Wine quality prediction with L1 regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-maxmin.html">
     BIM production for worst case
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-fractional.html">
     BIM production variants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/bim-rawmaterialplanning.html">
     BIM production using demand forecasts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/multiproductionfaciliity_worstcase.html">
     Extra material: Multi-product facility production
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/03.00.html">
   3. Mixed Integer Linear Programming
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-perturbed.html">
     BIM production with perturbed data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/shift-scheduling.html">
     Workforce shift scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/simple-production-model-gdp.html">
     Production model using disjunctions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/machine-scheduling.html">
     Machine Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/recharging-electric-vehicle.html">
     Recharging strategy for an electric vehicle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/bim-production-revisited.html">
     BIM production revisited
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/cryptarithms.html">
     Extra material: Cryptarithms puzzle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/strip-packing.html">
     Extra material: Strip packing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/job-shop-scheduling.html">
     Extra material: Job shop scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/maintenance-planning.html">
     Extra material: Maintenance planning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="04.00.html">
   4. Network Optimization
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="dinner-seat-allocation.html">
     Dinner seating arrangement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gasoline-distribution.html">
     Gasoline distribution
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Cryptocurrency arbitrage search
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="shortest-path-road-networks.html">
     Extra material: Shortest path in real life
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="power-network.html">
     Extra material: Energy dispatch problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05/05.00.html">
   5. Convex Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/milk-pooling.html">
     Milk pooling and blending
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/ols-regression.html">
     Ordinary Least Squares (OLS) Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/markowitz_portfolio.html">
     Markowitz portfolio optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/svm-linear.html">
     Support Vector Machines for Binary Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/refinery-production.html">
     Extra material: Refinery production and shadow pricing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/06.00.html">
   6. Conic Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/economic-order-quantity.html">
     Economic Order Quantity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/kelly-criterion.html">
     The Kelly Criterion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/markowitz_portfolio_revisited.html">
     Markowitz portfolio optimization revisited
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/building-insulation.html">
     Optimal Design of Multilayered Building Insulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/investment-wheel.html">
     Extra material: Luenberger’s Investment Wheel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/optimal-growth-portfolios.html">
     Extra material: Optimal Growth Portfolios
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/07.00.html">
   7. Accounting for Uncertainty: Optimization Meets Reality
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/fleet-assignment.html">
     Fleet assignment problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/bim-robustness-analysis.html">
     Robustness analysis of BIM production plan via simulations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08/08.00.html">
   8. Robust Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/bim-robust-optimization.html">
     Robust BIM microchip production problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/09.00.html">
   9. Stochastic Optimization - Single Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/pop-up_shop.html">
     Pop-up shop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/markowitz_portfolio_with_chance_constraint.html">
     Markowitz portfolio optimization with chance constraints
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/seafood.html">
     Stock optimization for seafood distribution center
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../10/10.00.html">
   10. Two-Stage Problems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/airline-seating.html">
     Airline seat allocation problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/farmer.html">
     The Farmer’s Problem and Variants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/opf-wind-curtailment.html">
     Two-stage energy dispatch optimization with wind curtailment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/opf-ldr.html">
     Two-stage energy dispatch optimization using linear decision rules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/ccg.html">
     Two-stage Production Planning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pyomo_style_guide.html">
   Appendix: Pyomo style guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../genindex.html">
   Index
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/mobook/MO-book/main?urlpath=tree/notebooks/04/cryptocurrency-arbitrage.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/mobook/MO-book/blob/main/notebooks/04/cryptocurrency-arbitrage.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/mobook/MO-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/mobook/MO-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/04/cryptocurrency-arbitrage.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/04/cryptocurrency-arbitrage.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installations-and-imports">
   Installations and Imports
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pyomo-and-solvers">
     Pyomo and Solvers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ccxt">
     CCXT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#networkx">
     Networkx
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cryptocurrency-exchanges">
   Cryptocurrency exchanges
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#representing-an-exchange-as-a-directed-graph">
   Representing an exchange as a directed graph
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exchange-order-book">
   Exchange order book
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#representing-the-order-book-also-as-a-directed-graph">
   Representing the order book also as a directed graph
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#representing-bids">
     Representing bids
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#representing-asks">
     Representing asks
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trading-and-arbitrage">
   Trading and Arbitrage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#paths-and-cycles">
     Paths and cycles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#arbitrage">
     Arbitrage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-cycle-with-negative-log-returns-indicates-arbitrage">
     A cycle with negative log returns indicates arbitrage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-for-a-negative-cycle">
     Testing for a negative cycle
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finding-and-displaying-one-negative-cycle">
     Finding and displaying one negative cycle
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#brute-force-search-arbitrage-with-simple-cycles">
   Brute force search arbitrage with simple cycles
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pyomo-model-for-arbitrage-with-capacity-constraints">
   Pyomo Model for Arbitrage with Capacity Constraints
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#real-time-downloads-of-order-books-from-an-exchange">
   Real Time Downloads of Order Books from an Exchange
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bibliographic-notes">
   Bibliographic Notes
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Cryptocurrency arbitrage search</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installations-and-imports">
   Installations and Imports
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pyomo-and-solvers">
     Pyomo and Solvers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ccxt">
     CCXT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#networkx">
     Networkx
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cryptocurrency-exchanges">
   Cryptocurrency exchanges
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#representing-an-exchange-as-a-directed-graph">
   Representing an exchange as a directed graph
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exchange-order-book">
   Exchange order book
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#representing-the-order-book-also-as-a-directed-graph">
   Representing the order book also as a directed graph
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#representing-bids">
     Representing bids
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#representing-asks">
     Representing asks
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trading-and-arbitrage">
   Trading and Arbitrage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#paths-and-cycles">
     Paths and cycles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#arbitrage">
     Arbitrage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-cycle-with-negative-log-returns-indicates-arbitrage">
     A cycle with negative log returns indicates arbitrage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-for-a-negative-cycle">
     Testing for a negative cycle
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finding-and-displaying-one-negative-cycle">
     Finding and displaying one negative cycle
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#brute-force-search-arbitrage-with-simple-cycles">
   Brute force search arbitrage with simple cycles
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pyomo-model-for-arbitrage-with-capacity-constraints">
   Pyomo Model for Arbitrage with Capacity Constraints
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#real-time-downloads-of-order-books-from-an-exchange">
   Real Time Downloads of Order Books from an Exchange
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bibliographic-notes">
   Bibliographic Notes
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <span class="target" id="index-0"></span><span class="target" id="index-1"></span><span class="target" id="index-2"></span><span class="target" id="index-3"></span><span class="target" id="index-4"></span><section class="tex2jax_ignore mathjax_ignore" id="cryptocurrency-arbitrage-search">
<span id="index-5"></span><h1>Cryptocurrency arbitrage search<a class="headerlink" href="#cryptocurrency-arbitrage-search" title="Permalink to this heading">#</a></h1>
<p>Crpytocurrency exchanges are web services for the purchase and sale of cryptocurrencies. These exchanges provide liquidity for owners and establish the relative value of among currencies. As of this writing (early 2023), <a class="reference external" href="https://www.statista.com/statistics/730876/cryptocurrency-maket-value/">cryptocurrencies have an estimated collective market capitalization over one trillion USD</a>. Cryptocurrency markets are constantly changing with the introduction of new exchanges, new currencies, the occasional collapse currencies, and highly volatile prices.</p>
<p>This notebook explores the market efficiency of cryptocurrency exchanges by testing for arbitrage opportunities. Arbitrage happens when a trader realizes a risk-free profit through a sequence of trades. The efficient market hypothesis suggests arbitrage opportunities are quickly identified and exploited by traders. As a result of trading activity, prices maintain a dynamic equilibrium where arbitrage opportunities are short and fleeting. The question explored here is whether real-time and fast execution make it is feasible for a trader to profit from these fleeting arbitrage opportunities.</p>
<section id="installations-and-imports">
<h2>Installations and Imports<a class="headerlink" href="#installations-and-imports" title="Permalink to this heading">#</a></h2>
<section id="pyomo-and-solvers">
<h3>Pyomo and Solvers<a class="headerlink" href="#pyomo-and-solvers" title="Permalink to this heading">#</a></h3>
<p>First we import Pyomo and necessary solvers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># install Pyomo and solvers</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/mobook/MO-book/main/python/helper.py&quot;</span>
<span class="n">helper</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s2">&quot;helper&quot;</span><span class="p">)</span>
<span class="n">exec</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">helper</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

<span class="n">helper</span><span class="o">.</span><span class="n">install_pyomo</span><span class="p">()</span>
<span class="n">helper</span><span class="o">.</span><span class="n">install_cbc</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pyomo was previously installed
cbc was previously installed
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="ccxt">
<h3>CCXT<a class="headerlink" href="#ccxt" title="Permalink to this heading">#</a></h3>
<p>In addition to Pyomo and other standard Python libraries, this notebook uses the <a class="reference external" href="https://github.com/ccxt/ccxt">open-source library <code class="docutils literal notranslate"><span class="pre">ccxt</span></code></a>. <code class="docutils literal notranslate"><span class="pre">ccxt</span></code> supports the real-time APIs of the largest and most common exchanges on which cryptocurrencies are traded. The library can be installed with</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>!pip install ccxt
</pre></div>
</div>
<p>Here we import all needed libraries and <code class="docutils literal notranslate"><span class="pre">ccxt</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">timeit</span> <span class="kn">import</span> <span class="n">default_timer</span> <span class="k">as</span> <span class="n">timer</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="networkx">
<h3>Networkx<a class="headerlink" href="#networkx" title="Permalink to this heading">#</a></h3>
<p>This notebook uses the <a class="reference external" href="https://networkx.org/">networkx</a> library to display exchange and market data. Networkx has been updated recently to version 3.0, but that update has not yet propogated through common Python distributions. If the code that follows in this notebook may generate errors on displaying networkx diagrams, it may be necessary to update the networkx library. This can be done with the following command executed in a new cell.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>!pip install networkx --upgrade
</pre></div>
</div>
</section>
</section>
<section id="cryptocurrency-exchanges">
<h2>Cryptocurrency exchanges<a class="headerlink" href="#cryptocurrency-exchanges" title="Permalink to this heading">#</a></h2>
<p>Cryptocurrency exchanges are digital marketplaces for buying and trading cryptocurrencies. Joining an exchange enables a member to maintain multiple currencies in a digital wallet, to buy and sell currencies, and to use cryptocurrencies for financial transactions.  Here we import the library and list current exchanges supported by <code class="docutils literal notranslate"><span class="pre">ccxt</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ccxt</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available exchanges:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">exchange</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ccxt</span><span class="o">.</span><span class="n">exchanges</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">exchange</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Available exchanges:

  1) ace                   2) alpaca                3) ascendex              4) bequant             
  5) bigone                6) binance               7) binancecoinm          8) binanceus           
  9) binanceusdm          10) bit2c                11) bitbank              12) bitbay              
 13) bitbns               14) bitcoincom           15) bitfinex             16) bitfinex2           
 17) bitflyer             18) bitforex             19) bitget               20) bithumb             
 21) bitmart              22) bitmex               23) bitopro              24) bitpanda            
 25) bitrue               26) bitso                27) bitstamp             28) bitstamp1           
 29) bittrex              30) bitvavo              31) bkex                 32) bl3p                
 33) blockchaincom        34) btcalpha             35) btcbox               36) btcex               
 37) btcmarkets           38) btctradeua           39) btcturk              40) buda                
 41) bybit                42) cex                  43) coinbase             44) coinbaseprime       
 45) coinbasepro          46) coincheck            47) coinex               48) coinfalcon          
 49) coinmate             50) coinone              51) coinspot             52) cryptocom           
 53) currencycom          54) delta                55) deribit              56) digifinex           
 57) exmo                 58) flowbtc              59) fmfwio               60) gate                
 61) gateio               62) gemini               63) hitbtc               64) hitbtc3             
 65) hollaex              66) huobi                67) huobijp              68) huobipro            
 69) idex                 70) independentreserve   71) indodax              72) itbit               
 73) kraken               74) krakenfutures        75) kucoin               76) kucoinfutures       
 77) kuna                 78) latoken              79) lbank                80) lbank2              
 81) luno                 82) lykke                83) mercado              84) mexc                
 85) mexc3                86) ndax                 87) novadax              88) oceanex             
 89) okcoin               90) okex                 91) okex5                92) okx                 
 93) paymium              94) phemex               95) poloniex             96) poloniexfutures     
 97) probit               98) ripio                99) stex                100) tidex               
101) timex               102) tokocrypto          103) upbit               104) wavesexchange       
105) wazirx              106) whitebit            107) woo                 108) yobit               
109) zaif                110) zb                  111) zonda               
</pre></div>
</div>
</div>
</div>
</section>
<section id="representing-an-exchange-as-a-directed-graph">
<h2>Representing an exchange as a directed graph<a class="headerlink" href="#representing-an-exchange-as-a-directed-graph" title="Permalink to this heading">#</a></h2>
<p>Cryptocurrency exchanges facilitate trading between different cryptocurrencies through markets, which are labeled with symbols common across all exchanges. These symbols consist of an upper case string with abbreviations for the traded currency pair, separated by a slash (/). The first abbreviation is the base currency and the second is the quote currency. Prices for the base currency are denominated in units of the quote currency. Each market symbol can refer to a <em>bid</em> (an offer to buy a specified quantity of the base currency for no more than than a specified price) or to an <em>ask</em> (an offer to sell a specified quantity of the base currency for no less than a specified price).</p>
<p>Market symbols can be used to construct a directed graph representing an exchange, where nodes correspond to currencies and edges correspond to market symbols. The source node of an edge represents the quote currency, and the destination node represents the base currency.</p>
<p>The in-degree of a node indicates the number of incoming edges, while the out-degree represents the number of outgoing edges. Nodes with out-degrees greater than zero are currencies used to quote the price of other currencies and are highlighted. Nodes with in-degree below a specified threshold, called the <code class="docutils literal notranslate"><span class="pre">minimum_in_degree</span></code>, have fewer markets and are not displayed or analyzed further.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># global variables used in subsequent cells</span>

<span class="c1"># create an exchange object</span>
<span class="n">exchange</span> <span class="o">=</span> <span class="n">ccxt</span><span class="o">.</span><span class="n">binanceus</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">get_dg</span><span class="p">(</span><span class="n">exchange</span><span class="p">,</span> <span class="n">minimum_in_degree</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a directed graph constructed from the market symbols on a specified exchange.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">markets</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">load_markets</span><span class="p">()</span>
    <span class="n">symbols</span> <span class="o">=</span> <span class="n">markets</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="c1"># create an edge for all market symbols</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">base</span><span class="p">,</span> <span class="n">quote</span> <span class="ow">in</span> <span class="p">[</span><span class="n">symbol</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">]:</span>
        <span class="n">dg</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">quote</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># remove base currencies with in_degree less than minimum_in_degree</span>
    <span class="n">remove_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">dg</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dg</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">minimum_in_degree</span><span class="p">]</span>
    <span class="n">dg</span><span class="o">.</span><span class="n">remove_nodes_from</span><span class="p">(</span><span class="n">remove_nodes</span><span class="p">)</span>
    
    <span class="c1"># color quote currencies in gold</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
        <span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;gold&quot;</span> <span class="k">if</span> <span class="n">dg</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;lightblue&quot;</span>

    <span class="k">return</span> <span class="n">dg</span>

<span class="k">def</span> <span class="nf">draw_dg</span><span class="p">(</span><span class="n">dg</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw directed graph of markets symbols.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">))</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span><span class="p">(</span><span class="n">dg</span><span class="p">)</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span>
        <span class="n">dg</span><span class="p">,</span> 
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">node_color</span><span class="o">=</span><span class="p">[</span><span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">()],</span>
        <span class="n">edge_color</span><span class="o">=</span><span class="p">[</span><span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">],</span>
        <span class="n">width</span><span class="o">=</span><span class="p">[</span><span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">],</span>
        <span class="n">node_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">font_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">arrowsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
        <span class="n">connectionstyle</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;arc3, rad=</span><span class="si">{</span><span class="n">rad</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edge_labels</span><span class="p">(</span><span class="n">dg</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">edge_labels</span><span class="o">=</span><span class="p">{(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dst</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">()})</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="n">minimum_in_degree</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">dg</span> <span class="o">=</span> <span class="n">get_dg</span><span class="p">(</span><span class="n">exchange</span><span class="p">,</span> <span class="n">minimum_in_degree</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">draw_dg</span><span class="p">(</span><span class="n">dg</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">exchange</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;Minimum in Degree (Base Currencies) = </span><span class="si">{</span><span class="n">minimum_in_degree</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of nodes = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of edges = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of nodes =  15
Number of edges =  60
</pre></div>
</div>
<img alt="../../_images/cryptocurrency-arbitrage_9_1.png" src="../../_images/cryptocurrency-arbitrage_9_1.png" />
</div>
</div>
</section>
<section id="exchange-order-book">
<h2>Exchange order book<a class="headerlink" href="#exchange-order-book" title="Permalink to this heading">#</a></h2>
<p>The <strong>order book</strong> is the real-time inventory of trading orders on an given exchange.</p>
<p>A <strong>bid</strong> is an order to buy up to a specified amount of the base currency. The price is not to exceed the ‘bid price’ specified in the quote currency. The exchange attempts to match the bid to a sell order at a price less than or equal to the bid price. If a transaction occurs the  buyer receives an amount of base currency less than or equal to the bid volume at a price less than or equal to the bid price.</p>
<p>An <strong>ask</strong> is an offer to sell up to a specified amount of the base currency for a price no less than a specified value  given in the quote currency. If a transaction occurs, then seller will sell no more than a specified about of the base currency at a price no less than the specified value.</p>
<p>The exchange order book maintains a list of all active orders for symbols traded on the exchange. Incoming bids above the lowest ask or incoming asks below the highest bid will be immediately matched and transactions executed following rules of the exchange.</p>
<p>The follow cell reads a previously saved order book.  Cells at the end of this notebook demonstrate how to retrieve an order book from an exchange and save it as a Pandas DataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>

<span class="c1"># find all previously saved order books</span>
<span class="n">fnames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*orderbook*&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)))</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">fnames</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># read the oldest</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reading: </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">order_book</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading: Binance_US_orderbook_saved.csv
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>symbol</th>
      <th>timestamp</th>
      <th>base</th>
      <th>quote</th>
      <th>bid_price</th>
      <th>bid_volume</th>
      <th>ask_price</th>
      <th>ask_volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ETH/BTC</td>
      <td>2023-03-02 15:36:06.529</td>
      <td>ETH</td>
      <td>BTC</td>
      <td>0.069735</td>
      <td>0.012000</td>
      <td>0.069759</td>
      <td>0.050000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BNB/BTC</td>
      <td>2023-03-02 15:36:06.583</td>
      <td>BNB</td>
      <td>BTC</td>
      <td>0.012743</td>
      <td>0.050000</td>
      <td>0.012755</td>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ADA/BTC</td>
      <td>2023-03-02 15:36:06.637</td>
      <td>ADA</td>
      <td>BTC</td>
      <td>0.000015</td>
      <td>2.000000</td>
      <td>0.000015</td>
      <td>2168.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SOL/BTC</td>
      <td>2023-03-02 15:36:06.690</td>
      <td>SOL</td>
      <td>BTC</td>
      <td>0.000935</td>
      <td>1.420000</td>
      <td>0.000936</td>
      <td>15.120000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>MATIC/BTC</td>
      <td>2023-03-02 15:36:06.750</td>
      <td>MATIC</td>
      <td>BTC</td>
      <td>0.000052</td>
      <td>26.200000</td>
      <td>0.000052</td>
      <td>150.200000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>MANA/BTC</td>
      <td>2023-03-02 15:36:06.848</td>
      <td>MANA</td>
      <td>BTC</td>
      <td>0.000027</td>
      <td>831.000000</td>
      <td>0.000027</td>
      <td>1409.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>TRX/BTC</td>
      <td>2023-03-02 15:36:06.905</td>
      <td>TRX</td>
      <td>BTC</td>
      <td>0.000003</td>
      <td>4.000000</td>
      <td>0.000003</td>
      <td>25352.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>ADA/ETH</td>
      <td>2023-03-02 15:36:06.960</td>
      <td>ADA</td>
      <td>ETH</td>
      <td>0.000214</td>
      <td>994.900000</td>
      <td>0.000214</td>
      <td>891.600000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>BTC/USDT</td>
      <td>2023-03-02 15:36:07.012</td>
      <td>BTC</td>
      <td>USDT</td>
      <td>23373.920000</td>
      <td>0.118619</td>
      <td>23376.000000</td>
      <td>0.045275</td>
    </tr>
    <tr>
      <th>9</th>
      <td>ETH/USDT</td>
      <td>2023-03-02 15:36:07.065</td>
      <td>ETH</td>
      <td>USDT</td>
      <td>1630.200000</td>
      <td>0.950000</td>
      <td>1630.770000</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>BNB/USDT</td>
      <td>2023-03-02 15:36:07.118</td>
      <td>BNB</td>
      <td>USDT</td>
      <td>297.857700</td>
      <td>0.800000</td>
      <td>297.891900</td>
      <td>0.800000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>ADA/USDT</td>
      <td>2023-03-02 15:36:07.172</td>
      <td>ADA</td>
      <td>USDT</td>
      <td>0.348630</td>
      <td>1100.000000</td>
      <td>0.348750</td>
      <td>511.200000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>BUSD/USDT</td>
      <td>2023-03-02 15:36:07.226</td>
      <td>BUSD</td>
      <td>USDT</td>
      <td>0.999500</td>
      <td>293433.930000</td>
      <td>0.999600</td>
      <td>317175.730000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>SOL/USDT</td>
      <td>2023-03-02 15:36:07.288</td>
      <td>SOL</td>
      <td>USDT</td>
      <td>21.857000</td>
      <td>22.870000</td>
      <td>21.863500</td>
      <td>23.000000</td>
    </tr>
    <tr>
      <th>14</th>
      <td>USDC/USDT</td>
      <td>2023-03-02 15:36:07.342</td>
      <td>USDC</td>
      <td>USDT</td>
      <td>1.000100</td>
      <td>307657.000000</td>
      <td>1.000200</td>
      <td>299181.000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>MATIC/USDT</td>
      <td>2023-03-02 15:36:07.394</td>
      <td>MATIC</td>
      <td>USDT</td>
      <td>1.203000</td>
      <td>1664.600000</td>
      <td>1.205000</td>
      <td>5405.600000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>MANA/USDT</td>
      <td>2023-03-02 15:36:07.447</td>
      <td>MANA</td>
      <td>USDT</td>
      <td>0.631000</td>
      <td>157.000000</td>
      <td>0.632200</td>
      <td>571.000000</td>
    </tr>
    <tr>
      <th>17</th>
      <td>TRX/USDT</td>
      <td>2023-03-02 15:36:07.501</td>
      <td>TRX</td>
      <td>USDT</td>
      <td>0.069280</td>
      <td>10824.900000</td>
      <td>0.069330</td>
      <td>10818.600000</td>
    </tr>
    <tr>
      <th>18</th>
      <td>BTC/BUSD</td>
      <td>2023-03-02 15:36:07.612</td>
      <td>BTC</td>
      <td>BUSD</td>
      <td>23371.440000</td>
      <td>0.021500</td>
      <td>23376.830000</td>
      <td>0.021500</td>
    </tr>
    <tr>
      <th>19</th>
      <td>BNB/BUSD</td>
      <td>2023-03-02 15:36:07.665</td>
      <td>BNB</td>
      <td>BUSD</td>
      <td>297.763000</td>
      <td>1.670000</td>
      <td>297.952500</td>
      <td>1.340000</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ETH/BUSD</td>
      <td>2023-03-02 15:36:07.719</td>
      <td>ETH</td>
      <td>BUSD</td>
      <td>1630.210000</td>
      <td>0.510000</td>
      <td>1630.760000</td>
      <td>0.255000</td>
    </tr>
    <tr>
      <th>21</th>
      <td>MATIC/BUSD</td>
      <td>2023-03-02 15:36:07.772</td>
      <td>MATIC</td>
      <td>BUSD</td>
      <td>1.203410</td>
      <td>623.100000</td>
      <td>1.204540</td>
      <td>415.000000</td>
    </tr>
    <tr>
      <th>22</th>
      <td>USDC/BUSD</td>
      <td>2023-03-02 15:36:07.893</td>
      <td>USDC</td>
      <td>BUSD</td>
      <td>0.999900</td>
      <td>329027.800000</td>
      <td>1.000000</td>
      <td>279879.620000</td>
    </tr>
    <tr>
      <th>23</th>
      <td>MANA/BUSD</td>
      <td>2023-03-02 15:36:07.950</td>
      <td>MANA</td>
      <td>BUSD</td>
      <td>0.630700</td>
      <td>343.000000</td>
      <td>0.632100</td>
      <td>3054.000000</td>
    </tr>
    <tr>
      <th>24</th>
      <td>ADA/BUSD</td>
      <td>2023-03-02 15:36:08.003</td>
      <td>ADA</td>
      <td>BUSD</td>
      <td>0.348000</td>
      <td>6582.900000</td>
      <td>0.349000</td>
      <td>997.000000</td>
    </tr>
    <tr>
      <th>25</th>
      <td>SOL/BUSD</td>
      <td>2023-03-02 15:36:08.056</td>
      <td>SOL</td>
      <td>BUSD</td>
      <td>21.830000</td>
      <td>1.390000</td>
      <td>21.900000</td>
      <td>181.090000</td>
    </tr>
    <tr>
      <th>26</th>
      <td>TRX/BUSD</td>
      <td>2023-03-02 15:36:08.114</td>
      <td>TRX</td>
      <td>BUSD</td>
      <td>0.069290</td>
      <td>10823.900000</td>
      <td>0.069390</td>
      <td>25220.400000</td>
    </tr>
    <tr>
      <th>27</th>
      <td>BTC/USDC</td>
      <td>2023-03-02 15:36:08.170</td>
      <td>BTC</td>
      <td>USDC</td>
      <td>23371.660000</td>
      <td>0.020000</td>
      <td>23376.990000</td>
      <td>0.051000</td>
    </tr>
    <tr>
      <th>28</th>
      <td>ETH/USDC</td>
      <td>2023-03-02 15:36:08.228</td>
      <td>ETH</td>
      <td>USDC</td>
      <td>1630.160000</td>
      <td>0.100000</td>
      <td>1630.810000</td>
      <td>0.215000</td>
    </tr>
    <tr>
      <th>29</th>
      <td>SOL/USDC</td>
      <td>2023-03-02 15:36:08.298</td>
      <td>SOL</td>
      <td>USDC</td>
      <td>21.830000</td>
      <td>343.520000</td>
      <td>21.880000</td>
      <td>201.080000</td>
    </tr>
    <tr>
      <th>30</th>
      <td>ADA/USDC</td>
      <td>2023-03-02 15:36:08.368</td>
      <td>ADA</td>
      <td>USDC</td>
      <td>0.348200</td>
      <td>8615.400000</td>
      <td>0.349400</td>
      <td>2433.100000</td>
    </tr>
    <tr>
      <th>31</th>
      <td>BTC/DAI</td>
      <td>2023-03-02 15:36:08.433</td>
      <td>BTC</td>
      <td>DAI</td>
      <td>23366.440000</td>
      <td>0.049540</td>
      <td>23394.360000</td>
      <td>0.049500</td>
    </tr>
    <tr>
      <th>32</th>
      <td>ETH/DAI</td>
      <td>2023-03-02 15:36:08.485</td>
      <td>ETH</td>
      <td>DAI</td>
      <td>1629.890000</td>
      <td>0.497400</td>
      <td>1631.810000</td>
      <td>1.490000</td>
    </tr>
    <tr>
      <th>33</th>
      <td>BTC/USD</td>
      <td>2023-03-02 15:36:08.623</td>
      <td>BTC</td>
      <td>USD</td>
      <td>23373.010000</td>
      <td>0.007463</td>
      <td>23376.720000</td>
      <td>0.048805</td>
    </tr>
    <tr>
      <th>34</th>
      <td>ETH/USD</td>
      <td>2023-03-02 15:36:08.675</td>
      <td>ETH</td>
      <td>USD</td>
      <td>1630.490000</td>
      <td>2.564550</td>
      <td>1630.740000</td>
      <td>0.580700</td>
    </tr>
    <tr>
      <th>35</th>
      <td>USDT/USD</td>
      <td>2023-03-02 15:36:08.730</td>
      <td>USDT</td>
      <td>USD</td>
      <td>1.000000</td>
      <td>10407.870000</td>
      <td>1.000100</td>
      <td>954839.680000</td>
    </tr>
    <tr>
      <th>36</th>
      <td>BNB/USD</td>
      <td>2023-03-02 15:36:08.782</td>
      <td>BNB</td>
      <td>USD</td>
      <td>297.900200</td>
      <td>2.100000</td>
      <td>297.952500</td>
      <td>1.342000</td>
    </tr>
    <tr>
      <th>37</th>
      <td>ADA/USD</td>
      <td>2023-03-02 15:36:08.835</td>
      <td>ADA</td>
      <td>USD</td>
      <td>0.348800</td>
      <td>1500.000000</td>
      <td>0.348900</td>
      <td>3000.000000</td>
    </tr>
    <tr>
      <th>38</th>
      <td>BUSD/USD</td>
      <td>2023-03-02 15:36:08.942</td>
      <td>BUSD</td>
      <td>USD</td>
      <td>0.999500</td>
      <td>79157.800000</td>
      <td>0.999900</td>
      <td>795593.480000</td>
    </tr>
    <tr>
      <th>39</th>
      <td>MATIC/USD</td>
      <td>2023-03-02 15:36:08.998</td>
      <td>MATIC</td>
      <td>USD</td>
      <td>1.204000</td>
      <td>937.600000</td>
      <td>1.204500</td>
      <td>937.500000</td>
    </tr>
    <tr>
      <th>40</th>
      <td>USDC/USD</td>
      <td>2023-03-02 15:36:09.051</td>
      <td>USDC</td>
      <td>USD</td>
      <td>0.999900</td>
      <td>5050.300000</td>
      <td>1.000000</td>
      <td>517682.170000</td>
    </tr>
    <tr>
      <th>41</th>
      <td>MANA/USD</td>
      <td>2023-03-02 15:36:09.102</td>
      <td>MANA</td>
      <td>USD</td>
      <td>0.631000</td>
      <td>372.340000</td>
      <td>0.631600</td>
      <td>572.340000</td>
    </tr>
    <tr>
      <th>42</th>
      <td>DAI/USD</td>
      <td>2023-03-02 15:36:09.155</td>
      <td>DAI</td>
      <td>USD</td>
      <td>0.999100</td>
      <td>4534.660000</td>
      <td>1.000100</td>
      <td>7591.820000</td>
    </tr>
    <tr>
      <th>43</th>
      <td>SOL/USD</td>
      <td>2023-03-02 15:36:09.217</td>
      <td>SOL</td>
      <td>USD</td>
      <td>21.858100</td>
      <td>55.730000</td>
      <td>21.865900</td>
      <td>18.290000</td>
    </tr>
    <tr>
      <th>44</th>
      <td>TRX/USD</td>
      <td>2023-03-02 15:36:09.270</td>
      <td>TRX</td>
      <td>USD</td>
      <td>0.069200</td>
      <td>225602.200000</td>
      <td>0.069400</td>
      <td>224245.500000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="representing-the-order-book-also-as-a-directed-graph">
<h2>Representing the order book also as a directed graph<a class="headerlink" href="#representing-the-order-book-also-as-a-directed-graph" title="Permalink to this heading">#</a></h2>
<p>Like the exchange itself, the order book for the exchange can be represented as a directed graph where nodes correspond to individual currencies, and the edges correspond to trades available in the current order book. Here we outline the construction of a directed encoding the information available from the order book.</p>
<p>A bid appearing in the order book for market symbol <span class="math notranslate nohighlight">\(b/q\)</span> is an order from a prospective counter party to purchase an amount of the base currency <span class="math notranslate nohighlight">\(b\)</span> at a bid price given in a quote currency. For a currency trader, a bid in the order book is an opportunity to convert the base currency <span class="math notranslate nohighlight">\(b\)</span> into the quote currency <span class="math notranslate nohighlight">\(q\)</span>.</p>
<section id="representing-bids">
<h3>Representing bids<a class="headerlink" href="#representing-bids" title="Permalink to this heading">#</a></h3>
<p>Let <span class="math notranslate nohighlight">\(V_b\)</span> and <span class="math notranslate nohighlight">\(V_q\)</span> denote the amount of each currency held by the currency trader prior to a transaction. Let <span class="math notranslate nohighlight">\(x_{b\rightarrow q}(t)\)</span> denote the amount of currency <span class="math notranslate nohighlight">\(b\)</span> converted to <span class="math notranslate nohighlight">\(q\)</span> during the transaction. For each unit of <span class="math notranslate nohighlight">\(b\)</span> the trader sells to the bidder, the trader receives an amount of currency <span class="math notranslate nohighlight">\(q\)</span> equal to the bid price. Therefore, the change in <span class="math notranslate nohighlight">\(V_b\)</span> and <span class="math notranslate nohighlight">\(V_q\)</span> are given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
\Delta V_b &amp; = - x_{b\rightarrow q} \\
\Delta V_q &amp; = a_{b\rightarrow q} x_{b\rightarrow q}
\end{align*}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(a_{b\rightarrow q}\)</span> is a coefficient equal to the bid price for <span class="math notranslate nohighlight">\(b\)</span> expressed in units of the quote currency <span class="math notranslate nohighlight">\(q\)</span>. The capacity <span class="math notranslate nohighlight">\(c_{b\rightarrow q}\)</span> of an edge <span class="math notranslate nohighlight">\(b\rightarrow q\)</span> is specified by a relationship</p>
<div class="math notranslate nohighlight">
\[x_{b\rightarrow q} \leq c_{b\rightarrow q}\]</div>
<p>Thus each bid on the order book for symbol <span class="math notranslate nohighlight">\(b/q\)</span> results in edge labeled by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
a_{b\rightarrow q} &amp; = \text{bid price} \\
c_{b\rightarrow q} &amp; = \text{bid volume}
\end{align*}
\end{split}\]</div>
</section>
<section id="representing-asks">
<h3>Representing asks<a class="headerlink" href="#representing-asks" title="Permalink to this heading">#</a></h3>
<p>An ‘ask’ for symbol <span class="math notranslate nohighlight">\(b/q\)</span>, is an order on the exchange to sell the base currency at price not less than the ‘ask’ price given in terms of the quote currency. The ask volume is the amount of base currency to be sold. For a currency trader, a sell order is an opportunity to convert the quote current into the base currency such that</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
a_{q\rightarrow b} &amp; = \frac{1}{\text{ask price}} \\
c_{q\rightarrow b} &amp; = \text{ask volume} \times \text{ask volume}
\end{align*}
\end{split}\]</div>
<p>The following cell creates a directed graph using data from an exchange order book.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="k">def</span> <span class="nf">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert an order book dataframe into a directed graph using the NetworkX library.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    order_book : pandas.DataFrame</span>
<span class="sd">        A dataframe containing the order book information.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dg_order_book : networkx.DiGraph</span>
<span class="sd">        A directed graph representing the order book.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># create a dictionary of edges index by (src, dst)</span>
    <span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
    
    <span class="c1"># loop over each order in the order book dataframe</span>
    <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">order_book</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="c1"># if the order is a &#39;bid&#39;, i.e., an order to purchase the base currency</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;bid_volume&quot;</span><span class="p">]):</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">]</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;quote&quot;</span><span class="p">]</span>
            <span class="c1"># add an edge to the graph with the relevant attributes</span>
            <span class="n">dg_order_book</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;bid&quot;</span><span class="p">,</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;bid_price&quot;</span><span class="p">],</span>
                <span class="n">capacity</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;bid_volume&quot;</span><span class="p">],</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;bid_price&quot;</span><span class="p">]),</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span>
                <span class="n">width</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># if the order is an &#39;ask&#39;, i.e., an order to sell the base currency</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;ask_volume&quot;</span><span class="p">]):</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;quote&quot;</span><span class="p">]</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">]</span>
            <span class="c1"># add an edge to the graph with the relevant attributes</span>
            <span class="n">dg_order_book</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;ask&quot;</span><span class="p">,</span>
                <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;ask_price&quot;</span><span class="p">],</span>
                <span class="n">capacity</span> <span class="o">=</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;ask_volume&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;ask_price&quot;</span><span class="p">],</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">order_book</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="s2">&quot;ask_price&quot;</span><span class="p">]),</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
                <span class="n">width</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># loop over each node in the graph and set the color attribute to &quot;lightblue&quot;</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
        <span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lightblue&quot;</span>

    <span class="k">return</span> <span class="n">dg_order_book</span>

<span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display contents of the directed graph</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;src   --&gt; dst    kind            a                c&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;------------------------------------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src</span><span class="si">:</span><span class="s2">5s</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="n">dst</span><span class="si">:</span><span class="s2">5s</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)][</span><span class="s1">&#39;kind&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span>
          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)][</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2"> 16f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)][</span><span class="s1">&#39;capacity&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2"> 16f</span><span class="si">}</span><span class="s2">    &quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>src   --&gt; dst    kind            a                c
------------------------------------------------------
ETH   --&gt; BTC     bid        0.069735         0.012000    
ETH   --&gt; ADA     ask     4668.534080         0.190981    
ETH   --&gt; USDT    bid     1630.200000         0.950000    
ETH   --&gt; BUSD    bid     1630.210000         0.510000    
ETH   --&gt; USDC    bid     1630.160000         0.100000    
ETH   --&gt; DAI     bid     1629.890000         0.497400    
ETH   --&gt; USD     bid     1630.490000         2.564550    
BTC   --&gt; ETH     ask       14.335068         0.003488    
BTC   --&gt; BNB     ask       78.403701         0.038263    
BTC   --&gt; ADA     ask    66844.919786         0.032433    
BTC   --&gt; SOL     ask     1068.261938         0.014154    
BTC   --&gt; MATIC   ask    19391.118868         0.007746    
BTC   --&gt; MANA    ask    36968.576710         0.038113    
BTC   --&gt; TRX     ask   335570.469799         0.075549    
BTC   --&gt; USDT    bid    23373.920000         0.118619    
BTC   --&gt; BUSD    bid    23371.440000         0.021500    
BTC   --&gt; USDC    bid    23371.660000         0.020000    
BTC   --&gt; DAI     bid    23366.440000         0.049540    
BTC   --&gt; USD     bid    23373.010000         0.007463    
BNB   --&gt; BTC     bid        0.012743         0.050000    
BNB   --&gt; USDT    bid      297.857700         0.800000    
BNB   --&gt; BUSD    bid      297.763000         1.670000    
BNB   --&gt; USD     bid      297.900200         2.100000    
ADA   --&gt; BTC     bid        0.000015         2.000000    
ADA   --&gt; ETH     bid        0.000214       994.900000    
ADA   --&gt; USDT    bid        0.348630      1100.000000    
ADA   --&gt; BUSD    bid        0.348000      6582.900000    
ADA   --&gt; USDC    bid        0.348200      8615.400000    
ADA   --&gt; USD     bid        0.348800      1500.000000    
SOL   --&gt; BTC     bid        0.000935         1.420000    
SOL   --&gt; USDT    bid       21.857000        22.870000    
SOL   --&gt; BUSD    bid       21.830000         1.390000    
SOL   --&gt; USDC    bid       21.830000       343.520000    
SOL   --&gt; USD     bid       21.858100        55.730000    
MATIC --&gt; BTC     bid        0.000052        26.200000    
MATIC --&gt; USDT    bid        1.203000      1664.600000    
MATIC --&gt; BUSD    bid        1.203410       623.100000    
MATIC --&gt; USD     bid        1.204000       937.600000    
MANA  --&gt; BTC     bid        0.000027       831.000000    
MANA  --&gt; USDT    bid        0.631000       157.000000    
MANA  --&gt; BUSD    bid        0.630700       343.000000    
MANA  --&gt; USD     bid        0.631000       372.340000    
TRX   --&gt; BTC     bid        0.000003         4.000000    
TRX   --&gt; USDT    bid        0.069280     10824.900000    
TRX   --&gt; BUSD    bid        0.069290     10823.900000    
TRX   --&gt; USD     bid        0.069200    225602.200000    
USDT  --&gt; BTC     ask        0.000043      1058.348400    
USDT  --&gt; ETH     ask        0.000613       815.385000    
USDT  --&gt; BNB     ask        0.003357       238.313520    
USDT  --&gt; ADA     ask        2.867384       178.281000    
USDT  --&gt; BUSD    ask        1.000400    317048.859708    
USDT  --&gt; SOL     ask        0.045738       502.860500    
USDT  --&gt; USDC    ask        0.999800    299240.836200    
USDT  --&gt; MATIC   ask        0.829876      6513.748000    
USDT  --&gt; MANA    ask        1.581778       360.986200    
USDT  --&gt; TRX     ask       14.423770       750.053538    
USDT  --&gt; USD     bid        1.000000     10407.870000    
BUSD  --&gt; USDT    bid        0.999500    293433.930000    
BUSD  --&gt; BTC     ask        0.000043       502.601845    
BUSD  --&gt; BNB     ask        0.003356       399.256350    
BUSD  --&gt; ETH     ask        0.000613       415.843800    
BUSD  --&gt; MATIC   ask        0.830192       499.884100    
BUSD  --&gt; USDC    ask        1.000000    279879.620000    
BUSD  --&gt; MANA    ask        1.582028      1930.433400    
BUSD  --&gt; ADA     ask        2.865330       347.953000    
BUSD  --&gt; SOL     ask        0.045662      3965.871000    
BUSD  --&gt; TRX     ask       14.411298      1750.043556    
BUSD  --&gt; USD     bid        0.999500     79157.800000    
USDC  --&gt; USDT    bid        1.000100    307657.000000    
USDC  --&gt; BUSD    bid        0.999900    329027.800000    
USDC  --&gt; BTC     ask        0.000043      1192.226490    
USDC  --&gt; ETH     ask        0.000613       350.624150    
USDC  --&gt; SOL     ask        0.045704      4399.630400    
USDC  --&gt; ADA     ask        2.862049       850.125140    
USDC  --&gt; USD     bid        0.999900      5050.300000    
DAI   --&gt; BTC     ask        0.000043      1158.020820    
DAI   --&gt; ETH     ask        0.000613      2431.396900    
DAI   --&gt; USD     bid        0.999100      4534.660000    
USD   --&gt; BTC     ask        0.000043      1140.900820    
USD   --&gt; ETH     ask        0.000613       946.970718    
USD   --&gt; USDT    ask        0.999900    954935.163968    
USD   --&gt; BNB     ask        0.003356       399.852255    
USD   --&gt; ADA     ask        2.866151      1046.700000    
USD   --&gt; BUSD    ask        1.000100    795513.920652    
USD   --&gt; MATIC   ask        0.830220      1129.218750    
USD   --&gt; USDC    ask        1.000000    517682.170000    
USD   --&gt; MANA    ask        1.583281       361.489944    
USD   --&gt; DAI     ask        0.999900      7592.579182    
USD   --&gt; SOL     ask        0.045733       399.927311    
USD   --&gt; TRX     ask       14.409222     15562.637700    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">draw_dg</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Direct Graph for an Order Book</span>

<span class="s2">Green: Trader accepts a bid order</span>
<span class="s2">Red: Trader accepts a sell order</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cryptocurrency-arbitrage_17_0.png" src="../../_images/cryptocurrency-arbitrage_17_0.png" />
</div>
</div>
</section>
</section>
<section id="trading-and-arbitrage">
<h2>Trading and Arbitrage<a class="headerlink" href="#trading-and-arbitrage" title="Permalink to this heading">#</a></h2>
<section id="paths-and-cycles">
<h3>Paths and cycles<a class="headerlink" href="#paths-and-cycles" title="Permalink to this heading">#</a></h3>
<p>A path in a directed graph constructed from an exchange order book corresponds to a sequence of trades that convert a source currency to the target currency. Given a sequence of nodes <span class="math notranslate nohighlight">\(i_0, i_1, \ldots, i_n\)</span>, a path of length <span class="math notranslate nohighlight">\(n\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[i_0 \rightarrow i_1 \rightarrow i_2 \rightarrow \cdots \rightarrow i_{n-1} \rightarrow i_n\]</div>
<p>A path is <strong>simple</strong> if there all nodes are distinct. A path is <strong>closed</strong> if it starts and ends at the same node, that is if <span class="math notranslate nohighlight">\(i_0 = i_n\)</span>. A <strong>simple cycle</strong> is closed, simple path.</p>
<p>The path has non-zero capacity if each edge on the path has non-zero capacity. For a sufficiently small holding of the source currency, <span class="math notranslate nohighlight">\(V_{i_0}\)</span>, the result of a sequence of trades will not be affected by the capacity limits. In that case the amount of target currency <span class="math notranslate nohighlight">\(i_n\)</span> held after completing <span class="math notranslate nohighlight">\(n\)</span> trades will be</p>
<div class="math notranslate nohighlight">
\[V_{i_0 \rightarrow i_i \rightarrow \cdots \rightarrow i_n} = \left(\prod_{k=0}^{n-1} a_{i_k\rightarrow i_{k+1}}\right) V_{i_0}\]</div>
<p>This amount is path dependent. There may be multiple paths from a source <span class="math notranslate nohighlight">\(i_0\)</span> to a target <span class="math notranslate nohighlight">\(i_n\)</span>. We seek paths from a source <span class="math notranslate nohighlight">\(i_0\)</span> to a target <span class="math notranslate nohighlight">\(i_n\)</span> that maximize the resulting value.</p>
</section>
<section id="arbitrage">
<h3>Arbitrage<a class="headerlink" href="#arbitrage" title="Permalink to this heading">#</a></h3>
<p>An arbitrage is a series of trades resulting in risk-free profit. If the order book contains a cycle that starts and ends at <span class="math notranslate nohighlight">\(i_0 = i_n\)</span> where</p>
<div class="math notranslate nohighlight">
\[\prod_{k=0}^{n-1} a_{i_k\rightarrow i_{k+1}} &gt; 1\]</div>
<p>then an arbitrage exists for any currency on the cycle. The size of the arbitrage opportunity will be limited by the capacity available on the edges making up the cycle.</p>
</section>
<section id="a-cycle-with-negative-log-returns-indicates-arbitrage">
<h3>A cycle with negative log returns indicates arbitrage<a class="headerlink" href="#a-cycle-with-negative-log-returns-indicates-arbitrage" title="Permalink to this heading">#</a></h3>
<p>To facilitate use of the linear algorithms from the NetworkX library, we assign to each edge a weight equal to the negative logarithm of the conversion coefficients. That is, we let</p>
<div class="math notranslate nohighlight">
\[w_{i\rightarrow j} = - \log a_{i\rightarrow j}\]</div>
<p>If <span class="math notranslate nohighlight">\(w_{i\rightarrow j}\)</span> is interpreted as length of the edge from <span class="math notranslate nohighlight">\(i\)</span> to <span class="math notranslate nohighlight">\(j\)</span>, then a cycle with negative length where</p>
<div class="math notranslate nohighlight">
\[\sum_{k=0}^{n-1} w_{i_k\rightarrow i_{k+1}} &lt; 0\]</div>
<p>corresponds to an arbitrage opportunity. For a given order book, we would like to find cycles with negative length where the start and end point is a stable, investment quality currency.</p>
</section>
<section id="testing-for-a-negative-cycle">
<h3>Testing for a negative cycle<a class="headerlink" href="#testing-for-a-negative-cycle" title="Permalink to this heading">#</a></h3>
<p>The Bellman-Ford test will show the existence of at least one simple cycle demonstrating arbitrage. There may be other cycles with higher or lower return, and that allow for higher or lower trading volumes. The NetworkX function <a class="reference external" href="https://networkx.org/documentation/stable/reference/algorithms/generated/networkx.algorithms.shortest_paths.weighted.negative_edge_cycle.html"> <code class="docutils literal notranslate"><span class="pre">negative_edge_cycle</span></code> returns true if a negative edge cycle exists somewhere in a directed graph.</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">negative_edge_cycle</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">heuristic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="finding-and-displaying-one-negative-cycle">
<h3>Finding and displaying one negative cycle<a class="headerlink" href="#finding-and-displaying-one-negative-cycle" title="Permalink to this heading">#</a></h3>
<p>The NetworkX library includes the function <a class="reference external" href="https://networkx.org/documentation/stable/reference/algorithms/generated/networkx.algorithms.shortest_paths.weighted.find_negative_cycle.html"><code class="docutils literal notranslate"><span class="pre">find_negative_cycle</span></code> that locates a single negative edge cycle</a> if one exists. We can use this to demonstrate the existence of an arbitrage opportunity, and to highlight that opportunity on the directed graph of all possible trades. The following cell reports the cycle found and the trading return measured in basis points (1 bp = 0.01%)</p>
<p>Note this may or may not the trading cycle with maximum return. There may be other cycles with higher or lower returns, and that allow higher or lower trading volumes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute the sum of weights given a list of nodes</span>
<span class="k">def</span> <span class="nf">sum_weights</span><span class="p">(</span><span class="n">cycle</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">cycle</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">cycle</span><span class="p">[:</span><span class="mi">1</span><span class="p">])])</span>

<span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>
<span class="n">arb</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">find_negative_cycle</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trading cycle: </span><span class="si">{</span><span class="n">arb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">bp</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">sum_weights</span><span class="p">(</span><span class="n">arb</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bp</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> basis points&quot;</span><span class="p">)</span>
    
<span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arb</span><span class="p">,</span> <span class="n">arb</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">arb</span><span class="p">[:</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">dg_order_book</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">dst</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
    
<span class="n">ax</span> <span class="o">=</span> <span class="n">draw_dg</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Candidate Trading Cycle </span><span class="si">{</span><span class="n">bp</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> basis points return&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Trading cycle: [&#39;USDC&#39;, &#39;USDT&#39;, &#39;BUSD&#39;]
5.002 basis points
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Candidate Trading Cycle 5.002 basis points return&#39;)
</pre></div>
</div>
<img alt="../../_images/cryptocurrency-arbitrage_21_2.png" src="../../_images/cryptocurrency-arbitrage_21_2.png" />
</div>
</div>
<p>A brute force search over all cycles has complexity <span class="math notranslate nohighlight">\((n + e)(c + 1)\)</span> where <span class="math notranslate nohighlight">\(n\)</span> is number of nodes, <span class="math notranslate nohighlight">\(e\)</span> is the number of edges, and <span class="math notranslate nohighlight">\(c\)</span> is the number of cycles. lkdlwhich is impractical for larger scale applications. A more efficient search based on the Bellman-Ford algorithm is embedded in the NetworkX function <a class="reference external" href="https://networkx.org/documentation/networkx-1.10/reference/generated/networkx.algorithms.shortest_paths.weighted.negative_edge_cycle.html"><code class="docutils literal notranslate"><span class="pre">negative_edge_cycle</span></code></a> that returns a logical True if a negative cycle exists in a directed graph.</p>
<p>Then if the shortest path algorithm returns a closed path with negative length, then that path will yield a positive financial return. Designating the source and destination as nodes <span class="math notranslate nohighlight">\(i_{0} i_{n}\)</span>, the largest return is given by a path minimizing the sum of weights computed as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
&amp; \min\; W_k \\
&amp; \text{s.t.}\; W = \sum_{k=0}^{n-1} w_{i_k \rightarrow i_{k+1}}\\
\end{align*}
\end{split}\]</div>
<p>An arbitrage exists if path length <span class="math notranslate nohighlight">\(W &lt; 0\)</span> for any path where <span class="math notranslate nohighlight">\(i_0 = i_n\)</span>.</p>
</section>
</section>
<section id="brute-force-search-arbitrage-with-simple-cycles">
<h2>Brute force search arbitrage with simple cycles<a class="headerlink" href="#brute-force-search-arbitrage-with-simple-cycles" title="Permalink to this heading">#</a></h2>
<p>A brute force search over for all simple cycles has order <span class="math notranslate nohighlight">\((N_{nodes} + N_{edges})(N_{cycles} + 1)\)</span> complexity, which is prohibitive for large order books. Nevertheless, we explore this option here to better understand the problem of finding and valuing arbitrage opportunities.</p>
<p>Here we compute the financial return for all simple cycles that can be constructed within a directed graph. The following cell uses <a class="reference external" href="https://networkx.org/documentation/stable/reference/algorithms/generated/networkx.algorithms.cycles.simple_cycles.html"><code class="docutils literal notranslate"><span class="pre">simple_cycles</span></code></a> from the NetworkX library to construct a dictionary of all distinct simple cycles in the order book. Each cycle is represented by an ordered list of nodes. For each cycle, the financial return is computed, and a histogram is constructed to show the distribution of potential returns. Several paths with the highest return are then overlaid on the graph of the order book.</p>
<p>Again, note that no account is taken of the trading capacity available on each path.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell iterates over all simple cycles in a directed graph. This</span>
<span class="c1"># can a long time for a large, well connected graph. </span>

<span class="c1"># convert order book to a directed graph</span>
<span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>

<span class="c1"># compute the sum of weights given a list of nodes</span>
<span class="k">def</span> <span class="nf">sum_weights</span><span class="p">(</span><span class="n">cycle</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">cycle</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">cycle</span><span class="p">[:</span><span class="mi">1</span><span class="p">])])</span>

<span class="c1"># create a dictionary of all simple cycles and sum of weights</span>
<span class="n">cycles</span> <span class="o">=</span> <span class="p">{</span><span class="nb">tuple</span><span class="p">(</span><span class="n">cycle</span><span class="p">):</span> <span class="mi">10000</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">sum_weights</span><span class="p">(</span><span class="n">cycle</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">simple_cycles</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">)}</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cycles</span><span class="p">)</span><span class="si">}</span><span class="s2"> distinct simple cycles in the order book.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="nb">len</span><span class="p">([</span><span class="n">cycle</span> <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="n">cycles</span> <span class="k">if</span> <span class="n">cycles</span><span class="p">[</span><span class="n">cycle</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2"> of the cycles have positive return.&quot;</span><span class="p">)</span>

<span class="c1"># create histogram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cycles</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cycles</span><span class="p">))))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Basis Points&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Histogram of Returns for all Simple Cycles&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 203147 distinct simple cycles in the order book.
   974 of the cycles have positive return.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.lines.Line2D at 0x7fa8d93320a0&gt;
</pre></div>
</div>
<img alt="../../_images/cryptocurrency-arbitrage_25_2.png" src="../../_images/cryptocurrency-arbitrage_25_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arbitrage</span> <span class="o">=</span> <span class="p">[</span><span class="n">cycle</span> <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cycles</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cycles</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">cycles</span><span class="p">[</span><span class="n">cycle</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">n_cycles_to_list</span> <span class="o">=</span> <span class="mi">5</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Top </span><span class="si">{</span><span class="n">n_cycles_to_list</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Basis Points             Arbitrage Cycle&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="n">arbitrage</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">n_cycles_to_list</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arbitrage</span><span class="p">))]:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cycle</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cycles</span><span class="p">[</span><span class="n">cycle</span><span class="p">]</span><span class="si">:</span><span class="s2">6.3f</span><span class="si">}</span><span class="s2">         </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="si">}</span><span class="s2"> trades: </span><span class="si">{</span><span class="s1">&#39; -&gt; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Top 5

Basis Points             Arbitrage Cycle
14.774         8 trades: BUSD -&gt; USDC -&gt; USDT -&gt; ADA -&gt; BTC -&gt; ETH -&gt; USD -&gt; BUSD
14.747         8 trades: TRX -&gt; BTC -&gt; ETH -&gt; USD -&gt; BUSD -&gt; USDC -&gt; USDT -&gt; TRX
14.699         7 trades: BUSD -&gt; USDC -&gt; USDT -&gt; ADA -&gt; BTC -&gt; USD -&gt; BUSD
14.673         7 trades: TRX -&gt; BTC -&gt; USD -&gt; BUSD -&gt; USDC -&gt; USDT -&gt; TRX
13.772         7 trades: ETH -&gt; USD -&gt; USDC -&gt; USDT -&gt; ADA -&gt; BTC -&gt; ETH
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_cycles_to_show</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="n">arbitrage</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">n_cycles_to_show</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arbitrage</span><span class="p">))]:</span>

    <span class="c1"># get fresh graph to color nodes</span>
    <span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>
    
    <span class="c1"># color nodes red</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">:</span>
        <span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
    
    <span class="c1"># makes lines wide</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">cycle</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">cycle</span><span class="p">[:</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
        
    <span class="n">ax</span> <span class="o">=</span> <span class="n">draw_dg</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">rad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cycle</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="si">}</span><span class="s2"> trades: </span><span class="si">{</span><span class="s1">&#39; -&gt; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2"> Return = </span><span class="si">{</span><span class="n">cycles</span><span class="p">[</span><span class="n">cycle</span><span class="p">]</span><span class="si">:</span><span class="s2">6.3f</span><span class="si">}</span><span class="s2"> basis points &quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cryptocurrency-arbitrage_27_0.png" src="../../_images/cryptocurrency-arbitrage_27_0.png" />
</div>
</div>
</section>
<section id="pyomo-model-for-arbitrage-with-capacity-constraints">
<h2>Pyomo Model for Arbitrage with Capacity Constraints<a class="headerlink" href="#pyomo-model-for-arbitrage-with-capacity-constraints" title="Permalink to this heading">#</a></h2>
<p>The preceding analysis shows that depending on generic network algorithms to find arbitrage in an exchange order book has some practical limitations:</p>
<ul class="simple">
<li><p>Since there can be multiple negative cycles, there may be more than one opportunity for arbitrage. Which opportunity offers the greatest potential for profit?</p></li>
<li><p>Shortest path algorithms do not account for capacity constraints. The network algorithms are restricted to investments small enough to satisfy all capacity constraints on every edge.</p></li>
</ul>
<p>Let’s consider a Pyomo optimization model to find arbitrage opportunities that maximize financial return. We assume we are given a directed graph where each edge <span class="math notranslate nohighlight">\(i\rightarrow j\)</span> is labeled with a ‘multiplier’ <span class="math notranslate nohighlight">\(a_{i\rightarrow j}\)</span> indicating how many units of currency <span class="math notranslate nohighlight">\(j\)</span> will be received for one unit of currency <span class="math notranslate nohighlight">\(i\)</span>, and a ‘capacity’ <span class="math notranslate nohighlight">\(c_{i\rightarrow j}\)</span> indicating how many units of currency <span class="math notranslate nohighlight">\(i\)</span> can be converted to currency <span class="math notranslate nohighlight">\(j\)</span>.</p>
<p>The model provides up to <span class="math notranslate nohighlight">\(T\)</span> events for a given order book. Each event may consist of zero or currency transactions on different edges. A single transaction converts <span class="math notranslate nohighlight">\(x_{i\rightarrow j}(t)\)</span> units of currency <span class="math notranslate nohighlight">\(i\)</span> to currency <span class="math notranslate nohighlight">\(j\)</span>. Following the all transactions at event <span class="math notranslate nohighlight">\(t\)</span>, the trader will hold <span class="math notranslate nohighlight">\(v_j(t)\)</span> units of currency <span class="math notranslate nohighlight">\(j\)</span> where</p>
<div class="math notranslate nohighlight">
\[v_{j}(t) = v_{j}(t-1) + \sum_{i\in I_j} a_{i\rightarrow j}x_{i\rightarrow j}(t) - \sum_{k\in O_j} x_{j\rightarrow k}(t)\]</div>
<p>Set <span class="math notranslate nohighlight">\(I_j\)</span> are the input nodes to <span class="math notranslate nohighlight">\(j\)</span>, and set <span class="math notranslate nohighlight">\(O_j\)</span> is the set of output nodes from <span class="math notranslate nohighlight">\(j\)</span>. Each edge on the order book has a finite capacity. For every edge <span class="math notranslate nohighlight">\(i\rightarrow j\)</span>, the sum of all transactions must satisfy</p>
<div class="math notranslate nohighlight">
\[\sum_{t=1}^T x_{j\rightarrow k}(t) \leq c_{j\rightarrow k}\]</div>
<p>The objective of the optimization model is to find a sequence of currency transactions the increase holdings of a reference currency. The solution is constrained by assuming the trader cannot short sell any currency. The resulting model is given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\max \quad &amp; v_{USD}(T) \\
\\
\text{s.t.} \quad &amp; v_{USD}(0) = v_0 \\ 
\\
&amp; v_{j}(t) = v_{j}(t-1) + \sum_{i\in I_j} a_{i\rightarrow j}x_{i\rightarrow j}(t) - \sum_{k\in O_k} x_{j\rightarrow k}(t) &amp; \forall j\in NODES, t=1, 2, \ldots, T \\
&amp; v_j(t-1) \geq \sum_{k\in O_j} x_{j\rightarrow k}(t) &amp; \forall j\in NODES, t = 1, 2, \ldots, T  \\
&amp; \sum_{t=1}^T x_{j\rightarrow k}(t) \leq c_{j\rightarrow k} &amp; \forall (j, k) \in EDGES,  t = 1, 2, \ldots, T \\
\end{align*}
\end{split}\]</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">crypto_model</span></code> creates an instance of a corresponding Pyomo model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyomo.environ</span> <span class="k">as</span> <span class="nn">pyo</span>

<span class="k">def</span> <span class="nf">crypto_model</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">v0</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">):</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exchange</span><span class="si">}</span><span class="s2"> arbitrage&quot;</span><span class="p">)</span>

    <span class="c1"># length of the trading chain</span>
    <span class="n">m</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">RangeSet</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">T1</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">RangeSet</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>

    <span class="c1"># currency nodes and trading edges</span>
    <span class="n">m</span><span class="o">.</span><span class="n">NODES</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
    <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">))</span>

    <span class="c1"># currency on hand at each node</span>
    <span class="n">m</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">NODES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">T0</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="c1"># amount traded on each edge at each trade</span>
    <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">T1</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="c1"># total amount traded on each edge over all trades</span>
    <span class="n">m</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">NonNegativeReals</span><span class="p">)</span>

    <span class="c1"># &quot;multiplier&quot; on each trading edge</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)][</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)][</span><span class="s2">&quot;capacity&quot;</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wealth</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;USD&quot;</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">total_traded</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">T1</span><span class="p">])</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">edge_capacity</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]</span>

    <span class="c1"># initial assignment of 100 units on a selected currency</span>
    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">NODES</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">initial</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s2">&quot;USD&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">v0</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">NODES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">T1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">no_shorting</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">out_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">dst</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span> <span class="k">if</span> <span class="n">src</span> <span class="o">==</span> <span class="n">node</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">out_nodes</span><span class="p">)</span>

    <span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">NODES</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">T1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">balances</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">in_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">src</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span> <span class="k">if</span> <span class="n">dst</span> <span class="o">==</span> <span class="n">node</span><span class="p">]</span>
        <span class="n">out_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">dst</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span> <span class="k">if</span> <span class="n">src</span> <span class="o">==</span> <span class="n">node</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">node</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">in_nodes</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">out_nodes</span><span class="p">)</span> 

    <span class="n">solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s2">&quot;cbc&quot;</span><span class="p">)</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<p>Computing the potential return from an order book.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>

<span class="n">v0</span> <span class="o">=</span> <span class="mf">10000.0</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">crypto_model</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">)</span>
<span class="n">vT</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">wealth</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting wealth = </span><span class="si">{</span><span class="n">v0</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2"> USD&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weath after </span><span class="si">{</span><span class="n">T</span><span class="si">:</span><span class="s2">2d</span><span class="si">}</span><span class="s2"> transactions = </span><span class="si">{</span><span class="n">vT</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2"> USD&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Return = </span><span class="si">{</span><span class="mi">10000</span> <span class="o">*</span> <span class="p">(</span><span class="n">vT</span> <span class="o">-</span> <span class="n">v0</span><span class="p">)</span><span class="o">/</span><span class="n">v0</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> basis points&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting wealth = 10000.00 USD
Weath after  8 transactions = 10009.01 USD
Return = 9.007 basis points
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">NODES</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">:</span><span class="s2">5s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">T0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span><span class="si">:</span><span class="s2">11.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ETH       0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000
BTC       0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00004     0.00000
BNB       0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000
ADA       0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     2.00000     0.00000     0.00000
SOL       0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000
MATIC     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000
MANA      0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000
TRX       0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     4.00000     0.00000     0.00000
USDT      0.00000  9998.02600     0.97433     0.00000 10003.02700     0.97482     0.00000 10008.03000     0.00000
BUSD      0.00000     0.00000 10002.02700     0.97472     0.00000 10007.03000     0.00000     0.00000     0.00000
USDC      0.00000     0.97424     0.00000 10002.02700     0.97472     0.00000 10007.03000     0.00000     0.00000
DAI       0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000
USD   10000.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000     0.00000 10009.00700
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Transaction Events&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">T1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t = </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">src</span><span class="si">:</span><span class="s2">8s</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">dst</span><span class="si">:</span><span class="s2">8s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span><span class="si">:</span><span class="s2">14.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span><span class="si">:</span><span class="s2">14.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Transaction Events
t = 1
 USD      -&gt; USDT    :    9999.025800    9998.025997
 USD      -&gt; USDC    :       0.974235       0.974235

t = 2
 USDT     -&gt; BUSD    :    9998.026000   10002.026811
 USDC     -&gt; USDT    :       0.974235       0.974333

t = 3
 USDT     -&gt; BUSD    :       0.974333       0.974723
 BUSD     -&gt; USDC    :   10002.027000   10002.027000

t = 4
 BUSD     -&gt; USDC    :       0.974723       0.974723
 USDC     -&gt; USDT    :   10002.027000   10003.027203

t = 5
 USDT     -&gt; BUSD    :   10003.027000   10007.029812
 USDC     -&gt; USDT    :       0.974723       0.974820

t = 6
 USDT     -&gt; ADA     :       0.697500       2.000000
 USDT     -&gt; TRX     :       0.277320       4.000000
 BUSD     -&gt; USDC    :   10007.030000   10007.030000

t = 7
 ADA      -&gt; BTC     :       2.000000       0.000030
 TRX      -&gt; BTC     :       4.000000       0.000012
 USDC     -&gt; USDT    :   10007.030000   10008.030703

t = 8
 BTC      -&gt; USD     :       0.000042       0.976057
 USDT     -&gt; USD     :   10008.030000   10008.030000
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># report what orders to issue</span>
<span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mf">0.0000002</span><span class="p">:</span> 
        <span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
        <span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">dst</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
        <span class="n">dg_order_book</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="n">dst</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
                
<span class="n">draw_dg</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/cryptocurrency-arbitrage_34_1.png" src="../../_images/cryptocurrency-arbitrage_34_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># report what orders to issue</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trading Summary for the Order Book&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Order Book   Type    Capacity         Traded&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mf">0.0000002</span><span class="p">:</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span><span class="n">dst</span><span class="p">)][</span><span class="s1">&#39;kind&#39;</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src</span><span class="si">:</span><span class="s2">&gt;5s</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">dst</span><span class="si">:</span><span class="s2">&lt;5s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]</span><span class="si">:</span><span class="s2">12.5f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]()</span><span class="si">:</span><span class="s2">14.5f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;  &gt;&gt;&gt;  &quot;</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;ask&quot;</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">dst</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="n">src</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">quote</span>
            <span class="n">price</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)][</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">]()</span> <span class="o">/</span> <span class="n">price</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;sell </span><span class="si">{</span><span class="n">volume</span><span class="si">:</span><span class="s2">15.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">:</span><span class="s2">11s</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">12.6f</span><span class="si">}</span><span class="s2">&quot;</span>
            
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;bid&quot;</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">src</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="n">dst</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">quote</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)][</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">src</span><span class="p">,</span><span class="n">dst</span><span class="p">]()</span> 
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;buy </span><span class="si">{</span><span class="n">volume</span><span class="si">:</span><span class="s2">16.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">:</span><span class="s2">11s</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">12.6f</span><span class="si">}</span><span class="s2">&quot;</span>  
        <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Trading Summary for the Order Book
  Order Book   Type    Capacity         Traded
  BTC -&gt; USD   bid      0.00746        0.00004  &gt;&gt;&gt;  buy         0.000042 BTC/USD     at 23373.010000
  ADA -&gt; BTC   bid      2.00000        2.00000  &gt;&gt;&gt;  buy         2.000000 ADA/BTC     at     0.000015
  TRX -&gt; BTC   bid      4.00000        4.00000  &gt;&gt;&gt;  buy         4.000000 TRX/BTC     at     0.000003
 USDT -&gt; ADA   ask    178.28100        0.69750  &gt;&gt;&gt;  sell        2.000000 ADA/USDT    at     0.348750
 USDT -&gt; BUSD  ask 317048.85971    20002.02700  &gt;&gt;&gt;  sell    20010.031012 BUSD/USDT   at     0.999600
 USDT -&gt; TRX   ask    750.05354        0.27732  &gt;&gt;&gt;  sell        4.000000 TRX/USDT    at     0.069330
 USDT -&gt; USD   bid  10407.87000    10008.03000  &gt;&gt;&gt;  buy     10008.030000 USDT/USD    at     1.000000
 BUSD -&gt; USDC  ask 279879.62000    20010.03100  &gt;&gt;&gt;  sell    20010.031000 USDC/BUSD   at     1.000000
 USDC -&gt; USDT  bid 307657.00000    20011.00600  &gt;&gt;&gt;  buy     20011.006000 USDC/USDT   at     1.000100
  USD -&gt; USDT  ask 954935.16397     9999.02580  &gt;&gt;&gt;  sell     9998.025997 USDT/USD    at     1.000100
  USD -&gt; USDC  ask 517682.17000        0.97424  &gt;&gt;&gt;  sell        0.974235 USDC/USD    at     1.000000
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Transaction Events&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">T1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t = </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">EDGES</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mf">0.0000002</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src</span><span class="si">:</span><span class="s2">8s</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">dst</span><span class="si">:</span><span class="s2">8s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span><span class="si">:</span><span class="s2">14.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Transaction Events
t = 1
USD      -&gt; USDT    :    9999.025800
USD      -&gt; USDC    :       0.974235

t = 2
USDT     -&gt; BUSD    :    9998.026000
USDC     -&gt; USDT    :       0.974235

t = 3
USDT     -&gt; BUSD    :       0.974333
BUSD     -&gt; USDC    :   10002.027000

t = 4
BUSD     -&gt; USDC    :       0.974723
USDC     -&gt; USDT    :   10002.027000

t = 5
USDT     -&gt; BUSD    :   10003.027000
USDC     -&gt; USDT    :       0.974723

t = 6
USDT     -&gt; ADA     :       0.697500
USDT     -&gt; TRX     :       0.277320
BUSD     -&gt; USDC    :   10007.030000

t = 7
ADA      -&gt; BTC     :       2.000000
TRX      -&gt; BTC     :       4.000000
USDC     -&gt; USDT    :   10007.030000

t = 8
BTC      -&gt; USD     :       0.000042
USDT     -&gt; USD     :   10008.030000
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display currency balances</span>
<span class="n">balances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dg_order_book</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">T0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0000002</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">T0</span><span class="p">:</span>
            <span class="n">balances</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span>

<span class="n">balances</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Transaction&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Currency Units&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cryptocurrency-arbitrage_37_0.png" src="../../_images/cryptocurrency-arbitrage_37_0.png" />
</div>
</div>
</section>
<section id="real-time-downloads-of-order-books-from-an-exchange">
<h2>Real Time Downloads of Order Books from an Exchange<a class="headerlink" href="#real-time-downloads-of-order-books-from-an-exchange" title="Permalink to this heading">#</a></h2>
<p>The goal of this notebook is to show how network algorithms and optimization can be utilized to detect arbitrage opportunities within an order book that has been obtained from a cryptocurrency exchange.</p>
<p>The subsequent cell in the notebook utilizes <code class="docutils literal notranslate"><span class="pre">ccxt.exchange.fetch_order_book</span></code> to obtain the highest bid and lowest ask orders from an exchange for market symbols that meet the criteria of having a minimum in-degree for their base currencies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">get_order_book</span><span class="p">(</span><span class="n">exchange</span><span class="p">,</span> <span class="n">dg</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_orders</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">quote</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return order book data for a specified symbol.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">fetch_order_book</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">base</span><span class="p">,</span> <span class="n">quote</span><span class="p">]),</span> <span class="n">limit</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;asks&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;bids&quot;</span><span class="p">]:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;quote&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span><span class="p">,</span> <span class="n">quote</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="n">milliseconds</span><span class="p">()</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;bid_price&quot;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;bid_volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;bids&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;ask_price&quot;</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;ask_volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;asks&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># fetch order book data and store in a dictionary</span>
    <span class="n">order_book</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">get_orders</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">quote</span><span class="p">)</span> <span class="k">for</span> <span class="n">quote</span><span class="p">,</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">dg</span><span class="o">.</span><span class="n">edges</span><span class="p">()])</span>

    <span class="c1"># convert to pandas dataframe</span>
    <span class="n">order_book</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>
    <span class="n">order_book</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">order_book</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">order_book</span><span class="p">[[</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;quote&#39;</span><span class="p">,</span> <span class="s1">&#39;bid_price&#39;</span><span class="p">,</span> <span class="s1">&#39;bid_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;ask_price&#39;</span><span class="p">,</span> <span class="s1">&#39;ask_volume&#39;</span><span class="p">]]</span>


<span class="n">minimum_in_degree</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># graph of market symbols with mininum_in_degree for base currencies</span>
<span class="n">dg</span> <span class="o">=</span> <span class="n">get_dg</span><span class="p">(</span><span class="n">exchange</span><span class="p">,</span> <span class="n">minimum_in_degree</span><span class="p">)</span>

<span class="c1"># retrieve order book for all markets in the graph</span>
<span class="n">order_book</span> <span class="o">=</span> <span class="n">get_order_book</span><span class="p">(</span><span class="n">exchange</span><span class="p">,</span> <span class="n">dg</span><span class="p">)</span>

<span class="c1"># find trades</span>
<span class="n">v0</span> <span class="o">=</span> <span class="mf">10000.0</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">crypto_model</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">)</span>
<span class="n">wT</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">wealth</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Potential Return = </span><span class="si">{</span><span class="mi">10000</span><span class="o">*</span><span class="p">(</span><span class="n">vT</span> <span class="o">-</span> <span class="n">v0</span><span class="p">)</span><span class="o">/</span><span class="n">v0</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> basis points&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Potential Return = 9.007 basis points
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>symbol</th>
      <th>timestamp</th>
      <th>base</th>
      <th>quote</th>
      <th>bid_price</th>
      <th>bid_volume</th>
      <th>ask_price</th>
      <th>ask_volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ETH/BTC</td>
      <td>2023-03-09 04:21:54.764</td>
      <td>ETH</td>
      <td>BTC</td>
      <td>0.070771</td>
      <td>1.01850</td>
      <td>0.070804</td>
      <td>1.300000e+00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BNB/BTC</td>
      <td>2023-03-09 04:21:54.833</td>
      <td>BNB</td>
      <td>BTC</td>
      <td>0.013320</td>
      <td>3.00000</td>
      <td>0.013331</td>
      <td>3.294000e+00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ADA/BTC</td>
      <td>2023-03-09 04:21:54.903</td>
      <td>ADA</td>
      <td>BTC</td>
      <td>0.000015</td>
      <td>8.10000</td>
      <td>0.000015</td>
      <td>9.571000e+02</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SOL/BTC</td>
      <td>2023-03-09 04:21:54.968</td>
      <td>SOL</td>
      <td>BTC</td>
      <td>0.000851</td>
      <td>15.03000</td>
      <td>0.000853</td>
      <td>1.504000e+01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>MATIC/BTC</td>
      <td>2023-03-09 04:21:55.048</td>
      <td>MATIC</td>
      <td>BTC</td>
      <td>0.000049</td>
      <td>5.70000</td>
      <td>0.000049</td>
      <td>6.458000e+02</td>
    </tr>
    <tr>
      <th>5</th>
      <td>MANA/BTC</td>
      <td>2023-03-09 04:21:55.126</td>
      <td>MANA</td>
      <td>BTC</td>
      <td>0.000025</td>
      <td>1.00000</td>
      <td>0.000025</td>
      <td>1.029000e+03</td>
    </tr>
    <tr>
      <th>6</th>
      <td>TRX/BTC</td>
      <td>2023-03-09 04:21:55.194</td>
      <td>TRX</td>
      <td>BTC</td>
      <td>0.000003</td>
      <td>4723.00000</td>
      <td>0.000003</td>
      <td>1.472500e+04</td>
    </tr>
    <tr>
      <th>7</th>
      <td>ADA/ETH</td>
      <td>2023-03-09 04:21:55.275</td>
      <td>ADA</td>
      <td>ETH</td>
      <td>0.000206</td>
      <td>998.70000</td>
      <td>0.000207</td>
      <td>4.000000e-01</td>
    </tr>
    <tr>
      <th>8</th>
      <td>BTC/USDT</td>
      <td>2023-03-09 04:21:55.340</td>
      <td>BTC</td>
      <td>USDT</td>
      <td>21740.300000</td>
      <td>0.02866</td>
      <td>21742.490000</td>
      <td>1.508000e-02</td>
    </tr>
    <tr>
      <th>9</th>
      <td>ETH/USDT</td>
      <td>2023-03-09 04:21:55.404</td>
      <td>ETH</td>
      <td>USDT</td>
      <td>1538.830000</td>
      <td>2.40000</td>
      <td>1539.360000</td>
      <td>5.000000e-01</td>
    </tr>
    <tr>
      <th>10</th>
      <td>BNB/USDT</td>
      <td>2023-03-09 04:21:55.476</td>
      <td>BNB</td>
      <td>USDT</td>
      <td>289.600000</td>
      <td>7.85500</td>
      <td>289.700000</td>
      <td>1.900000e+00</td>
    </tr>
    <tr>
      <th>11</th>
      <td>ADA/USDT</td>
      <td>2023-03-09 04:21:55.541</td>
      <td>ADA</td>
      <td>USDT</td>
      <td>0.318400</td>
      <td>3933.10000</td>
      <td>0.318600</td>
      <td>2.540000e+03</td>
    </tr>
    <tr>
      <th>12</th>
      <td>BUSD/USDT</td>
      <td>2023-03-09 04:21:55.609</td>
      <td>BUSD</td>
      <td>USDT</td>
      <td>0.999600</td>
      <td>327823.00000</td>
      <td>1.000100</td>
      <td>3.252770e+05</td>
    </tr>
    <tr>
      <th>13</th>
      <td>SOL/USDT</td>
      <td>2023-03-09 04:21:55.675</td>
      <td>SOL</td>
      <td>USDT</td>
      <td>18.520000</td>
      <td>98.50000</td>
      <td>18.530000</td>
      <td>3.500000e+01</td>
    </tr>
    <tr>
      <th>14</th>
      <td>USDC/USDT</td>
      <td>2023-03-09 04:21:55.746</td>
      <td>USDC</td>
      <td>USDT</td>
      <td>1.000000</td>
      <td>282130.00000</td>
      <td>1.000400</td>
      <td>2.917270e+05</td>
    </tr>
    <tr>
      <th>15</th>
      <td>MATIC/USDT</td>
      <td>2023-03-09 04:21:55.816</td>
      <td>MATIC</td>
      <td>USDT</td>
      <td>1.060100</td>
      <td>927.40000</td>
      <td>1.061400</td>
      <td>2.033000e+02</td>
    </tr>
    <tr>
      <th>16</th>
      <td>MANA/USDT</td>
      <td>2023-03-09 04:21:55.883</td>
      <td>MANA</td>
      <td>USDT</td>
      <td>0.549100</td>
      <td>159.00000</td>
      <td>0.550400</td>
      <td>5.900000e+02</td>
    </tr>
    <tr>
      <th>17</th>
      <td>TRX/USDT</td>
      <td>2023-03-09 04:21:55.951</td>
      <td>TRX</td>
      <td>USDT</td>
      <td>0.065720</td>
      <td>11412.40000</td>
      <td>0.065780</td>
      <td>1.140270e+04</td>
    </tr>
    <tr>
      <th>18</th>
      <td>BTC/BUSD</td>
      <td>2023-03-09 04:21:56.086</td>
      <td>BTC</td>
      <td>BUSD</td>
      <td>21737.540000</td>
      <td>0.02500</td>
      <td>21742.670000</td>
      <td>4.599000e-02</td>
    </tr>
    <tr>
      <th>19</th>
      <td>BNB/BUSD</td>
      <td>2023-03-09 04:21:56.153</td>
      <td>BNB</td>
      <td>BUSD</td>
      <td>289.500000</td>
      <td>8.25200</td>
      <td>289.800000</td>
      <td>5.176000e+00</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ETH/BUSD</td>
      <td>2023-03-09 04:21:56.218</td>
      <td>ETH</td>
      <td>BUSD</td>
      <td>1538.400000</td>
      <td>0.29000</td>
      <td>1539.210000</td>
      <td>5.800000e-01</td>
    </tr>
    <tr>
      <th>21</th>
      <td>MATIC/BUSD</td>
      <td>2023-03-09 04:21:56.286</td>
      <td>MATIC</td>
      <td>BUSD</td>
      <td>1.060700</td>
      <td>424.20000</td>
      <td>1.061400</td>
      <td>2.355000e+02</td>
    </tr>
    <tr>
      <th>22</th>
      <td>USDC/BUSD</td>
      <td>2023-03-09 04:21:56.356</td>
      <td>USDC</td>
      <td>BUSD</td>
      <td>0.999600</td>
      <td>272795.26000</td>
      <td>0.999900</td>
      <td>3.276466e+05</td>
    </tr>
    <tr>
      <th>23</th>
      <td>MANA/BUSD</td>
      <td>2023-03-09 04:21:56.422</td>
      <td>MANA</td>
      <td>BUSD</td>
      <td>0.548200</td>
      <td>1859.00000</td>
      <td>0.552000</td>
      <td>4.479000e+03</td>
    </tr>
    <tr>
      <th>24</th>
      <td>ADA/BUSD</td>
      <td>2023-03-09 04:21:56.494</td>
      <td>ADA</td>
      <td>BUSD</td>
      <td>0.318100</td>
      <td>3923.20000</td>
      <td>0.318800</td>
      <td>1.201570e+04</td>
    </tr>
    <tr>
      <th>25</th>
      <td>SOL/BUSD</td>
      <td>2023-03-09 04:21:56.562</td>
      <td>SOL</td>
      <td>BUSD</td>
      <td>18.490000</td>
      <td>15.10000</td>
      <td>18.550000</td>
      <td>2.191000e+02</td>
    </tr>
    <tr>
      <th>26</th>
      <td>TRX/BUSD</td>
      <td>2023-03-09 04:21:56.631</td>
      <td>TRX</td>
      <td>BUSD</td>
      <td>0.065710</td>
      <td>7989.40000</td>
      <td>0.065780</td>
      <td>1.706660e+04</td>
    </tr>
    <tr>
      <th>27</th>
      <td>BTC/USDC</td>
      <td>2023-03-09 04:21:56.702</td>
      <td>BTC</td>
      <td>USDC</td>
      <td>21735.910000</td>
      <td>0.02850</td>
      <td>21740.950000</td>
      <td>5.700000e-02</td>
    </tr>
    <tr>
      <th>28</th>
      <td>ETH/USDC</td>
      <td>2023-03-09 04:21:56.773</td>
      <td>ETH</td>
      <td>USDC</td>
      <td>1538.290000</td>
      <td>0.20000</td>
      <td>1539.120000</td>
      <td>2.500000e-01</td>
    </tr>
    <tr>
      <th>29</th>
      <td>SOL/USDC</td>
      <td>2023-03-09 04:21:56.843</td>
      <td>SOL</td>
      <td>USDC</td>
      <td>18.500000</td>
      <td>405.34000</td>
      <td>18.540000</td>
      <td>1.888200e+02</td>
    </tr>
    <tr>
      <th>30</th>
      <td>ADA/USDC</td>
      <td>2023-03-09 04:21:56.911</td>
      <td>ADA</td>
      <td>USDC</td>
      <td>0.318200</td>
      <td>9427.50000</td>
      <td>0.318700</td>
      <td>8.473900e+03</td>
    </tr>
    <tr>
      <th>31</th>
      <td>BTC/DAI</td>
      <td>2023-03-09 04:21:56.975</td>
      <td>BTC</td>
      <td>DAI</td>
      <td>21726.440000</td>
      <td>0.12133</td>
      <td>21764.090000</td>
      <td>4.476000e-02</td>
    </tr>
    <tr>
      <th>32</th>
      <td>ETH/DAI</td>
      <td>2023-03-09 04:21:57.046</td>
      <td>ETH</td>
      <td>DAI</td>
      <td>1537.740000</td>
      <td>1.21270</td>
      <td>1540.830000</td>
      <td>4.515000e-01</td>
    </tr>
    <tr>
      <th>33</th>
      <td>BTC/USD</td>
      <td>2023-03-09 04:21:57.181</td>
      <td>BTC</td>
      <td>USD</td>
      <td>21737.380000</td>
      <td>0.01039</td>
      <td>21741.750000</td>
      <td>4.756000e-02</td>
    </tr>
    <tr>
      <th>34</th>
      <td>ETH/USD</td>
      <td>2023-03-09 04:21:57.250</td>
      <td>ETH</td>
      <td>USD</td>
      <td>1538.880000</td>
      <td>2.59280</td>
      <td>1539.110000</td>
      <td>1.819300e+00</td>
    </tr>
    <tr>
      <th>35</th>
      <td>USDT/USD</td>
      <td>2023-03-09 04:21:57.319</td>
      <td>USDT</td>
      <td>USD</td>
      <td>0.999800</td>
      <td>199911.00000</td>
      <td>1.000000</td>
      <td>1.134335e+06</td>
    </tr>
    <tr>
      <th>36</th>
      <td>BNB/USD</td>
      <td>2023-03-09 04:21:57.400</td>
      <td>BNB</td>
      <td>USD</td>
      <td>289.600000</td>
      <td>4.37900</td>
      <td>289.700000</td>
      <td>5.220000e+00</td>
    </tr>
    <tr>
      <th>37</th>
      <td>ADA/USD</td>
      <td>2023-03-09 04:21:57.474</td>
      <td>ADA</td>
      <td>USD</td>
      <td>0.318400</td>
      <td>3800.00000</td>
      <td>0.318500</td>
      <td>2.180600e+03</td>
    </tr>
    <tr>
      <th>38</th>
      <td>BUSD/USD</td>
      <td>2023-03-09 04:21:57.542</td>
      <td>BUSD</td>
      <td>USD</td>
      <td>0.999700</td>
      <td>505415.00000</td>
      <td>0.999900</td>
      <td>1.052909e+06</td>
    </tr>
    <tr>
      <th>39</th>
      <td>MATIC/USD</td>
      <td>2023-03-09 04:21:57.609</td>
      <td>MATIC</td>
      <td>USD</td>
      <td>1.060800</td>
      <td>740.60000</td>
      <td>1.061200</td>
      <td>5.358000e+02</td>
    </tr>
    <tr>
      <th>40</th>
      <td>USDC/USD</td>
      <td>2023-03-09 04:21:57.675</td>
      <td>USDC</td>
      <td>USD</td>
      <td>0.999900</td>
      <td>26805.03000</td>
      <td>1.000000</td>
      <td>2.263540e+05</td>
    </tr>
    <tr>
      <th>41</th>
      <td>MANA/USD</td>
      <td>2023-03-09 04:21:57.739</td>
      <td>MANA</td>
      <td>USD</td>
      <td>0.549700</td>
      <td>330.00000</td>
      <td>0.550300</td>
      <td>5.900000e+02</td>
    </tr>
    <tr>
      <th>42</th>
      <td>DAI/USD</td>
      <td>2023-03-09 04:21:57.803</td>
      <td>DAI</td>
      <td>USD</td>
      <td>0.995600</td>
      <td>11915.87000</td>
      <td>1.000200</td>
      <td>4.036386e+04</td>
    </tr>
    <tr>
      <th>43</th>
      <td>SOL/USD</td>
      <td>2023-03-09 04:21:57.869</td>
      <td>SOL</td>
      <td>USD</td>
      <td>18.520000</td>
      <td>2.69000</td>
      <td>18.530000</td>
      <td>5.374100e+02</td>
    </tr>
    <tr>
      <th>44</th>
      <td>TRX/USD</td>
      <td>2023-03-09 04:21:57.934</td>
      <td>TRX</td>
      <td>USD</td>
      <td>0.065720</td>
      <td>2541.00000</td>
      <td>0.065760</td>
      <td>3.263600e+03</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The following cell can be used to download additional order book data sets for testing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="n">search_time</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">search_time</span>

<span class="c1"># wait for arbitrage opportunity</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">timeout</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">order_book</span> <span class="o">=</span> <span class="n">get_order_book</span><span class="p">(</span><span class="n">exchange</span><span class="p">,</span> <span class="n">dg</span><span class="p">)</span>
    <span class="n">dg_order_book</span> <span class="o">=</span> <span class="n">order_book_to_dg</span><span class="p">(</span><span class="n">order_book</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nx</span><span class="o">.</span><span class="n">negative_edge_cycle</span><span class="p">(</span><span class="n">dg_order_book</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">heuristic</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;arbitrage found!&quot;</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exchange</span><span class="si">}</span><span class="s2"> orderbook </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H_%M_%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">order_book</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;order book saved to: </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">break</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no arbitrage found in </span><span class="si">{search_time}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>.arbitrage found!
order book saved to: Binance_US_orderbook_20230309_04_22_02.csv
</pre></div>
</div>
</div>
</div>
</section>
<section id="bibliographic-notes">
<h2>Bibliographic Notes<a class="headerlink" href="#bibliographic-notes" title="Permalink to this heading">#</a></h2>
<p>Crytocurrency markets are relatively new compared to other markets, and relatively few academic papers are available that specifically address arbitrage on those markets. Early studies, such as the following, reported periods of large, recurrent arbitrage opportunities that exist across exchanges, and that can persist for several days or weeks.</p>
<blockquote>
<div><p>Makarov, I., &amp; Schoar, A. (2020). Trading and arbitrage in cryptocurrency markets. Journal of Financial Economics, 135(2), 293-319.</p>
</div></blockquote>
<p>Subsequent work reports these prices differentials do exist, but only at a fraction of the values previously reported, and only for fleeting periods of time.</p>
<blockquote>
<div><p>Crépellière, T., &amp; Zeisberger, S. (2020). Arbitrage in the Market for Cryptocurrencies. Available at SSRN 3606053.  <a class="reference external" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3606053">https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3606053</a></p>
</div></blockquote>
<p>The use of network algorithms to identify cross-exchange arbitrage has appeared in the academic literature, and in numerous web sites demonstrating optimization and network applications. Representative examples are cited below.</p>
<blockquote>
<div><p>Peduzzi, G., James, J., &amp; Xu, J. (2021, September). JACK THE RIPPLER: Arbitrage on the Decentralized Exchange of the XRP Ledger. In 2021 3rd Conference on Blockchain Research &amp; Applications for Innovative Networks and Services (BRAINS) (pp. 1-2). IEEE. <a class="reference external" href="https://arxiv.org/pdf/2106.16158.pdf">https://arxiv.org/pdf/2106.16158.pdf</a></p>
</div></blockquote>
<blockquote>
<div><p>Bruzgė, R., &amp; Šapkauskienė, A. (2022). Network analysis on Bitcoin arbitrage opportunities. The North American Journal of Economics and Finance, 59, 101562. <a class="reference external" href="https://doi.org/10.1016/j.najef.2021.101562">https://doi.org/10.1016/j.najef.2021.101562</a></p>
</div></blockquote>
<blockquote>
<div><p>Bruzgė, R., &amp; Šapkauskienė, A. (2022). Dataset for Bitcoin arbitrage in different cryptocurrency exchanges. Data in Brief, 40, 107731.</p>
</div></blockquote>
<p>The work in this notebook is related to materials found in the following web resources.</p>
<blockquote>
<div><p><a class="reference external" href="https://anilpai.medium.com/currency-arbitrage-using-bellman-ford-algorithm-8938dcea56ea">https://anilpai.medium.com/currency-arbitrage-using-bellman-ford-algorithm-8938dcea56ea</a></p>
</div></blockquote>
<blockquote>
<div><p><a class="reference external" href="https://nbviewer.org/github/rcroessmann/sharing_public/blob/master/arbitrage_identification.ipynb">Crypto Trading and Arbitrage Identification Strategies</a></p>
</div></blockquote>
<p>A more complete analysis of trading and exploiting arbitrage opportunities in decentralized finance markets is available in the following paper and thesis.</p>
<blockquote>
<div><p>Byrne, S. An Exploration of Novel Trading and Arbitrage Methods within Decentralised Finance. <a class="reference external" href="https://www.scss.tcd.ie/Donal.OMahony/bfg/202021/StephenByrneDissertation.pdf">https://www.scss.tcd.ie/Donal.OMahony/bfg/202021/StephenByrneDissertation.pdf</a></p>
</div></blockquote>
<blockquote>
<div><p>Levus, R., Berko, A., Chyrun, L., Panasyuk, V., &amp; Hrubel, M. (2021). Intelligent System for Arbitrage Situations Searching in the Cryptocurrency Market. In CEUR Workshop Proceedings (pp. 407-440). <a class="reference external" href="http://ceur-ws.org/Vol-2917/paper32.pdf">http://ceur-ws.org/Vol-2917/paper32.pdf</a></p>
</div></blockquote>
<p>In addition to the analysis of arbitrage opportunities, convex optimization may also have an important role in the developing of trading algorithms for crypocurrency exchanges.</p>
<blockquote>
<div><p>Angeris, G., Agrawal, A., Evans, A., Chitra, T., &amp; Boyd, S. (2021). Constant function market makers: Multi-asset trades via convex optimization. arXiv preprint arXiv:2107.12484. <a class="reference external" href="https://baincapitalcrypto.com/constant-function-market-makers-multi-asset-trades-via-convex-optimization/">https://baincapitalcrypto.com/constant-function-market-makers-multi-asset-trades-via-convex-optimization/</a> and <a class="reference external" href="https://arxiv.org/pdf/2107.12484.pdf">https://arxiv.org/pdf/2107.12484.pdf</a></p>
</div></blockquote>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/04"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="gasoline-distribution.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Gasoline distribution</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="shortest-path-road-networks.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Extra material: Shortest path in real life</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The MO Book Group<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>